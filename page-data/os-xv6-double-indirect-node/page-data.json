{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/os-xv6-double-indirect-node/",
    "result": {"data":{"cur":{"id":"5d077397-5291-5ba2-8fbc-ceb75966ec5d","html":"<h2 id=\"운영체제-과제-4double-indirect-inode\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%BC%EC%A0%9C-4double-indirect-inode\" aria-label=\"운영체제 과제 4double indirect inode permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제 과제 4(double indirect inode)</h2>\n<hr>\n<h3 id=\"테스트-환경\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\" aria-label=\"테스트 환경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 환경</h3>\n<ul>\n<li>OS : Ubuntu 16.04</li>\n<li>gcc : gcc 5.4.0</li>\n</ul>\n<h3 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h3>\n<p>운영체제 네번째 과제인 <strong>double indirect inode</strong>에 대한 내용입니다.</p>\n<p>크게 <strong>fs.c</strong>안의 <strong>bmap , itrunc</strong>함수를 수정하고, <strong>fs.h</strong>와 <strong>file.h</strong>, <strong>param.h</strong>의 값을 조금 수정함으로써 <strong>double indirect inode</strong>를 구현합니다.</p>\n<hr>\n<h3 id=\"과제-명세\" style=\"position:relative;\"><a href=\"#%EA%B3%BC%EC%A0%9C-%EB%AA%85%EC%84%B8\" aria-label=\"과제 명세 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>과제 명세</h3>\n<p>먼저 xv6의 기본적인 inode의 구조에 대한 간단한 구조입니다.\n<img src=\"/uploads/3bdfe834c00520bc22f3a31fc4fb530b/image.png\" alt=\"image\"></p>\n<p><strong>dinode</strong> 구조체에서 <strong>direct block pointer는 12개</strong>가 존재하고, 1개의 <strong>indirect block pointer</strong>가 존재합니다.</p>\n<p>그런 구조를 아래와 같이 수정해야합니다.\n<img src=\"/uploads/5dff876b79e7864b6b3ef8462395de38/image.png\" alt=\"image\"></p>\n<p><strong>dinode</strong> 구조체에서 <strong>direct block pointer</strong>가 11개로 바뀌고, 1개의 <strong>single indirect block pointer</strong>, 그리고 1개의 <strong>dobule indirect block pointer</strong>가 존재합니다.</p>\n<p>구현하기 위해서는 <strong>bmap</strong>과 <strong>itrunc</strong> 함수를 수정해야 합니다.\n<img src=\"/uploads/61a8e0b92fdb2c4d83e409c92ac022cc/image.png\" alt=\"image\"></p>\n<hr>\n<h2 id=\"fsh-수정-사항\" style=\"position:relative;\"><a href=\"#fsh-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\" aria-label=\"fsh 수정 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs.h 수정 사항</h2>\n<p><strong>fs.h</strong>에서 NDIRECT의 값을 1만큼 줄여주고 <strong>(12->11)</strong>,</p>\n<p><strong>NDOUBLEINDIRECT</strong> 의 값을 <strong>NINDIRECT의 제곱</strong>으로 정의합니다.</p>\n<p><strong>addrs 배열</strong>의 크기를 NDIRECT의 값과 매치되게 수정합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">( addrs[NDIRECT+1]->addrs[NDIRECT+2])</code></pre></div>\n<p><img src=\"/uploads/43bffc1ffc7cf0b5f2b0dbd800c9f009/image.png\" alt=\"image\"></p>\n<p>이렇게 작성하면 <strong>direct block pointer</strong>의 개수는 11개로 줄어들고,\n<strong>single(addrs[11]),</strong> <strong>dobule indirect block pointer(addrs[12])</strong> 가 만들어집니다.</p>\n<h2 id=\"fileh-paramh-수정-사항\" style=\"position:relative;\"><a href=\"#fileh-paramh-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\" aria-label=\"fileh paramh 수정 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>file.h, param.h 수정 사항</h2>\n<p><strong>inode</strong>의 구조체 안에 있는 addrs 배열도 <strong>dinode</strong>에서 addrs 배열을 수정한것과 같이 수정해줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">( addrs[NDIRECT+1]->addrs[NDIRECT+2])</code></pre></div>\n<p>param.h 안의 <strong>FSSIZE</strong> 값도 20000이상인 <strong>30000</strong>으로 수정해줍니다.</p>\n<hr>\n<h2 id=\"fsc-수정-사항\" style=\"position:relative;\"><a href=\"#fsc-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\" aria-label=\"fsc 수정 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fs.c 수정 사항</h2>\n<p>먼저 <strong>bmap</strong> 함수를 수정했습니다.\n기존의 bmap 함수를 최대한 참고하여 , double indirect block pointer의 역할을 수행할 수 있게 수행했습니다.</p>\n<p><img src=\"/uploads/23b449c7b9ac04f9d8c55518d04958f8/image.png\" alt=\"image\"></p>\n<p>그 후에는 <strong>itrunc</strong> 함수를 수정했습니다.\n기존의 iturnc 함수를 참조하고, double indirect이기 때문에 두번의 for문이 필요한 구조입니다.\n<img src=\"/uploads/326cba548f07bc28e8f1befa92b60e9d/image.png\" alt=\"image\"></p>\n<hr>\n<h3 id=\"file_test-결과\" style=\"position:relative;\"><a href=\"#file_test-%EA%B2%B0%EA%B3%BC\" aria-label=\"file_test 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>file_test 결과</h3>\n<p><strong>file_test</strong>는 T1,T2,T3로 구성되어 있습니다.</p>\n<p>T1은 파일에 8MB정도의 크기를 쓰고, T2는 8MB의 크기를 읽고 T3는 T1과 T2를 10회 정도 반복해서 전체적인 구조에서 문제가 생기지 않는지를 체크합니다.</p>\n<p><img src=\"/uploads/a27d382868d935ff50e9083e053c6621/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-21_17.01.07\" alt=\"image\"></p>\n<p>위의 그림과 같이 큰 문제 없이 T1과 T2,T3를 통과합니다. 여러번의 file_test를 시도해도</p>\n<p>테스트는 성공적으로 종료됩니다.</p>\n<hr>\n<h3 id=\"추가-구현점과-문제점\" style=\"position:relative;\"><a href=\"#%EC%B6%94%EA%B0%80-%EA%B5%AC%ED%98%84%EC%A0%90%EA%B3%BC-%EB%AC%B8%EC%A0%9C%EC%A0%90\" aria-label=\"추가 구현점과 문제점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>추가 구현점과 문제점</h3>\n<p>눈에 보이는 큰 문제점은 없습니다. 추가 구현점이라면 ,</p>\n<p>Project 3(LWP)에서 만들었던 Thread의 개념을 응용해 <strong>multi-thread</strong> 환경에서 파일을 읽고 쓰는 기능을 만들수 있을것 같습니다.</p>\n<h3 id=\"코드\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C\" aria-label=\"코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드</h3>\n<p><a href=\"https://github.com/BecomeWeasel/Operating-System-xv6\">Operating-System-xv6</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%BC%EC%A0%9C-4double-indirect-inode\">운영체제 과제 4(double indirect inode)</a></p>\n<ul>\n<li><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\">테스트 환경</a></li>\n<li><a href=\"#%EA%B0%9C%EC%9A%94\">개요</a></li>\n<li><a href=\"#%EA%B3%BC%EC%A0%9C-%EB%AA%85%EC%84%B8\">과제 명세</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#fsh-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\">fs.h 수정 사항</a></p>\n</li>\n<li>\n<p><a href=\"#fileh-paramh-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\">file.h, param.h 수정 사항</a></p>\n</li>\n<li>\n<p><a href=\"#fsc-%EC%88%98%EC%A0%95-%EC%82%AC%ED%95%AD\">fs.c 수정 사항</a></p>\n<ul>\n<li><a href=\"#file_test-%EA%B2%B0%EA%B3%BC\">file_test 결과</a></li>\n<li><a href=\"#%EC%B6%94%EA%B0%80-%EA%B5%AC%ED%98%84%EC%A0%90%EA%B3%BC-%EB%AC%B8%EC%A0%9C%EC%A0%90\">추가 구현점과 문제점</a></li>\n<li><a href=\"#%EC%BD%94%EB%93%9C\">코드</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"운영체제 과제 4(double indirect inode) 테스트 환경 OS : Ubuntu 16.04 gcc : gcc 5.4.0 개요 운영체제 네번째 과제인 double indirect inode에 대한 내용입니다. 크게 fs.c안의 bmap , itrunc함수를 수정하고, fs.h와 file.h, param.h의 값을 조금 수정함으로써 double indirect inode를 구현합니다. 과제 명세 먼저 xv6의 기본적인 inode의 구조에 대한 간단한 구조입니다.\nimage dinode 구조체에서 direct block pointer는 12개가 존재하고, 1개의 indirect block pointer가 존재합니다. 그런 구조를 아래와 같이 수정해야합니다.\nimage dinode 구조체에서 direct block pointer가 11개로 바뀌고, 1개의 single indirect block pointer, 그리고 1개의 dobule indirect block pointer…","frontmatter":{"date":"June 21, 2019","title":"운영체제 과제 4 (Double indirect inode)","categories":"운영체제","author":"weasel","emoji":"💻"},"fields":{"slug":"/os-xv6-double-indirect-node/"}},"next":{"id":"855c7bac-c3be-59d4-9b55-84e267962b13","html":"<h2 id=\"운영체제-과제-3lwp\" style=\"position:relative;\"><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%BC%EC%A0%9C-3lwp\" aria-label=\"운영체제 과제 3lwp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>운영체제 과제 3(LWP)</h2>\n<hr>\n<h3 id=\"테스트-환경\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\" aria-label=\"테스트 환경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 환경</h3>\n<ul>\n<li>OS : Ubuntu 16.04</li>\n<li>gcc : gcc 5.4.0</li>\n</ul>\n<h3 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h3>\n<p>운영체제 세번째 과제인 <strong>Light-weight Process</strong>인 <strong>Thread</strong>에 대한 내용입니다.</p>\n<p>크게 <strong>thread_create</strong>, <strong>thread_exit</strong>, <strong>thread_join</strong>을 통해 구현됩니다.</p>\n<hr>\n<h2 id=\"thread-구현을-위한-proc-구조체-변경사항\" style=\"position:relative;\"><a href=\"#thread-%EA%B5%AC%ED%98%84%EC%9D%84-%EC%9C%84%ED%95%9C-proc-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD\" aria-label=\"thread 구현을 위한 proc 구조체 변경사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread 구현을 위한 proc 구조체 변경사항</h2>\n<p><img src=\"/uploads/5d2ed70005c645abe01653c9da300640/image.png\" alt=\"image\"></p>\n<p><code class=\"language-text\">int isThread,int numOfThread,int nextThreadId,thread_t tid,void * retval, struct proc*p creator\n</code> 등을 추가했습니다.\n그중에서  creator 멤버는 기존 <strong>proc 구조체</strong>의 <strong>parent</strong>와 비슷한 역할을 수행합니다.</p>\n<p>이번 설계에서 process와 <strong>thread_create</strong>를 통해 생성된 thread는 <em>parent-child</em> 관계가 아니고 <strong>pid</strong>도 다르기 때문에 <strong>creator</strong>라는 포인터를 가짐으로써 <strong>최소한의 연결 관계</strong>를 유지해줍니다.</p>\n<blockquote>\n<p>이 방식은 아래에서 다시 설명합니다.</p>\n</blockquote>\n<p><em>(단 프로세스의 경우에는 creator와 parent가 같다고 생각합니다.)</em></p>\n<h2 id=\"기본적인-thread-기능-명세\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-thread-%EA%B8%B0%EB%8A%A5-%EB%AA%85%EC%84%B8\" aria-label=\"기본적인 thread 기능 명세 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본적인 Thread 기능 명세</h2>\n<p>먼저 <strong>Thread</strong>의 기본 명세는 다음과 같습니다.\n<img src=\"/uploads/40a1e5a149b14d8fab65c1a96429415e/image.png\" alt=\"image\"></p>\n<ol>\n<li>LWP는 Process와는 다르게 주소 공간을 공유합니다.</li>\n<li>LWP는 본인을 생성한 Process와 다른 <strong>pid</strong> 값을 가집니다.</li>\n<li>LWP는 본인을 생성한 Process를 pointer로 <strong>creator</strong>에 저장함으로써 최소한의 연결관계를 유지합니다.</li>\n<li>LWP가 <strong>fork</strong>를 만나면 정상적으로 수행해야 합니다. <code class=\"language-text\">단, fork된 process는 LWP의 creator에는 접근이 불가합니다.</code></li>\n<li>LWP가 <strong>exec</strong>를 만나면 정상적으로 수행해야 합니다. <code class=\"language-text\">exec를 수행할때 , LWP의 creator의 다른 LWP들은 종료되어야 합니다.</code></li>\n<li>LWP가 <strong>exit</strong>를 만나면 다른 모든 LWP가 종료되어야 합니다.</li>\n<li>LWP의 creator가 kill의 대상이 되면 craetor의 다른 모든 LWP역시 종료되어야 합니다.</li>\n</ol>\n<h3 id=\"선언하고-구현한-시스템콜\" style=\"position:relative;\"><a href=\"#%EC%84%A0%EC%96%B8%ED%95%98%EA%B3%A0-%EA%B5%AC%ED%98%84%ED%95%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%BD%9C\" aria-label=\"선언하고 구현한 시스템콜 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>선언하고 구현한 시스템콜</h3>\n<p><img src=\"/uploads/6122271cc214bc86d7acc206e0f735ab/image.png\" alt=\"image\"></p>\n<ol>\n<li><strong>thread_create</strong> : thread를 생성합니다. 기존의 시스템콜인 fork와 유사합니다.</li>\n<li><strong>thread_exit</strong> : thread를 종료합니다. 기존 시스템콜인 exit와 유사합니다. 이때 결과물을 proc 인자로 받은 retval 안에 저장합니다.</li>\n<li><strong>thread_join</strong> : 특정 thread를 기다립니다. 기존 시스템콜인 wait과 유사합니다. 다른 점은 인자로 받은 double-pointer에 return 값을 저장합니다.</li>\n<li>(<strong>thread_exit_target</strong>) : 명세에는 표시되지 않았지만, 특정 쓰레드를 종료시키기 위해서 직접 구현했습니다.</li>\n</ol>\n<h2 id=\"thread-세부-설명\" style=\"position:relative;\"><a href=\"#thread-%EC%84%B8%EB%B6%80-%EC%84%A4%EB%AA%85\" aria-label=\"thread 세부 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thread 세부 설명</h2>\n<h3 id=\"thread의-생성--thread_create\" style=\"position:relative;\"><a href=\"#thread%EC%9D%98-%EC%83%9D%EC%84%B1--thread_create\" aria-label=\"thread의 생성  thread_create permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thread의 생성 : thread_create</h3>\n<p>첫번째로 <strong>thread_create</strong> 함수에 대해서 설명과 예시입니다.</p>\n<p>먼저 함수의 인자에 대해서 간략히 설명합니다.</p>\n<ol>\n<li>첫번째 인자인 <strong>thread_t * thread</strong>는 thread 생성이 끝난 후 추적을 위해 Thread의 id를 저장하는 용도로 사용했습니다.</li>\n<li>두번째 인자인 <strong>함수 포인터 start_routine</strong>은 생성된 Thread가 해야하는 함수의 진입점으로 사용됩니다.</li>\n<li>세번째 인자인 <strong>void * arg</strong>는 두번째 인자인 함수를 수행하는데 사용되는 것으로 ustack에 저장됩니다.</li>\n</ol>\n<p>전체적인 동작사항은 <strong>fork</strong> 시스콜과 다르지 않지만\n<img src=\"/uploads/776540ffcb888d9b96b73dd798687230/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_14.19.43\" alt=\"image\">\n위의 부분에서 <code class=\"language-text\">allocproc</code>를 통해 반환받은 proc 구조체를</p>\n<p>thread 처럼 동작하게끔 하기 위해  <strong>isThread</strong> 값을 1로 설정해주고 , <strong>tid</strong>값을 현재 proc의 <strong>nextThreadId</strong>값을 가져와서 설정해줍니다.</p>\n<blockquote>\n<p><code class=\"language-text\">단 이 tid는 연속적이나, 실행되고 있는 Thread들의 tid는 연속적임을 보장하지 않습니다. Ex) tid : 1 2 5 6</code></p>\n</blockquote>\n<p><strong>creator</strong>를 현재 Process로 설정해줍니다. 이를 통해 thread와 Process간의 <em>Parent-Child</em> 관계는 아니지만 <em>(<code class=\"language-text\">np->parent=curproc->parent</code> 이기 때문에)</em>\n<strong>어느 정도의 관계를 가지고 있게끔 구현했습니다.</strong>\n또 시작지점을 설정하는 부분에서는 기존 시스템콜인 <strong>exec</strong>을 참고하였습니다.\n<img src=\"/uploads/8b295403924960ff8613158134065669/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_14.19.54\" alt=\"mage\"></p>\n<p><strong>ustack</strong>을 만들어주고 <strong>copyout</strong>을 통해서 복사해줍니다.</p>\n<p><code class=\"language-text\">np->tf->eip=(uint)start_routine</code>\n또 <strong>eip</strong>값을 인자로  들어온 start_routine으로 설정해주어서 thread 가 수행할\n함수의 진입점을 올바르게 설정해줍니다.</p>\n<p>또 LWP끼리는 주소공간을 공유해야 하기 때문에</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">acquire(&amp;ptable.lock);\nstruct proc* p;\n~~~\nfor(p=ptable.proc;p&lt;&amp;ptable.proc[NPROC];p++){\n             if(p->parent->pid==np->parent->pid){\n                     p->sz=np->sz;\n               }\n}\n~~~\nrelease(&amp;ptable.lock);</code></pre></div>\n<p>위와 같은 코드를 통해서 sz값을 공유시켜줍니다. 이를 통해 <strong>Memory Illegal Access</strong> 문제를 방지 할 수 있습니다.</p>\n<p><strong>fork</strong> 시스템콜에서는 생성된 Process의 <strong>pid</strong>값을 반환했지만, thread_create에서는 인자로 전달받은\n<strong>thread_t * thread</strong>에 thread의 <strong>tid</strong>를 저장해줍니다.</p>\n<h3 id=\"thread의-종료--thread_exit\" style=\"position:relative;\"><a href=\"#thread%EC%9D%98-%EC%A2%85%EB%A3%8C--thread_exit\" aria-label=\"thread의 종료  thread_exit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thread의 종료 : thread_exit</h3>\n<p>두번째로 <strong>thread_exit</strong> 함수에 대해서 설명과 예시입니다.</p>\n<p>반환형은 void이고 함수의 인자에 대해서 설명합니다.</p>\n<ol>\n<li>첫번째 인자인 <strong>void * retval</strong> 입니다.  thread가 종료될때 이 인자에 결과값을 저장합니다.</li>\n</ol>\n<p>전체적인 동작은 <strong>exit</strong> 시스템콜과 크게 다르지 않습니다.</p>\n<p><img src=\"/uploads/ce2b52e8683caf4263e93293310e6302/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_15.46.52\" alt=\"image\"></p>\n<p>한가지 다른점은</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curproc->creator->numOfThread--;</code></pre></div>\n<p>을 통해 자신이 속해있는 Process의 쓰레드 개수를 줄이는 기록을 합니다.</p>\n<h3 id=\"thread가-끝나기를-기다림--thread_join\" style=\"position:relative;\"><a href=\"#thread%EA%B0%80-%EB%81%9D%EB%82%98%EA%B8%B0%EB%A5%BC-%EA%B8%B0%EB%8B%A4%EB%A6%BC--thread_join\" aria-label=\"thread가 끝나기를 기다림  thread_join permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thread가 끝나기를 기다림 : thread_join</h3>\n<p>세번째로 <strong>thread_join</strong> 함수의 설명입니다.</p>\n<p>반환형은 int로, join이 성공적이면 0을 .그렇지 않으면 다른 값을 반환합니다.</p>\n<p>함수의 인자는 두개 입니다.</p>\n<ol>\n<li>첫번째 인자인 <strong>thread_t thread</strong>입니다. join의 대상 thread를 지칭하는데 사용됩니다.</li>\n<li>두번째 인자는 <strong>void retval()</strong> 입니다. thread_exit을 통해서 반환된 값을 저장해줍니다.</li>\n</ol>\n<p><strong>thread_join</strong>도 기존의 <strong>wait</strong>시스템콜과 유사합니다.</p>\n<p><img src=\"/uploads/b0439082ad6e66ea166ed1880430df88/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_15.59.34\" alt=\"image\"></p>\n<p>다른 점이 몇가지 있는데</p>\n<ol>\n<li><code class=\"language-text\">freevm(p->pgdir)</code>을 사용하지 않습니다. 주소공간을 공유하기 때문에 이 함수를 join에서는 사용하지 않습니다.</li>\n<li><code class=\"language-text\">*retval=p->retval</code>이라는 새로운 코드를 추가합니다. 인자로 전달받은 <strong>double-pointer retval</strong>에 저장합니다. 이를 통해 완료된 값들을 받아갈 수 있습니다.</li>\n</ol>\n<p>또 한가지 중요한점은</p>\n<p><code class=\"language-text\">sleep (curproc,&amp;ptable.lock);</code></p>\n<p>을 사용한다는 점입니다(기존의 <strong>wait</strong>에도 존재합니다.) 이를 통해서 모든 자식들이 끝나기를 기다립니다.</p>\n<h3 id=\"xv6와의-상호작용\" style=\"position:relative;\"><a href=\"#xv6%EC%99%80%EC%9D%98-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9\" aria-label=\"xv6와의 상호작용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>xv6와의 상호작용</h3>\n<ul>\n<li>일부기능을 제외하고는 프로세스와 같이 움직여야 하며 , 내장 스케쥴러인 RR을 사용합니다 *</li>\n</ul>\n<ol>\n<li><strong>Fork</strong> 의 경우에는 LWP의 대부분의 기능이 Process와 비슷하게 동작하기 때문에 큰 수정 없이 정상작동합니다.</li>\n<li><strong>Exec</strong>의 경우에도 큰 수정 없이 정상작동합니다. <em>단 , thread가 exec를 만났을때,자신을 제외한 같은 프로세스에 속해 있는 다른 thread을 종료해야 하도록 구현했습니다.</em></li>\n<li><strong>sbrk</strong>의 경우에는 <strong>growproc</strong> 시스템콜의 수정이 필요합니다. 스레드의 주소공간이 늘어났다면, 같은 프로세스 군에 속해있는 모든 thread가 이 변경된 <strong>sz</strong>의 값을 알아야합니다. 그렇기에 아래처럼 같은 군에 속해있거나 특정 프로세스(프로세스 군의 main)의 sz를 변경해줍니다. 그렇지 않으면 <strong>page fault</strong>가 나는것을 확인했습니다.</li>\n<li>growproc에서 sz을 접근할때, 다른 스레드가 sz를 수정중일 수 있으니 growproc 전체적으로 ptable lock을 잡아야합니다.</li>\n<li><strong>kill</strong>의 경우에는 <strong>thread_kill</strong> test 에서 다시 언급하겠지만, Process가 kill을 당하면 그 프로세스에 속해있는 모든 프로세스를 종료해줍니다. 기존의 <strong>kill</strong> 시스템콜에서 조금의 추가가 있습니다.</li>\n<li><strong>Exit</strong>의 경우에 thread가 exit을  만나면 같은 프로세스에 속해있는 다른 thread와 자기 자신을 종료하도록 구현했습니다.</li>\n</ol>\n<h3 id=\"xv6와의-상호작용---기존-시스템콜-변경점\" style=\"position:relative;\"><a href=\"#xv6%EC%99%80%EC%9D%98-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9---%EA%B8%B0%EC%A1%B4-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%BD%9C-%EB%B3%80%EA%B2%BD%EC%A0%90\" aria-label=\"xv6와의 상호작용   기존 시스템콜 변경점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>xv6와의 상호작용 - 기존 시스템콜 변경점</h3>\n<h2 id=\"kill\" style=\"position:relative;\"><a href=\"#kill\" aria-label=\"kill permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kill</h2>\n<p><img src=\"/uploads/b0c6b1a1d3ce4b9d59f436f91119a0e1/image.png\" alt=\"image\">\n<strong>kill</strong> 시스템에 다른부분은 기존과 동일하지만 사진과 같이</p>\n<p>ptable을 돌면서 같은 process 집합에 속해있는 Thread들을 killed=1로 바꿉니다.\n이것은 <strong>kill</strong>의 시스템콜의 기능과 유사합니다. 이것을 통해서 프로세스가 kill 되었을때 속해있는 다른 쓰레드들도 kill을 당하게 합니다.</p>\n<h2 id=\"exit\" style=\"position:relative;\"><a href=\"#exit\" aria-label=\"exit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>exit</h2>\n<p><img src=\"/uploads/17425f0e7562f96082effafa59ecbad0/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_23.49.20\" alt=\"image\"></p>\n<p>exit도 ptable을 돌면서 자신과 같은 프로세스군에 있지만 자신을 제외한 스레드를 종료하고 같은 집합에 속해있는 Process도 삭제하는\nkillAllFromThread을 호출하여 exit을 수행합니다.</p>\n<p>위의 상황은 thread가 exit을 만낫을때고 Process가 exit을 만낫을때도 자신이 생성한 thread를 모두 죽이는 역할을 수행하는것이\nkillAllFromThread입니다.</p>\n<h2 id=\"growproc\" style=\"position:relative;\"><a href=\"#growproc\" aria-label=\"growproc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>growproc</h2>\n<p>상기 언급한것과 같이 sz사이즈를 전체적으로 조절합니다.</p>\n<p><em>단 좀더 광범위하게 ptable에 대한 lock을 요청하여 다른 쓰레드가 sz를 수정하는것을 방지합니다.</em></p>\n<h2 id=\"test-결과\" style=\"position:relative;\"><a href=\"#test-%EA%B2%B0%EA%B3%BC\" aria-label=\"test 결과 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test 결과</h2>\n<p>테스트 결과입니다.</p>\n<ul>\n<li><strong>단 앞단에 기재한것과 같이 test 구동에 문제가 있기에 테스트 하나를 끝내고 xv6를 다시 실행해야 합니다.</strong></li>\n</ul>\n<h3 id=\"thread_test-1createexitjoin\" style=\"position:relative;\"><a href=\"#thread_test-1createexitjoin\" aria-label=\"thread_test 1createexitjoin permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_test 1:create,exit,join</h3>\n<p><em>생성하는 thread의 개수를 3개로 늘려서 진행해보았습니다.</em>\n<img src=\"/uploads/88aed5934e84b9ebf40262897da159a1/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_18.42.45\" alt=\"image\">\n정상적으로 thread를 3개 생성하고, 3개 exit 한후 join해서 정상적으로 테스트를 수행합니다.</p>\n<h3 id=\"thread_test-2fork\" style=\"position:relative;\"><a href=\"#thread_test-2fork\" aria-label=\"thread_test 2fork permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_test 2:fork</h3>\n<p><img src=\"/uploads/402aad68dca594cee267a02c52b35e3c/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_18.42.48\" alt=\"image\">\nthread 내에서 fork를 진행한후 정상적으로 끝내는 모습을 확인할 수 있습니다.</p>\n<h3 id=\"thread_test-3sbrk\" style=\"position:relative;\"><a href=\"#thread_test-3sbrk\" aria-label=\"thread_test 3sbrk permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_test 3:sbrk</h3>\n<p><img src=\"/uploads/6155d1f53d391be2e16296cd1074b14f/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_18.42.55\" alt=\"image\">\nthread 내에서 malloc을 사용해 <strong>growproc</strong>을 호출하고 , free(dealloc)을 사용해 다시 <strong>growproc</strong>을 정상적으로 호출하는 것을 볼 수 있습니다. <strong>growproc</strong>을 수정하지 않으면 remap 패닉이 발생합니다.</p>\n<p>thread_test 내 3가지 세부 테스트 모두 성공한 것을 확인 할 수 있습니다.</p>\n<hr>\n<h3 id=\"thread_exec\" style=\"position:relative;\"><a href=\"#thread_exec\" aria-label=\"thread_exec permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_exec</h3>\n<p><img src=\"/uploads/cb991620e5e5a68289c89a5035f704ca/image.png\" alt=\"image\">\nthread가 exec을 만났을때, 자신을 제외한 thread를 모두 종료시키고</p>\n<p>정상적으로 Hello, thread를 출력하는것을 확인 할 수 있습니다.</p>\n<h3 id=\"thread_exit\" style=\"position:relative;\"><a href=\"#thread_exit\" aria-label=\"thread_exit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_exit</h3>\n<p><img src=\"/uploads/4fdba2cf49166bfe206bfbe0f37fea0a/image.png\" alt=\"image\">\nthread가 exit을 만났을때, 그 프로세스 내의 모든 thraed를 종료시키는 테스트입니다.\n정상작동합니다.</p>\n<h3 id=\"thread_kill\" style=\"position:relative;\"><a href=\"#thread_kill\" aria-label=\"thread_kill permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>thread_kill</h3>\n<p><img src=\"/uploads/57a3542705244a4187d975aeee74ed82/image.png\" alt=\"image\">\nthread가 속한 프로세스가 kill 되었을때, 그 프로세스에 속한 thread를 모두 종료시키는 테스트입니다.\n정상작동합니다. zombie 프로세스 역시 생기지 않습니다.</p>\n<h3 id=\"트러블슈팅\" style=\"position:relative;\"><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94%EC%8A%88%ED%8C%85\" aria-label=\"트러블슈팅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>트러블슈팅</h3>\n<p>thread의 기본적인 생성과 종료,그리고 join을 구현하는데 있어서 막막한 감이 있었습니다.</p>\n<p>기존 xv6의 <strong>fork,exec,allocproc,wait,exit</strong>의 코드등을 참고해서 새로운 시스템 콜들을 만들었고</p>\n<p>기존의 시스템콜 역시 thread의 상황에 맞게 적절히 수정했습니다.</p>\n<p>예를들어 thread_create 부분에서 단순히 <strong>fork 시스템콜</strong>의</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">switchuvm(np)</code></pre></div>\n<p>라는 부분이 있었는데, 이것을 <strong>thread_create</strong>단으로 가져오니 알 수 없는 이유의패닉이 자꾸 발생하였고,</p>\n<p>switchuvm의 주요 목표가 <strong>cr3 레지스터의</strong> 값을 변경하는것 이라는걸 알기 위해서</p>\n<p>수업시간에 진행했던 lab pdf를 참조 후 그 부분을<br>\n다음과 같이 수정했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// switchuvm-like\npushcli();\nlcr3(V2P(np->pgdir));\npopcli();</code></pre></div>\n<p>이렇게 수정하고 나니 패닉도 발생하지 않았고, 원하는 대로 함수가 구현되었습니다.</p>\n<h3 id=\"미구현점-혹은-남은-문제사항\" style=\"position:relative;\"><a href=\"#%EB%AF%B8%EA%B5%AC%ED%98%84%EC%A0%90-%ED%98%B9%EC%9D%80-%EB%82%A8%EC%9D%80-%EB%AC%B8%EC%A0%9C%EC%82%AC%ED%95%AD\" aria-label=\"미구현점 혹은 남은 문제사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>미구현점 혹은 남은 문제사항</h3>\n<p><strong>하단에 표시된 문제사항 최신 커밋 기준으로 해결되었습니다.</strong></p>\n<h3 id=\"코드\" style=\"position:relative;\"><a href=\"#%EC%BD%94%EB%93%9C\" aria-label=\"코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>코드</h3>\n<p><a href=\"https://github.com/BecomeWeasel/Operating-System-xv6\">Operating-System-xv6</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B3%BC%EC%A0%9C-3lwp\">운영체제 과제 3(LWP)</a></p>\n<ul>\n<li><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%99%98%EA%B2%BD\">테스트 환경</a></li>\n<li><a href=\"#%EA%B0%9C%EC%9A%94\">개요</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#thread-%EA%B5%AC%ED%98%84%EC%9D%84-%EC%9C%84%ED%95%9C-proc-%EA%B5%AC%EC%A1%B0%EC%B2%B4-%EB%B3%80%EA%B2%BD%EC%82%AC%ED%95%AD\">thread 구현을 위한 proc 구조체 변경사항</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%EB%B3%B8%EC%A0%81%EC%9D%B8-thread-%EA%B8%B0%EB%8A%A5-%EB%AA%85%EC%84%B8\">기본적인 Thread 기능 명세</a></p>\n<ul>\n<li><a href=\"#%EC%84%A0%EC%96%B8%ED%95%98%EA%B3%A0-%EA%B5%AC%ED%98%84%ED%95%9C-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%BD%9C\">선언하고 구현한 시스템콜</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#thread-%EC%84%B8%EB%B6%80-%EC%84%A4%EB%AA%85\">Thread 세부 설명</a></p>\n<ul>\n<li><a href=\"#thread%EC%9D%98-%EC%83%9D%EC%84%B1--thread_create\">Thread의 생성 : thread_create</a></li>\n<li><a href=\"#thread%EC%9D%98-%EC%A2%85%EB%A3%8C--thread_exit\">Thread의 종료 : thread_exit</a></li>\n<li><a href=\"#thread%EA%B0%80-%EB%81%9D%EB%82%98%EA%B8%B0%EB%A5%BC-%EA%B8%B0%EB%8B%A4%EB%A6%BC--thread_join\">Thread가 끝나기를 기다림 : thread_join</a></li>\n<li><a href=\"#xv6%EC%99%80%EC%9D%98-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9\">xv6와의 상호작용</a></li>\n<li><a href=\"#xv6%EC%99%80%EC%9D%98-%EC%83%81%ED%98%B8%EC%9E%91%EC%9A%A9---%EA%B8%B0%EC%A1%B4-%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%BD%9C-%EB%B3%80%EA%B2%BD%EC%A0%90\">xv6와의 상호작용 - 기존 시스템콜 변경점</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#kill\">kill</a></p>\n</li>\n<li>\n<p><a href=\"#exit\">exit</a></p>\n</li>\n<li>\n<p><a href=\"#growproc\">growproc</a></p>\n</li>\n<li>\n<p><a href=\"#test-%EA%B2%B0%EA%B3%BC\">Test 결과</a></p>\n<ul>\n<li><a href=\"#thread_test-1createexitjoin\">thread_test 1:create,exit,join</a></li>\n<li><a href=\"#thread_test-2fork\">thread_test 2:fork</a></li>\n<li><a href=\"#thread_test-3sbrk\">thread_test 3:sbrk</a></li>\n<li><a href=\"#thread_exec\">thread_exec</a></li>\n<li><a href=\"#thread_exit\">thread_exit</a></li>\n<li><a href=\"#thread_kill\">thread_kill</a></li>\n<li><a href=\"#%ED%8A%B8%EB%9F%AC%EB%B8%94%EC%8A%88%ED%8C%85\">트러블슈팅</a></li>\n<li><a href=\"#%EB%AF%B8%EA%B5%AC%ED%98%84%EC%A0%90-%ED%98%B9%EC%9D%80-%EB%82%A8%EC%9D%80-%EB%AC%B8%EC%A0%9C%EC%82%AC%ED%95%AD\">미구현점 혹은 남은 문제사항</a></li>\n<li><a href=\"#%EC%BD%94%EB%93%9C\">코드</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"June 02, 2019","title":"운영체제 과제 3 (LWP)","categories":"운영체제","author":"weasel","emoji":"💻"},"fields":{"slug":"/os-xv6-thread/"}},"prev":{"id":"38eb533d-218e-57a9-bff7-fb7a95946fca","html":"<blockquote>\n<p>본 글은 <a href=\"https://medium.com/@ravthiru/strategy-design-pattern-with-in-spring-boot-application-2ff5a7486cd8\">Strategy Design Pattern with in Spring Boot application.</a>을 번역한 글입니다.</p>\n</blockquote>\n<blockquote>\n<p>잘 쓰여진 글을 정리 하는 겸 한글로 공유하고 싶어서 번역했습니다.</p>\n</blockquote>\n<p>전략 디자인 패턴은 실행 중에 알고리즘을 선택하게 해주는 행동 디자인 패턴이다.</p>\n<p>전략 디자인 패턴의 의도는 다음과 같다 :\n“알고리즘 집합을 선언하고, 각각을 캡슐화하며 그것들을 교체가 가능하게 만든다. 전략 패턴은 알고리즘을 사용하는 유저와는 독립적으로 알고리즘을 다양하게끔 한다.”</p>\n<h2 id=\"uml-class와-sequence-diagram\" style=\"position:relative;\"><a href=\"#uml-class%EC%99%80-sequence-diagram\" aria-label=\"uml class와 sequence diagram permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UML Class와 sequence diagram</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Strategy_pattern\"><img src=\"https://images.velog.io/images/hsw0194/post/354b2fad-7109-48e0-b5ee-8c00099a6f4b/image.png\" alt=\"전략 패턴의 다이어그램\"></a>\n전략 디자인 패턴을 설명하고 다양한 언어로 그것을 구현하는 많은 글들이 시중에 있다.\n이 글의 목적은 스프링 부트 어플리케이션에서 전략 패턴을 어떻게 구현하는지 알려주는 것이다.</p>\n<h2 id=\"스프링-부트\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8\" aria-label=\"스프링 부트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 부트</h2>\n<p>스프링 부트는 Java microservice 개발의 실질적 표준이 되었다. 스프링 부트 어플리케이션에서 자주 쓰이는 디자인 패턴들을 어떻게 구현하는지 아는 것은 유용할 것이다.</p>\n<p>스프링은 의존성 주입을 위해 <code class=\"language-text\">@Autowired</code> annotation을 도입했다. 모든 스프링 구성요소는 주입이 가능하다. 구성요소에는 <code class=\"language-text\">components</code>, <code class=\"language-text\">configurations</code>, <code class=\"language-text\">services</code>, <code class=\"language-text\">bean</code>들이 있다.</p>\n<p>이 글에서 우리는 의존성 주입에 전략 디자인 패턴을 구현할 것이다.</p>\n<p>첫번째로, 우리는 전략 패턴에 필요한 알고리즘 집합을 구현하면서 시작한다.\n아래가 전략 패턴을 위한 인터페이스다. 그리고 <code class=\"language-text\">enum</code>으로 정의된 <code class=\"language-text\">StrategyName</code>을 이용해서 각각의 전략을 구분한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\n\t<span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token class-name\">StrategyA</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token class-name\">StrategyB</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token class-name\">StrategyC</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아래는 전략 패턴을 위한 세가지 알고리즘이다. 각각의 알고리즘은 <code class=\"language-text\">StrategyName</code>을 기준으로 구분된다. 전략들을 구분하는데 있어서 <code class=\"language-text\">String</code>보다는 <code class=\"language-text\">enum</code>을 사용하는 것이 더 좋다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyA</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 알고리즘 A 구현하기</span>\n\t<span class=\"token punctuation\">}</span>\n    \n\t<span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyA</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyB</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 알고리즘 B 구현하기</span>\n\t<span class=\"token punctuation\">}</span>\n    \n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyB</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyC</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\n\n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token comment\">// 알고리즘 C 구현하기</span>\n\t<span class=\"token punctuation\">}</span>\n    \n\t<span class=\"token annotation punctuation\">@Override</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyC</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 우리는 <code class=\"language-text\">StrategyFactory</code>를 다른 스프링 bean으로 만들고, 모든 전략을 factory에 주입한다. 여기서 <code class=\"language-text\">StrategyFactory</code>를 구성할 때 전략들을 Map을 이용해서 저장하는데, 이건 전략들을 <code class=\"language-text\">lookup</code>하는데 $$O(1)$$이 걸리게끔 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyFactory</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategies<span class=\"token punctuation\">;</span>\n  \n  <span class=\"token annotation punctuation\">@Autowired</span>\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategySet<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token function\">createStrategy</span><span class=\"token punctuation\">(</span>strategySet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  \n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Strategy</span> <span class=\"token function\">findStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StrategyName</span> strategyName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n     <span class=\"token keyword\">return</span> strategies<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>strategyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategySet<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      strategies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      strategySet<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span> \n   strategy <span class=\"token operator\">-></span>strategies<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">.</span><span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> strategy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">StrategyFactory</code>를 <code class=\"language-text\">@Autowired</code>를 이용해서 주입받을 수 있게 되었다. 아래가 <code class=\"language-text\">StrategyFactory</code>를 사용한 예제 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SomeService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StrategyFactory</span> strategyFactory<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findSome</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 이름을 전달해서 전략을 가져올 수 있다.</span>\n    <span class=\"token class-name\">Strategy</span> strategy <span class=\"token operator\">=</span> strategyFactory<span class=\"token punctuation\">.</span><span class=\"token function\">findStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyA</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token comment\">// 이제 전략에 정의된 메소드를 호출할 수 있다.</span>\n    strategy<span class=\"token punctuation\">.</span><span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>지금까지 스프링 부트 어플리케이션에서 의존성 주입을 전략 패턴을 이용해서 하는 방법을 살펴보았다.</p>\n<p>더 많은 정보는 <a href=\"http://w3sdesign.com/?gr=b09&#x26;ugr=proble\">The Strategy design pattern</a>에서..</p>\n<blockquote>\n<p>첫 번역글인데 영문 어체를 한국어로 어색하지 않게 전달하는게 쉽지 않네요.</p>\n</blockquote>\n<blockquote>\n<p>전략 패턴을 사용하면 실행 중에 알고리즘을 교체할 수 있는데 원글에서 그런 부분 설명이 빠진점이 아쉽습니다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#uml-class%EC%99%80-sequence-diagram\">UML Class와 sequence diagram</a></li>\n<li><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8\">스프링 부트</a></li>\n<li><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>\n</div>","frontmatter":{"date":"January 30, 2021","title":"스프링 부트 어플리케이션의 전략 패턴(Strategy Design Pattern with in Spring Boot application)","categories":"Spring","author":"weasel","emoji":"📓"},"fields":{"slug":"/starategy-design-pattern-with-in-spring-boot-application/"}},"site":{"siteMetadata":{"siteUrl":"https://becomeweasel.me","comments":{"utterances":{"repo":"BecomeWeasel/BecomeWeasel.github.io"}}}}},"pageContext":{"slug":"/os-xv6-double-indirect-node/","nextSlug":"/os-xv6-thread/","prevSlug":"/starategy-design-pattern-with-in-spring-boot-application/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}