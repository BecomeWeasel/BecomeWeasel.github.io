{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/starategy-design-pattern-with-in-spring-boot-application/",
    "result": {"data":{"cur":{"id":"3c1c5299-739c-5a85-a95e-1336e8e7af32","html":"<blockquote>\n<p>본 글은 <a href=\"https://medium.com/@ravthiru/strategy-design-pattern-with-in-spring-boot-application-2ff5a7486cd8\">Strategy Design Pattern with in Spring Boot application.</a>을 번역한 글입니다.</p>\n</blockquote>\n<blockquote>\n<p>잘 쓰여진 글을 정리 하는 겸 한글로 공유하고 싶어서 번역했습니다.</p>\n</blockquote>\n<p>전략 디자인 패턴은 실행 중에 알고리즘을 선택하게 해주는 행동 디자인 패턴이다.</p>\n<p>전략 디자인 패턴의 의도는 다음과 같다 :\r\n“알고리즘 집합을 선언하고, 각각을 캡슐화하며 그것들을 교체가 가능하게 만든다. 전략 패턴은 알고리즘을 사용하는 유저와는 독립적으로 알고리즘을 다양하게끔 한다.”</p>\n<h2 id=\"uml-class와-sequence-diagram\" style=\"position:relative;\"><a href=\"#uml-class%EC%99%80-sequence-diagram\" aria-label=\"uml class와 sequence diagram permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>UML Class와 sequence diagram</h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Strategy_pattern\"><img src=\"https://images.velog.io/images/hsw0194/post/354b2fad-7109-48e0-b5ee-8c00099a6f4b/image.png\" alt=\"전략 패턴의 다이어그램\"></a>\r\n전략 디자인 패턴을 설명하고 다양한 언어로 그것을 구현하는 많은 글들이 시중에 있다.\r\n이 글의 목적은 스프링 부트 어플리케이션에서 전략 패턴을 어떻게 구현하는지 알려주는 것이다.</p>\n<h2 id=\"스프링-부트\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8\" aria-label=\"스프링 부트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스프링 부트</h2>\n<p>스프링 부트는 Java microservice 개발의 실질적 표준이 되었다. 스프링 부트 어플리케이션에서 자주 쓰이는 디자인 패턴들을 어떻게 구현하는지 아는 것은 유용할 것이다.</p>\n<p>스프링은 의존성 주입을 위해 <code class=\"language-text\">@Autowired</code> annotation을 도입했다. 모든 스프링 구성요소는 주입이 가능하다. 구성요소에는 <code class=\"language-text\">components</code>, <code class=\"language-text\">configurations</code>, <code class=\"language-text\">services</code>, <code class=\"language-text\">bean</code>들이 있다.</p>\n<p>이 글에서 우리는 의존성 주입에 전략 디자인 패턴을 구현할 것이다.</p>\n<p>첫번째로, 우리는 전략 패턴에 필요한 알고리즘 집합을 구현하면서 시작한다.\r\n아래가 전략 패턴을 위한 인터페이스다. 그리고 <code class=\"language-text\">enum</code>으로 정의된 <code class=\"language-text\">StrategyName</code>을 이용해서 각각의 전략을 구분한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\r\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t\r\n\t<span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">enum</span> <span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">{</span>\r\n\t<span class=\"token class-name\">StrategyA</span><span class=\"token punctuation\">,</span>\r\n\t<span class=\"token class-name\">StrategyB</span><span class=\"token punctuation\">,</span>\r\n\t<span class=\"token class-name\">StrategyC</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>아래는 전략 패턴을 위한 세가지 알고리즘이다. 각각의 알고리즘은 <code class=\"language-text\">StrategyName</code>을 기준으로 구분된다. 전략들을 구분하는데 있어서 <code class=\"language-text\">String</code>보다는 <code class=\"language-text\">enum</code>을 사용하는 것이 더 좋다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyA</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// 알고리즘 A 구현하기</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n    \r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyA</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyB</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// 알고리즘 B 구현하기</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n    \r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyB</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyC</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">{</span>\r\n\r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token comment\">// 알고리즘 C 구현하기</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n    \r\n\t<span class=\"token annotation punctuation\">@Override</span>\r\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyName</span> <span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n\t\t<span class=\"token keyword\">return</span> <span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyC</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 우리는 <code class=\"language-text\">StrategyFactory</code>를 다른 스프링 bean으로 만들고, 모든 전략을 factory에 주입한다. 여기서 <code class=\"language-text\">StrategyFactory</code>를 구성할 때 전략들을 Map을 이용해서 저장하는데, 이건 전략들을 <code class=\"language-text\">lookup</code>하는데 $$O(1)$$이 걸리게끔 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StrategyFactory</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">private</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategies<span class=\"token punctuation\">;</span>\r\n  \r\n  <span class=\"token annotation punctuation\">@Autowired</span>\r\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">StrategyFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategySet<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n     <span class=\"token function\">createStrategy</span><span class=\"token punctuation\">(</span>strategySet<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  \r\n  <span class=\"token keyword\">public</span> <span class=\"token class-name\">Strategy</span> <span class=\"token function\">findStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StrategyName</span> strategyName<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n     <span class=\"token keyword\">return</span> strategies<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>strategyName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span> strategySet<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      strategies <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StrategyName</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Strategy</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      strategySet<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span> \r\n   strategy <span class=\"token operator\">-></span>strategies<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>strategy<span class=\"token punctuation\">.</span><span class=\"token function\">getStrategyName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> strategy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">StrategyFactory</code>를 <code class=\"language-text\">@Autowired</code>를 이용해서 주입받을 수 있게 되었다. 아래가 <code class=\"language-text\">StrategyFactory</code>를 사용한 예제 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">SomeService</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">StrategyFactory</span> strategyFactory<span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findSome</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n    <span class=\"token comment\">// 이름을 전달해서 전략을 가져올 수 있다.</span>\r\n    <span class=\"token class-name\">Strategy</span> strategy <span class=\"token operator\">=</span> strategyFactory<span class=\"token punctuation\">.</span><span class=\"token function\">findStrategy</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">StrategyName<span class=\"token punctuation\">.</span>StrategyA</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    \r\n    <span class=\"token comment\">// 이제 전략에 정의된 메소드를 호출할 수 있다.</span>\r\n    strategy<span class=\"token punctuation\">.</span><span class=\"token function\">doStuff</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>지금까지 스프링 부트 어플리케이션에서 의존성 주입을 전략 패턴을 이용해서 하는 방법을 살펴보았다.</p>\n<p>더 많은 정보는 <a href=\"http://w3sdesign.com/?gr=b09&#x26;ugr=proble\">The Strategy design pattern</a>에서..</p>\n<blockquote>\n<p>첫 번역글인데 영문 어체를 한국어로 어색하지 않게 전달하는게 쉽지 않네요.</p>\n</blockquote>\n<blockquote>\n<p>전략 패턴을 사용하면 실행 중에 알고리즘을 교체할 수 있는데 원글에서 그런 부분 설명이 빠진점이 아쉽습니다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#uml-class%EC%99%80-sequence-diagram\">UML Class와 sequence diagram</a></li>\n<li><a href=\"#%EC%8A%A4%ED%94%84%EB%A7%81-%EB%B6%80%ED%8A%B8\">스프링 부트</a></li>\n<li><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>\n</div>","excerpt":"본 글은 Strategy Design Pattern with in Spring Boot application.을 번역한 글입니다. 잘 쓰여진 글을 정리 하는 겸 한글로 공유하고 싶어서 번역했습니다. 전략 디자인 패턴은 실행 중에 알고리즘을 선택하게 해주는 행동 디자인 패턴이다. 전략 디자인 패턴의 의도는 다음과 같다 :\r\n“알고리즘 집합을 선언하고, 각각을 캡슐화하며 그것들을 교체가 가능하게 만든다. 전략 패턴은 알고리즘을 사용하는 유저와는 독립적으로 알고리즘을 다양하게끔 한다.” UML Class와 sequence diagram 전략 패턴의 다이어그램\r\n전략 디자인 패턴을 설명하고 다양한 언어로 그것을 구현하는 많은 글들이 시중에 있다.\r\n이 글의 목적은 스프링 부트 어플리케이션에서 전략 패턴을 어떻게 구현하는지 알려주는 것이다. 스프링 부트 스프링 부트는 Java microservice 개발의 실질적 표준이 되었다. 스프링 부트 어플리케이션에서 자주 쓰이는 디자인 패턴들을 어떻…","frontmatter":{"date":"January 30, 2021","title":"스프링 부트 어플리케이션의 전략 패턴(Strategy Design Pattern with in Spring Boot application)","categories":"Spring","author":"weasel","emoji":"📓"},"fields":{"slug":"/starategy-design-pattern-with-in-spring-boot-application/"}},"next":null,"prev":{"id":"d5a78525-948d-54d9-b633-ee04f090a3e9","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 719px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz31SO47bMBTUIbbIAXKcRZogVZA27XZ7jXRp9xKB+1zApWHIsGUItCTDkvWzKEqUNME8mI7WcPKAwaMovnnzhvSmaQKj73vEcYzdbgelFMqyhPvHrLWW/f1+jyhSyLIWSv1Cmn5CEHyFUp9R1y/w5oSHwwHr9Rqr1QppmgqRgzEGQRDIvzDcI0lKKLVAnn+B739HGH6D1q/wcA0WHY9HQVVVGIZB9sdxlO8sy5DnuTS21sKYFl034T48FrKIaJoGRVFIYdu2uFwuQsBMCzgBLdlutzidTlchdoYBXl3X4l0UReITCZMkESIWLZdL8c4pnoeza772uq4TBSQmqIwjOYXMbERwdFpCpWzsiObE3rwjjXeKuZ4HFXJs2sJMIfcqhdBtWNtjHHtoTaUFrO3e3TItoKrz+SyknOK/hMYM0BqI41YyzzvfeIaj+74vnm42m9sEDwjHK2GINP2JIPiBpnmDMQv8PTvdXsIc/yAcrg/7N6bpA6rqI7R+grXPcBd7X/Tolh3hH4izTHKPcv51AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/3ced1b2df8c525ffaec0ce9aa709fff6/073e9/image.png\"\n        srcset=\"/static/3ced1b2df8c525ffaec0ce9aa709fff6/e9ff0/image.png 180w,\n/static/3ced1b2df8c525ffaec0ce9aa709fff6/f21e7/image.png 360w,\n/static/3ced1b2df8c525ffaec0ce9aa709fff6/073e9/image.png 719w\"\n        sizes=\"(max-width: 719px) 100vw, 719px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>글이 매우 복잡하고 깁니다. 양해 부탁드립니다.</p>\n</blockquote>\n<blockquote>\n<p>틀린 정보나 이해가 가지 않는 부분은 댓글 남겨주시면 참고하겠습니다.</p>\n</blockquote>\n<h3 id=\"handlermapping의-역할\" style=\"position:relative;\"><a href=\"#handlermapping%EC%9D%98-%EC%97%AD%ED%95%A0\" aria-label=\"handlermapping의 역할 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HandlerMapping의 역할</h3>\n<p>Spring MVC에 대해서 공부하던 중, <code class=\"language-text\">HandlerMapping</code>이 request를 처리하기에 적절한 handler를 찾아온다는 설명을 들었다.\r\n좀 더 찾아보니 <em><code class=\"language-text\">HandlerMapping</code>은 <strong>request의 URL과 매칭되는 handler</strong>를 선택하는 역할을 수행한다</em> 는 것을 보았다.</p>\n<p>request의 URL만 보고 어떻게 찾아온다는 것일까? 그리고 <em>찾아진</em> handler는 method인데 어떠한 방식으로 가져온다는 것일까?</p>\n<p>한가지만 기억하고 가자.\r\n<strong>HandlerMapping은 원하는 handler를 찾아오는 역할을 수행한다.</strong></p>\n<h3 id=\"spring-mvc-request-flow\" style=\"position:relative;\"><a href=\"#spring-mvc-request-flow\" aria-label=\"spring mvc request flow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Spring MVC Request flow</h3>\n<p><code class=\"language-text\">HandlerMapping</code>의 역할에 대해서 살펴보기 전에 Spring MVC에서 request가 어떠한 순서로 처리되는지 먼저 보아야 한다.\r\n<img src=\"https://images.velog.io/images/hsw0194/post/8e1df081-c5d5-4c7c-8a33-699b3d6f6e9e/image.png\" alt=\"처리 순서\"></p>\n<ol>\n<li>먼저 <code class=\"language-text\">front-controller</code>의 역할을 하는 <code class=\"language-text\">DispatcherServlet</code>이 request를 받는다.</li>\n<li><strong><code class=\"language-text\">DispatcherServlet</code>은 적절한 controller를 선택하는 일을 <code class=\"language-text\">HandlerMapping</code>에게 요청한다.</strong></li>\n<li><strong><code class=\"language-text\">HandlerMapping</code>은 적합한 controller를 선택한다.</strong></li>\n<li><code class=\"language-text\">DispatcherServlet</code>은 선택된 controller의 비즈니스 로직 실행 작업을 <code class=\"language-text\">HandlerAdapter</code>에게 위임한다.</li>\n<li><code class=\"language-text\">HandlerAdpater</code>가 controller의 비즈니스 로직을 호출하고 결과를 <code class=\"language-text\">ModelAndView</code> 객체에 담아서 <code class=\"language-text\">DispatcherServlet</code>이 에게 return한다.</li>\n<li><code class=\"language-text\">DispatcherServlet</code>이 <code class=\"language-text\">ViewResolver</code>를 이용하여 결과를 보여줄 View를 가져온다.</li>\n<li>View 객체에게 <code class=\"language-text\">DispatcherServlet</code>이 응답 결과 생성을 요청한다.</li>\n</ol>\n<p>이 긴 과정 속에서 이 글에서 살펴볼 과정은 2,3번이다. Request flow 순서대로 <code class=\"language-text\">HandlerMapping</code>에 대해서 알아볼 것이다.</p>\n<h3 id=\"dispatcherservlet\" style=\"position:relative;\"><a href=\"#dispatcherservlet\" aria-label=\"dispatcherservlet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DispatcherServlet</h3>\n<p>먼저 <code class=\"language-text\">DispatcherServlet</code>에서 부터 출발해야한다. 상속구조부터 보면,</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DispatcherServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">FrameworkServlet</span>\r\n\t\t\t↓\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">FrameworkServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServletBean</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">ApplicationContextAware</span>\r\n\t\t\t↓\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HttpServletBean</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">HttpServlet</span>\r\n\t\t\t↓\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HttpServlet</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">GenericServlet</span></code></pre></div>\n<p>이렇게 상속구조를 통해 <code class=\"language-text\">DispatcherServlet</code>은 결국 <code class=\"language-text\">HttpServlet</code>을 상속함을 알 수 있다.\r\n그렇기 때문에 <code class=\"language-text\">DispatcherServlet</code>도 <code class=\"language-text\">Servlet</code>의 생명주기와 비슷하게 흘러감을 알 수 있다. (<code class=\"language-text\">init(),doGet(),doPost(),service() 등등</code>)</p>\n<p>실제로 디버깅을 해보면, <code class=\"language-text\">doService</code>가 호출된다. 그 후 <code class=\"language-text\">DispatcherServlet</code>은 <code class=\"language-text\">front-controller</code> 역할을 하기 때문에 <code class=\"language-text\">doDispatch</code>를 호출한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token function\">doDispatch</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">doDispatch</code>의 javadoc을 보면 Servlet의 <code class=\"language-text\">HandlerMapping</code>을 순서대로 처리하여 handler를 가져온다고 되어있다.</p>\n<blockquote>\n<p>Process the actual dispatching to the handler. The handler will be obtained by applying the servlet’s HandlerMappings in order. The HandlerAdapter will be obtained by querying the servlet’s installed HandlerAdapters to find the first that supports the handler class.</p>\n</blockquote>\n<p><code class=\"language-text\">doDispatch</code>의 실제 코드를 보면 아래처럼 request에 대해서 handler를 가져오는 <code class=\"language-text\">getHandler</code> 함수를 호출하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doDispatch</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletResponse</span> response<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n\t<span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n        <span class=\"token comment\">// Determine handler for the current request.</span>\r\n\tmappedHandler <span class=\"token operator\">=</span> <span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span>processedRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p><code class=\"language-text\">getHandler</code> 함수는 <code class=\"language-text\">DispatcherServlet</code>의 method로 아래와 같다. 이게 실제로 적절한 handler를 가져오는 방식인데 전혀 감이 안온다. 하나하나 풀이해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Nullable</span>\r\n<span class=\"token keyword\">protected</span> <span class=\"token class-name\">HandlerExecutionChain</span> <span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerMappings <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HandlerMapping</span> mapping <span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerMappings<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n      <span class=\"token class-name\">HandlerExecutionChain</span> handler <span class=\"token operator\">=</span> mapping<span class=\"token punctuation\">.</span><span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>handler <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> handler<span class=\"token punctuation\">;</span>\r\n      <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p><code class=\"language-text\">DispathcerServlet</code>은 처음 <code class=\"language-text\">init</code>되는 과정에서 여러가지 <code class=\"language-text\">handlerMapping</code>들을 등록하고 <code class=\"language-text\">List</code>를 통해 <code class=\"language-text\">handlerMappings</code>라는 이름으로 관리하고 있다. <code class=\"language-text\">handelrMappings</code>안에는 여러가지 <code class=\"language-text\">handlerMapping</code>들이 등록되어 있는 것이다.</p>\n</blockquote>\n<p>그러므로 아래 코드는 <em><code class=\"language-text\">DispatcherServlet</code> 안에 <code class=\"language-text\">handlerMapping</code>들이 등록되었다면</em> 이라는 뜻이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerMappings<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>등록되어있는 <code class=\"language-text\">HandlerMapping</code>들을 loop 하면서</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HandlerMapping</span> mapping <span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handlerMappings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n</code></pre></div>\n<p><strong><code class=\"language-text\">HandlerMapping</code>들에게 request에 맞는 handler를 가져오게하고,가져왔다면 그 handler를 return</strong>하는것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token class-name\">HandlerExecutionChain</span> handler<span class=\"token operator\">=</span>mapping<span class=\"token punctuation\">.</span><span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>handler<span class=\"token operator\">!=</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token keyword\">return</span> handler<span class=\"token punctuation\">;</span></code></pre></div>\n<p>핵심 부분은 <strong><code class=\"language-text\">HandlerMapping</code>에게 request에 맞는 handler를 가져오는</strong> 부분이다. 이게 궁금해서 이 먼 길을 돌아온 것이다.</p>\n<p><code class=\"language-text\">DispatcherServlet</code>부분의 내용을 정리하자면,\r\n1.<code class=\"language-text\">doService</code>이 호출된다.\r\n2.<code class=\"language-text\">doService</code>내에서 <code class=\"language-text\">doDispatch</code>가 호출된다.\r\n3.<code class=\"language-text\">doDispatch</code>내에서 <code class=\"language-text\">getHandler</code>가 호출된다.\r\n4.<code class=\"language-text\">getHandler</code>내에서 등록된 <code class=\"language-text\">HandlerMapping</code> 중에서 request에 걸맞는 handler를 가져온다.</p>\n<blockquote>\n<p>이제 거의 다왔다.</p>\n</blockquote>\n<h3 id=\"handlermapping이-handler를-가져오는-과정\" style=\"position:relative;\"><a href=\"#handlermapping%EC%9D%B4-handler%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EB%8A%94-%EA%B3%BC%EC%A0%95\" aria-label=\"handlermapping이 handler를 가져오는 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HandlerMapping이 handler를 가져오는 과정</h3>\n<p><code class=\"language-text\">HandlerMapping</code>은 <code class=\"language-text\">interface</code>로 함수의 선언부만 가지고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">HandlerMapping</span> <span class=\"token punctuation\">{</span>\r\n\t<span class=\"token class-name\">HandlerExecutionChain</span> <span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>실제로 handler를 가져오는 <code class=\"language-text\">getHandler</code>는 추상 클래스인 <code class=\"language-text\">AbstractHandlerMapping</code>에 정의되어 있다.\r\n우리가 흔히 아는 <code class=\"language-text\">RequestMappingHandlerMapping,SimpleUrlHandlerMapping</code> 같은 것들의 부모(<em>바로 윗단계는 아니지만</em>)가 <code class=\"language-text\">AbstratHandlerMapping</code>이다.</p>\n<p>아래는 <code class=\"language-text\">AbstractHandlerMapping</code>의 <code class=\"language-text\">getHandler</code> 코드이다.\r\n<code class=\"language-text\">getHandlerInternal</code>을 통해서 handler을 찾아오고, <code class=\"language-text\">HandlerExecutionChain</code>을 return하는데,우리가 원하는건 handler를 찾아오는 방식이므로 <code class=\"language-text\">getHandlerInternal</code>을 봐야겠다.</p>\n<blockquote>\n<p><code class=\"language-text\">HandlerExecutionChain</code>은 간단하게 handler와 handler interceptor들을 모아놓은 것이다.\r\nHandler execution chain, consisting of handler object and any handler interceptors.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HandlerExecutionChain</span> <span class=\"token function\">getHandler</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token class-name\">Object</span> handler <span class=\"token operator\">=</span> <span class=\"token function\">getHandlerInternal</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  <span class=\"token class-name\">HandlerExecutionChain</span> executionChain <span class=\"token operator\">=</span> <span class=\"token function\">getHandlerExecutionChain</span><span class=\"token punctuation\">(</span>handler<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  <span class=\"token keyword\">return</span> executionChain<span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">getHandlerInternal</code>은 <code class=\"language-text\">AbstractHandlerMapping</code>을 상속한 <code class=\"language-text\">AbstractHandlerMethodMapping</code>에 정의되어 있다.\r\n<code class=\"language-text\">AbstractHandlerMethodMapping</code>은 복잡하지만 이런 구조를 가지고 있다.\r\n<img src=\"https://images.velog.io/images/hsw0194/post/3753e0fe-6506-4414-9ee4-c41dc849a312/image.png\" alt=\"\"></p>\n<p>아래는 <code class=\"language-text\">getHandlerInternal</code>의 코드다. 이번에도 차근차근 살펴보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AbstractHandlerMethodMapping</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AbstractHandlerMapping</span> <span class=\"token punctuation\">{</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token comment\">// Look up a handler method for the given request.</span>\r\n<span class=\"token keyword\">protected</span> <span class=\"token class-name\">HandlerMethod</span> <span class=\"token function\">getHandlerInternal</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token class-name\">String</span> lookupPath <span class=\"token operator\">=</span> <span class=\"token function\">getUrlPathHelper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLookupPathForRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappingRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">acquireReadLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token class-name\">HandlerMethod</span> handlerMethod <span class=\"token operator\">=</span> <span class=\"token function\">lookupHandlerMethod</span><span class=\"token punctuation\">(</span>lookupPath<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>handlerMethod <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> handlerMethod<span class=\"token punctuation\">.</span><span class=\"token function\">createWithResolvedBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n  <span class=\"token keyword\">finally</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappingRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">releaseReadLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 javadoc을 보면 <em>주어진 request에 대한 handler method를 찾습니다.</em> 라고 되어있다. 동작원리의 핵심적인 부분인것이다.</p>\n<blockquote>\n<p>Look up a handler method for the given request.</p>\n</blockquote>\n<p><code class=\"language-text\">lookupPath</code>는 현재 servlet mapping 안에서의 검색경로인데, request 요청을 분석해서 얻을 수 있다. 그리고 <strong><code class=\"language-text\">mappingRegistry</code>에 대한 ReadLock을 가져오고 있다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> lookupPath <span class=\"token operator\">=</span> <span class=\"token function\">getUrlPathHelper</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getLookupPathForRequest</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappingRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">acquireReadLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">lookupPath</code>를 바탕으로 <code class=\"language-text\">lookupHandlerMethod</code>를 통해서 <strong>적절한 <code class=\"language-text\">handlerMethod</code>를 가져온 후 return 한다</strong>, 이 <code class=\"language-text\">handlerMethod</code>가 바로 우리가 직접 Controller 안에 정의한 함수인것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token class-name\">HandlerMethod</span> handlerMethod <span class=\"token operator\">=</span> <span class=\"token function\">lookupHandlerMethod</span><span class=\"token punctuation\">(</span>lookupPath<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>handlerMethod <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">?</span> handlerMethod<span class=\"token punctuation\">.</span><span class=\"token function\">createWithResolvedBean</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>정리해보자면, <code class=\"language-text\">DispatcherServlet</code> 함수 안에서 <code class=\"language-text\">handlerMapping</code>이 여러 과정을 거쳐서 <strong>적절한 <code class=\"language-text\">handlerMethod</code></strong> 를 가져온다는것은 알 수 있다.</p>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/96c33f73-1c61-47c2-920f-965fdadc0bff/Untitled%20Diagram%20(1).jpg\" alt=\"\"></p>\n<p><strong>그러나 궁금증이 더 남아있다. url에 해당하는 적절한 method를 구별하는 방법과, method를 가져오는 것이 여전히 궁금하다.</strong>\r\n각각 <strong>MappingRegistry</strong>와 <strong>Reflection</strong>이 답이다.</p>\n<p>나머지 궁금증은 2편에서 마저 다루도록 한다.</p>\n<h3 id=\"출처\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98\" aria-label=\"출처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처</h3>\n<p><a href=\"https://bgpark.tistory.com/72\">Interceptor 사용법</a> : Request flow에 대해서 잘 정리되어 있었다.\r\n<a href=\"https://docs.spring.io/spring-framework/docs/4.3.2.RELEASE_to_4.3.3.RELEASE/Spring%20Framework%204.3.3.RELEASE/org/springframework/web/servlet/handler/AbstractHandlerMethodMapping.html\">AbstractHandlerMethodMapping javadoc</a>\r\n<a href=\"https://docs.spring.io/spring-framework/docs/4.3.2.RELEASE_to_4.3.3.RELEASE/Spring%20Framework%204.3.3.RELEASE/org/springframework/web/servlet/handler/AbstractHandlerMethodMapping.MappingRegistry.html\">MappingReigstry javadoc</a>\r\n<a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/LinkedMultiValueMap.html\">LinkedMultiValueMap javadoc</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#handlermapping%EC%9D%98-%EC%97%AD%ED%95%A0\">HandlerMapping의 역할</a></li>\n<li><a href=\"#spring-mvc-request-flow\">Spring MVC Request flow</a></li>\n<li><a href=\"#dispatcherservlet\">DispatcherServlet</a></li>\n<li><a href=\"#handlermapping%EC%9D%B4-handler%EB%A5%BC-%EA%B0%80%EC%A0%B8%EC%98%A4%EB%8A%94-%EA%B3%BC%EC%A0%95\">HandlerMapping이 handler를 가져오는 과정</a></li>\n<li><a href=\"#%EC%B6%9C%EC%B2%98\">출처</a></li>\n</ul>\n</div>","frontmatter":{"date":"June 09, 2021","title":"Spring MVC - HandlerMapping의 동작방식 이해하기 1편","categories":"Spring","author":"weasel","emoji":"📓"},"fields":{"slug":"/how-spring-handler-mapping-works-1/"}},"site":{"siteMetadata":{"siteUrl":"https://becomeweasel.github.io","comments":{"utterances":{"repo":"BecomeWeasel/BecomeWeasel.github.io"}}}}},"pageContext":{"slug":"/starategy-design-pattern-with-in-spring-boot-application/","nextSlug":"","prevSlug":"/how-spring-handler-mapping-works-1/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}