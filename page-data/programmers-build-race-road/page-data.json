{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/programmers-build-race-road/",
    "result": {"data":{"cur":{"id":"7e6fc637-3537-5c6c-a4e5-2097e169e8ca","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.555555555555554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQY0z2Q7U8SAQDG7z9rq7VVrg8tzSQFLkBgJxH0NtFmNZXVMQYrKaXR0JkeHAFx3AHeCyJKsda3/p5fu3Pzw7Pfh+flwyO0zDNcNc0RHeuCrjOlZY1p9IdceScjtOGE3vkfj2rPQR9N2S6UmPc/pvh1n+7pLy8ndJwLr3TQ0DjQDXYaFaq1Jvs/dH7a557cckVpki1+Jv+lgk8Mk8psEJKS5EtlwitP6TgT3C1B6Z6gaCZlpc4z7Q3r/2Q+GEWqxy0U3eJYG1A3bMKJFPd9fm7cuUuuVOaBX2QpEuew3SOSSHPU6aN0TYRgVCIYifMwHmP2eZrY3ltSWoaFgIgYW0GMSfiCITLvsrzezpF4sUry1RrXbt5i5t4sgeU412/PeBSjEkLdsGgPRuS+V5lfXyWhymz2ZY4aBo2+g2pY1HSTweQv2WKJ5SdpNt7nmVsMsBiKIu+UCUQl1J6NatgIbXuM7kzZ7dVY+y2zNfxERa2jn05pW+OrH92fXW7mCiRfZjhs6WzlPzL3aInC3jf0s8v8f6HdTNw+pBvIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"race road\"\n        title=\"race road\"\n        src=\"/static/4cbf0d6d188cbd80f46f5ba17c6ab6e1/37523/race-road.png\"\n        srcset=\"/static/4cbf0d6d188cbd80f46f5ba17c6ab6e1/e9ff0/race-road.png 180w,\n/static/4cbf0d6d188cbd80f46f5ba17c6ab6e1/f21e7/race-road.png 360w,\n/static/4cbf0d6d188cbd80f46f5ba17c6ab6e1/37523/race-road.png 720w,\n/static/4cbf0d6d188cbd80f46f5ba17c6ab6e1/00d43/race-road.png 1000w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"문제-제목\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%A0%9C%EB%AA%A9\" aria-label=\"문제 제목 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 제목</h3>\n<p><a href=\"https://programmers.co.kr/learn/courses/30/lessons/67259\">경주로 건설</a></p>\n<h3 id=\"문제-설명\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\" aria-label=\"문제 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 설명</h3>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/8326247c-0516-4faf-a2a5-4baacac9e202/image.png\" alt=\"\">\n건설회사의 설계사인 죠르디는 고객사로부터 자동차 경주로 건설에 필요한 견적을 의뢰받았습니다.\n제공된 경주로 설계 도면에 따르면 경주로 부지는 N x N 크기의 정사각형 격자 형태이며 각 격자는 1 x 1 크기입니다.\n설계 도면에는 각 격자의 칸은 0 또는 1 로 채워져 있으며, 0은 칸이 비어 있음을 1은 해당 칸이 벽으로 채워져 있음을 나타냅니다.\n경주로의 출발점은 (0, 0) 칸(좌측 상단)이며, 도착점은 (N-1, N-1) 칸(우측 하단)입니다. 죠르디는 출발점인 (0, 0) 칸에서 출발한 자동차가 도착점인 (N-1, N-1) 칸까지 무사히 도달할 수 있게 중간에 끊기지 않도록 경주로를 건설해야 합니다.\n경주로는 상, 하, 좌, 우로 인접한 두 빈 칸을 연결하여 건설할 수 있으며, 벽이 있는 칸에는 경주로를 건설할 수 없습니다.\n이때, 인접한 두 빈 칸을 상하 또는 좌우로 연결한 경주로를 직선 도로 라고 합니다.\n또한 두 직선 도로가 서로 직각으로 만나는 지점을 코너 라고 부릅니다.\n건설 비용을 계산해 보니 직선 도로 하나를 만들 때는 100원이 소요되며, 코너를 하나 만들 때는 500원이 추가로 듭니다.\n죠르디는 견적서 작성을 위해 경주로를 건설하는 데 필요한 최소 비용을 계산해야 합니다.</p>\n<p>예를 들어, 아래 그림은 직선 도로 6개와 코너 4개로 구성된 임의의 경주로 예시이며, 건설 비용은 6 x 100 + 4 x 500 = 2600원 입니다.\n<img src=\"https://images.velog.io/images/hsw0194/post/aef8054f-c65c-488a-b209-3d34dc644a2a/image.png\" alt=\"\">\n또 다른 예로, 아래 그림은 직선 도로 4개와 코너 1개로 구성된 경주로이며, 건설 비용은 4 x 100 + 1 x 500 = 900원 입니다.\n<img src=\"https://images.velog.io/images/hsw0194/post/714149fd-a102-4f9e-87eb-1029f4fe0ecb/image.png\" alt=\"\">\n도면의 상태(0은 비어 있음, 1은 벽)을 나타내는 2차원 배열 board가 매개변수로 주어질 때, 경주로를 건설하는데 필요한 최소 비용을 return 하도록 solution 함수를 완성해주세요.</p>\n<h4 id=\"제한-사항\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%ED%95%9C-%EC%82%AC%ED%95%AD\" aria-label=\"제한 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제한 사항</h4>\n<ul>\n<li>board는 2차원 정사각 배열로 배열의 크기는 3 이상 25 이하입니다.</li>\n<li>board 배열의 각 원소의 값은 0 또는 1 입니다.</li>\n<li>도면의 가장 왼쪽 상단 좌표는 (0, 0)이며, 가장 우측 하단 좌표는 (N-1, N-1) 입니다.</li>\n</ul>\n<p>원소의 값 0은 칸이 비어 있어 도로 연결이 가능함을 1은 칸이 벽으로 채워져 있어 도로 연결이 불가능함을 나타냅니다.</p>\n<ul>\n<li>board는 항상 출발점에서 도착점까지 경주로를 건설할 수 있는 형태로 주어집니다.</li>\n</ul>\n<p>출발점과 도착점 칸의 원소의 값은 항상 0으로 주어집니다.</p>\n<h3 id=\"예제-입출력\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C-%EC%9E%85%EC%B6%9C%EB%A0%A5\" aria-label=\"예제 입출력 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제 입출력</h3>\n<p><strong>입력</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[[0,0,0],[0,0,0],[0,0,0]]\t\n[[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,0],[0,0,0,1,0,0,0,1],[0,0,1,0,0,0,1,0],[0,1,0,0,0,1,0,0],[1,0,0,0,0,0,0,0]]\t\n[[0,0,1,0],[0,0,0,0],[0,1,0,1],[1,0,0,0]]\t\n[[0,0,0,0,0,0],[0,1,1,1,1,0],[0,0,1,0,0,0],[1,0,0,1,0,1],[0,1,0,0,0,1],[0,0,0,0,0,0]]\t</code></pre></div>\n<p><strong>입출력 예 #4</strong>\n<img src=\"https://images.velog.io/images/hsw0194/post/b1614d13-f782-4bbe-807e-86c1216d0580/image.png\" alt=\"\"></p>\n<blockquote>\n<p>붉은색 경로와 같이 경주로를 건설하면 직선 도로 12개, 코너 4개로 총 3200원이 듭니다.</p>\n</blockquote>\n<p>만약, 파란색 경로와 같이 경주로를 건설한다면 직선 도로 10개, 코너 5개로 총 3500원이 들며, 더 많은 비용이 듭니다.</p>\n<p><strong>출력</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">900\n3800\n2100\n3200</code></pre></div>\n<h3 id=\"풀이\" style=\"position:relative;\"><a href=\"#%ED%92%80%EC%9D%B4\" aria-label=\"풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>풀이</h3>\n<p>처음 든 생각은 카카오다운 문제였다. BFS/DFS와 같은 어렵지 않은 탐색 풀이를 요구하지만 , naive하지 않고 여러가지 제약을 주고 <del>문제가 귀엽고</del> 문제 설명이 굉장히 친절하다는 것이다. 예시도 굉장히 많고 각각의 예시에 대해서 설명이 나와있기 때문에 코너케이스 방어에 쉽고 논리구조 쌓기가 수월하다.</p>\n<p><strong>그렇다고 마냥 쉬운 문제는 아니다.</strong></p>\n<h4 id=\"사고의-과정\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EA%B3%A0%EC%9D%98-%EA%B3%BC%EC%A0%95\" aria-label=\"사고의 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사고의 과정</h4>\n<p>문제 독해를 천천히 해보면, 최단경로를 구하는 문제처럼 포장을 해놓았다. 하지만 바로 위에 언급한 <strong>입출력 #4</strong>를 보면 파란색 경로가 최단경로임을 알 수 있지만, 최단경로가 아닌 빨간색 경로가 가장 적은 비용으로 목표지점에 도달할 수 있는 경로다. naive하게 최단경로를 구하는 문제는 아닌것이다.</p>\n<p>그렇다고 <a href=\"https://www.acmicpc.net/problem/1967\">트리의 지름</a> 같은 최장경로 문제일까? <strong>전혀 아니다.</strong> 최소한 우리가 구하는 경로는 최단경로에 근접하지만, 그 안에서 비용을 고민해야 하는 문제다.</p>\n<p>문제내에 명시된 비용의 제약사항은 아래와 같다.</p>\n<blockquote>\n<p>인접한 두 빈 칸을 상하 또는 좌우로 연결한 경주로를 직선도로라고 합니다. 또한 두 직선 도로가 <strong>서로 직각으로 만나는 지점을 코너</strong>라고 부릅니다.</p>\n</blockquote>\n<p>쉬운 말로 바꾸면, 경주로가 계속 <strong>오른쪽으로 가다가 위,아래 방향</strong>으로 바꾸면 되면 코너가 생긴다는 것이다. (<strong>왜 왼쪽이 제외되었는가는 아래에서 설명하겠다.</strong>) 다시 말해서 탐색의 방향이 전환되는 시점에서 코너가 생긴다는 것이고, 직전의 탐색의 방향이 중요하니 기록 할 필요가 있다.</p>\n<blockquote>\n<p>이걸 본 순간 바로 떠오른 비슷한 문제가 있다. 백준의 <a href=\"https://www.acmicpc.net/problem/1726\">로봇</a>이라는 문제인데, 단순히 탐색이 아닌 이전 탐색에서의 방향이 지금의 탐색의 명령개수에 영향을 주는 문제다.</p>\n</blockquote>\n<h4 id=\"visit-배열에-이전-방향이-포함되어야하나\" style=\"position:relative;\"><a href=\"#visit-%EB%B0%B0%EC%97%B4%EC%97%90-%EC%9D%B4%EC%A0%84-%EB%B0%A9%ED%96%A5%EC%9D%B4-%ED%8F%AC%ED%95%A8%EB%90%98%EC%96%B4%EC%95%BC%ED%95%98%EB%82%98\" aria-label=\"visit 배열에 이전 방향이 포함되어야하나 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>visit 배열에 이전 방향이 포함되어야하나?</h4>\n<p>직전 탐색의 방향이 중요하다는 것은, 직전 탐색에서의 상황이 단순 <strong>x,y</strong>좌표가 아니라 <strong>상,하,좌,우</strong>인 방향 역시 포함한다는 것이다. <a href=\"https://velog.io/@hsw0194/%EB%B0%B1%EC%A4%80-16922-%EB%A1%9C%EB%A7%88%EC%88%AB%EC%9E%90-%EB%A7%8C%EB%93%A4%EA%B8%B0\">일차원 DFS 탐색에 관한 이전 글</a>에서 명시한 내용 중에서 <em>BFS와 DFS든 노드의 방문여부 배열의 차원을 구성하는것은 노드를 방문할때의 상황의 개수에 따라 나뉘어 진다는것</em> 이라는 부분이 있다.</p>\n<p>그러면 (x,y)를 방문했는지 체크하는 visit 배열이 직전 방향까지 포함한 3차원이여야 할것같다.</p>\n<blockquote>\n<p><code class=\"language-text\">visit[y][x][prev_dir]</code> =이전 방향이 prev_dir인 상태로 (x,y)를 방문했는지</p>\n</blockquote>\n<p>아마 탐색할때 이런 식으로 검사하면 같은 방향 접근시 중복 방문을 막을 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">if</span> <span class=\"token number\">0</span><span class=\"token operator\">&lt;=</span>ny<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">and</span> <span class=\"token number\">0</span><span class=\"token operator\">&lt;=</span>nx<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">and</span> board<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token operator\">!=</span><span class=\"token number\">1</span> <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> visit<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">dir</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n    visit<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">dir</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token boolean\">True</span>\n    q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span>nx<span class=\"token punctuation\">,</span><span class=\"token builtin\">dir</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"확실하게-틀리는-반례\" style=\"position:relative;\"><a href=\"#%ED%99%95%EC%8B%A4%ED%95%98%EA%B2%8C-%ED%8B%80%EB%A6%AC%EB%8A%94-%EB%B0%98%EB%A1%80\" aria-label=\"확실하게 틀리는 반례 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>확실하게 틀리는 반례</h4>\n<p><strong>문제 해결!!!</strong> 이면 참 좋겠지만, 예시조차 통과하지 못한다. 그 이유는 아래와 같다.\n<img src=\"https://images.velog.io/images/hsw0194/post/a09fb254-5c56-4a89-9dec-a028d894ac3c/%EA%B7%B8%EB%A6%BC2.png\" alt=\"\">\n위의 그림에서 파란색 경로와 빨간색 경로가 있다고 할때 빨간색 경로가 최소비용을 가지는 경로다. 주의 깊게 봐야할 부분은 초록색 박스를 친 부분이다.</p>\n<p>만약 파란색 경로가 빨간색 경로보다 먼저 수행된다고 한다면 , <strong>(3,1)에서 (3,2)</strong> 으로 내려올때 <code class=\"language-text\">visit[2][3][up]</code>의 값은 <code class=\"language-text\">False</code>에서 <code class=\"language-text\">True</code>로 바뀌게 된다. <strong>(3,2)</strong> 를 위에서 아래로 내려오는 방문은 추후 탐색에서 방문 불가능한 상태인것이다.</p>\n<p>그런데 빨간색 경로는 정확하게 <strong>(3,2)</strong> 로 내려오는 경로를 포함하고 있다. <code class=\"language-text\">visit[2][3][up]</code>을 체크하게 되는데, 이전 탐색인 파란색 경로에서 이미 <code class=\"language-text\">True</code>로 저장했기 때문에 방문할수 없게 되는 것이다. <strong>최소 비용</strong>이 아닌 경로가 미리 방문했기 때문에 <strong>최소 비용</strong>을 가지는 경로가 정상적인 탐색을 진행할 수 없게 되는 것이다.</p>\n<h4 id=\"그러면-어떻게\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%AC%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"그러면 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그러면 어떻게?</h4>\n<p>그러면 어떻게 해야하는 걸까 ? 모든 가능한 경로마다 방문했던 좌표를 기록해야 하나? 그러면 확실하게 답을 구할 수 있다. 파란색이 방문한 <strong>(3,2)</strong> 와 빨간색이 방문한 <strong>(3,2)</strong> 는 다르기 때문이다. 하지만 공간 복잡도가 지수만큼 증가하기에 적절하지 않다.</p>\n<p>문제를 다시 천천히 읽어보면, 각각의 좌표들에 대해서 <strong>최소 비용</strong>경로로 접근해야하는 것이다. 위의 예시를 다시 보면, <strong>(3,2)</strong> 를 방문할때 빨간색 경로의 비용과 파란색 경로의 비용을 비교하면 빨간색 경로의 비용이 더 적다. 그 말은 이미 파란색 경로에서 <strong>(3,2)</strong> 를 방문했더라도, 빨간색 경로가 더 적은 건설비용을 계산 할 수 있으면 <strong>(3,2)</strong> 를 재방문하게 해야 한다. <strong>조건적인 재방문을 허용할 필요가 있고 <code class=\"language-text\">visit</code> 배열을 재정의해야 한다.</strong></p>\n<h4 id=\"visit-배열의-dp적-특성\" style=\"position:relative;\"><a href=\"#visit-%EB%B0%B0%EC%97%B4%EC%9D%98-dp%EC%A0%81-%ED%8A%B9%EC%84%B1\" aria-label=\"visit 배열의 dp적 특성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>visit 배열의 DP적 특성</h4>\n<blockquote>\n<p><code class=\"language-text\">visit[y][x]</code> = (x,y)를 방문했을때의 비용, (x,y)를 방문할때 비용이 visit[y][x]보다 작거나 같으면 재방문 가능</p>\n</blockquote>\n<p>이렇게 정의하고 다시 문제를 보자. 모든 노드들간의 간선이  <strong>양의 가중치를 갖는</strong> 그래프에서의 <strong>DP와 BFS</strong>문제로 볼 수 있다.</p>\n<p>결국에 문제의 핵심은 <strong>(y,x)로 도착하는 최소 비용</strong> 경로가 새로 있다면, 중복 방문을 허용하는 아이디어다. 위에 살짝 언급한 아래 사례는 visit 배열의 특성을 생각하면 자명하게 풀린다.</p>\n<blockquote>\n<p>경주로가 계속 오른쪽으로 가다가 위,아래 방향으로 바꾸면 되면 코너가 생긴다는 것이다. (왜 왼쪽이 제외되었는가는 아래에서 설명하겠다.)</p>\n</blockquote>\n<p><strong>오른쪽</strong>으로만 가다가 <strong>왼쪽</strong>으로 방향을 트는 것은 , 왔던 곳을 되돌아 가는 것이고, <strong>모든 좌표끼리의 이동은 양의 가중치</strong>를 갖기 때문에 되돌아 갈때는 왔던 것보다 무조건 큰 비용을 갖기 때문에 왼쪽 방향으로 이동을 고려할 필요가 없는 것이다.</p>\n<p><strong><code class=\"language-text\">visit[y][x]</code>의 비용보다 같을때도 중복 방문을 허용</strong>해야 하는 이유가 뭘까?\n간단히 생각해서 최소비용 경로가 무조건 <strong>(3,3)</strong> 을 방문해야 한다고 해보자. <strong>(3,3)</strong> 을  직선으로 방문할때가 있고, 꺾어서 방문할때가 있다. 만약 <strong>(3,3)</strong> 을 방문하기 전까지의 둘의 비용이 같다고 할때 ,먼저 꺾어서 방문하게 되는 경우에는 추후에 추가적으로 코너 건설 비용이 500만큼 더 들기 때문에 <strong>최소 비용</strong> 거리가 아닐 수 있다. 그렇기에 비용이 같을때 방문을 막게 된다면 일직선으로 <strong>(3,3)</strong> 을 방문하는 최소비용 거리를 구할수 없다.</p>\n<p>나머지 부분은 단순 구현이기 때문에 설명은 생략한다.</p>\n<h3 id=\"풀이코드\" style=\"position:relative;\"><a href=\"#%ED%92%80%EC%9D%B4%EC%BD%94%EB%93%9C\" aria-label=\"풀이코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>풀이코드</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> deque\n<span class=\"token keyword\">def</span> <span class=\"token function\">solution</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    n<span class=\"token operator\">=</span><span class=\"token builtin\">len</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span>\n    answer <span class=\"token operator\">=</span> <span class=\"token number\">1e9</span>\n    <span class=\"token comment\"># 최단거리가 최소값이 아닐 수 있다. 하지만 근접하게 풀어야한다.</span>\n    \n    dy<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n    dx<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    \n    q<span class=\"token operator\">=</span>deque<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># visit 배열을 모두 INF로 채움</span>\n    visit<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">float</span><span class=\"token punctuation\">(</span><span class=\"token string\">'inf'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    \n    q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    \n    <span class=\"token keyword\">while</span> q<span class=\"token punctuation\">:</span>\n        y<span class=\"token punctuation\">,</span>x<span class=\"token punctuation\">,</span>cost<span class=\"token punctuation\">,</span>prev_dir<span class=\"token operator\">=</span>q<span class=\"token punctuation\">.</span>popleft<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\"># 도착했다면</span>\n        <span class=\"token keyword\">if</span> y<span class=\"token operator\">==</span>n<span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token keyword\">and</span> x<span class=\"token operator\">==</span>n<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\n            answer<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>answer<span class=\"token punctuation\">,</span>cost<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">continue</span>\n            \n        \n        <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token comment\"># 이전 방향과 다르다면 코너 건설비용이 추가로 듬</span>\n            curve_cost<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token keyword\">if</span> prev_dir<span class=\"token operator\">==</span>k <span class=\"token keyword\">else</span> <span class=\"token number\">500</span>\n            \n            new_cost<span class=\"token operator\">=</span>cost<span class=\"token operator\">+</span><span class=\"token number\">100</span><span class=\"token operator\">+</span>curve_cost\n\n            ny<span class=\"token punctuation\">,</span>nx<span class=\"token operator\">=</span>y<span class=\"token operator\">+</span>dy<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>x<span class=\"token operator\">+</span>dx<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\n            \n            <span class=\"token comment\"># (nx,ny) 방문시 이전 방문보다 적은 비용으로 방문하면</span>\n            <span class=\"token keyword\">if</span> <span class=\"token number\">0</span><span class=\"token operator\">&lt;=</span>ny<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">and</span> <span class=\"token number\">0</span><span class=\"token operator\">&lt;=</span>nx<span class=\"token operator\">&lt;</span>n <span class=\"token keyword\">and</span> board<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token operator\">!=</span><span class=\"token number\">1</span> <span class=\"token keyword\">and</span> new_cost<span class=\"token operator\">&lt;=</span>visit<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span>\n                visit<span class=\"token punctuation\">[</span>ny<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>nx<span class=\"token punctuation\">]</span><span class=\"token operator\">=</span>new_cost\n                q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span>nx<span class=\"token punctuation\">,</span>new_cost<span class=\"token punctuation\">,</span>k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token comment\"># 초기 출발시에는 방향이 없으니 무조건 코너를 돌게 하는데</span>\n    <span class=\"token comment\"># 불필요하게 500의 초과 비용이 발생하니 빼줘야함</span>\n    <span class=\"token keyword\">return</span> answer<span class=\"token operator\">-</span><span class=\"token number\">500</span>\n</code></pre></div>\n<blockquote>\n<p>백준 난이도로 환산하면 골드4 정도로 보인다.</p>\n</blockquote>\n<blockquote>\n<p>아주 깔끔하고 재밌는 문제였다. 30~40분 내로 풀이하면 적절하다.</p>\n</blockquote>\n<blockquote>\n<p>bottom up DP로 풀어도 충분히 답이 나올것같다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%A0%9C%EB%AA%A9\">문제 제목</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\">문제 설명</a></p>\n<ul>\n<li><a href=\"#%EC%A0%9C%ED%95%9C-%EC%82%AC%ED%95%AD\">제한 사항</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%98%88%EC%A0%9C-%EC%9E%85%EC%B6%9C%EB%A0%A5\">예제 입출력</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%92%80%EC%9D%B4\">풀이</a></p>\n<ul>\n<li><a href=\"#%EC%82%AC%EA%B3%A0%EC%9D%98-%EA%B3%BC%EC%A0%95\">사고의 과정</a></li>\n<li><a href=\"#visit-%EB%B0%B0%EC%97%B4%EC%97%90-%EC%9D%B4%EC%A0%84-%EB%B0%A9%ED%96%A5%EC%9D%B4-%ED%8F%AC%ED%95%A8%EB%90%98%EC%96%B4%EC%95%BC%ED%95%98%EB%82%98\">visit 배열에 이전 방향이 포함되어야하나?</a></li>\n<li><a href=\"#%ED%99%95%EC%8B%A4%ED%95%98%EA%B2%8C-%ED%8B%80%EB%A6%AC%EB%8A%94-%EB%B0%98%EB%A1%80\">확실하게 틀리는 반례</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9F%AC%EB%A9%B4-%EC%96%B4%EB%96%BB%EA%B2%8C\">그러면 어떻게?</a></li>\n<li><a href=\"#visit-%EB%B0%B0%EC%97%B4%EC%9D%98-dp%EC%A0%81-%ED%8A%B9%EC%84%B1\">visit 배열의 DP적 특성</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%92%80%EC%9D%B4%EC%BD%94%EB%93%9C\">풀이코드</a></p>\n</li>\n</ul>\n</div>","excerpt":"문제 제목 경주로 건설 문제 설명 \n건설회사의 설계사인 죠르디는 고객사로부터 자동차 경주로 건설에 필요한 견적을 의뢰받았습니다.\n제공된 경주로 설계 도면에 따르면 경주로 부지는 N x N 크기의 정사각형 격자 형태이며 각 격자는 1 x 1 크기입니다.\n설계 도면에는 각 격자의 칸은 0 또는 1 로 채워져 있으며, 0은 칸이 비어 있음을 1은 해당 칸이 벽으로 채워져 있음을 나타냅니다.\n경주로의 출발점은 (0, 0) 칸(좌측 상단)이며, 도착점은 (N-1, N-1) 칸(우측 하단)입니다. 죠르디는 출발점인 (0, 0) 칸에서 출발한 자동차가 도착점인 (N-1, N-1) 칸까지 무사히 도달할 수 있게 중간에 끊기지 않도록 경주로를 건설해야 합니다.\n경주로는 상, 하, 좌, 우로 인접한 두 빈 칸을 연결하여 건설할 수 있으며, 벽이 있는 칸에는 경주로를 건설할 수 없습니다.\n이때, 인접한 두 빈 칸을 상하 또는 좌우로 연결한 경주로를 직선 도로 라고 합니다.\n또한 두 직선 도로가 서로 …","frontmatter":{"date":"July 15, 2021","title":"프로그래머스 - 경주로 건설 (2020 카카오 인턴쉽)","categories":"PS","author":"weasel","emoji":"📓"},"fields":{"slug":"/programmers-build-race-road/"}},"next":{"id":"5ca018d3-2146-5d17-ad98-699a8e12e7f0","html":"<p><img src=\"/9146a4d3298760c2e7e49595184e1975/spring-logo-9146a4d3298760c2e7e49595184e1975.svg\" alt=\"\"></p>\n<blockquote>\n<p>본 글은 <a href=\"https://dimitr.im/spring-interface\">Do I need an interface with Spring boot?</a>을 번역한 글입니다.</p>\n</blockquote>\n<blockquote>\n<p>잘 쓰여진 글을 정리 하는 겸 한글로 공유하고 싶어서 번역했습니다.</p>\n</blockquote>\n<h2 id=\"들어가면서\" style=\"position:relative;\"><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B4%EC%84%9C\" aria-label=\"들어가면서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>들어가면서</h2>\n<p>Spring boot를 사용하다보면, 종종 <code class=\"language-text\">service</code> (<code class=\"language-text\">@Service</code> annotation을 붙인 bean)을 사용하게 된다. 인터넷 상의 많은 예시에서, 사람들이 <code class=\"language-text\">service</code>들을 위해서 <code class=\"language-text\">interface</code>를 사용하는 걸 볼 수 있을것이다. 예를 들어서 , 우리가 todo 어플리케이션을 만든다고 할때, <code class=\"language-text\">TodoService</code>라는 <code class=\"language-text\">interface</code>와 <code class=\"language-text\">TodoServiceImpl</code>이라는 구현체를 만들때가 있다.</p>\n<p>이 포스트에서, 우리는 왜 그런 것을 하는지와 필요한가에 대해서 알아볼 것이다.</p>\n<h2 id=\"짧은-결론은\" style=\"position:relative;\"><a href=\"#%EC%A7%A7%EC%9D%80-%EA%B2%B0%EB%A1%A0%EC%9D%80\" aria-label=\"짧은 결론은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>짧은 결론은</h2>\n<p>짧은 결론은 꽤나 간단하다. ** <code class=\"language-text\">interface</code>를 만들 필요 없다. ** <code class=\"language-text\">service</code>를 만든다고 하면, class의 자체의 이름을 <code class=\"language-text\">TodoService</code>라고 하고 <code class=\"language-text\">autowire</code>를 통해서 bean들에 주입하면 된다. 예를 들어서 이런 코드가 있다고 해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: Implement</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>service <span class=\"token operator\">=</span> service<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span> </code></pre></div>\n<p>위에 있는 예시는 <code class=\"language-text\">@Autowired</code>를 이용한 field injection을 사용하던 생성자 주입을 사용하던간에 <strong>작동</strong>할 것이다.</p>\n<h2 id=\"그럼-왜-신경써야할까\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%99%9C-%EC%8B%A0%EA%B2%BD%EC%8D%A8%EC%95%BC%ED%95%A0%EA%B9%8C\" aria-label=\"그럼 왜 신경써야할까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그럼 왜 신경써야할까?</h2>\n<p>만약, 우리가 그게 필요하지 않다면… 왜 그런 방식(<code class=\"language-text\">inteface</code>를 이용한 방식)을 종종 쓰곤 할까? 음, 첫 번째 이유는 사실 좀 역사적인것이다. 하지만 그걸 살펴보기 전에 , Spring에서 annotation이 어떻게 작동하는지를 설명해야만 한다.</p>\n<p>만약 <code class=\"language-text\">@Cacheable</code>같은 annotation을 사용한다고 하면, cache에서 결과를 얻을것이라고 예상할 수 있다. Spring에서 그것이 작동되는 방식은 bean들을 위한 proxy를 만들고 그 proxy들에 필요한 로직을 추가해주는것이다. 원래 스프링은 JDK dynamic proxies를 사용했다. 이 dynamic proxies는 오직 <code class=\"language-text\">interface</code>들만을 위해서 만들어졌고, 이것이 예전에는 <code class=\"language-text\">interface</code>를 작성해줘야 했던 이유다.</p>\n<p>그러나, 10여 년 전부터 , Spring이 CGLIB proxying도 지원하기 시작했다. 이 proxy들은 <strong>별도의</strong> <code class=\"language-text\">interface</code>를 필요로 하지 않는다. 심지어 Spring 3.2 버전부터는 CGLIB가 Spring에 내장되어 있어서 별도로 추가해줄 필요도 없다.</p>\n<h2 id=\"느슨한-결합\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EC%8A%A8%ED%95%9C-%EA%B2%B0%ED%95%A9\" aria-label=\"느슨한 결합 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느슨한 결합</h2>\n<p>아마 두 번째 이유는 두 class 간의 느슨한 결합을 만들기 위해서 일 것이다. <code class=\"language-text\">interface</code>를 사용함으로써, <code class=\"language-text\">service</code>에 의존하는 class는 더 이상 <code class=\"language-text\">service</code>의 구현에 의존하지 않게 된다. 이것이 <code class=\"language-text\">service</code>를 독립적으로 사용할 수 있게 해준다. 예를 들어서 이런 코드가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoServiceImpl</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: Implement</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>service <span class=\"token operator\">=</span> service<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러나 위의 예시에서, 개인적인 의견으로 <code class=\"language-text\">TodoFacade</code>와 <code class=\"language-text\">TodoServiceImpl</code>이 함께 한다고 생각한다. 여기서 <code class=\"language-text\">interface</code>를 추가하는건 추가적인 복잡도를 늘릴 수 있다. 개인적으로, 그만한 가치는 없어 보인다.</p>\n<h2 id=\"여러-방식의-구현\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EB%9F%AC-%EB%B0%A9%EC%8B%9D%EC%9D%98-%EA%B5%AC%ED%98%84\" aria-label=\"여러 방식의 구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여러 방식의 구현</h2>\n<p>느슨한 결합이 유용한 부분은 여러 가지 구현체를 가질 때이다. 예를 들어서 TodoService가 두 가지 구현체를 가진다고 해보자. 하나는 todo 리스트를 메모리에서 가져오는 것이고, 하나는 DB와 같은 곳에서 가져오는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">InMemoryTodoServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: Implement</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseTodoServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: Implement</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>service <span class=\"token operator\">=</span> service<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이런 경우에선 느슨한 결합이 매우 유용한데, <code class=\"language-text\">TodoFacade</code>가 todo가 메모리에 저장되어 있는지 DB에 저장되어 있는지 알 필요 없기 때문이다. 그건 <code class=\"language-text\">Facade</code>의 책임이 아니라 어플리케이션 설정의 책임이다.</p>\n<p>원하는 것에 따라서 구현방식은 달라진다. 만약에 <code class=\"language-text\">TodoFacade</code>가 모든 구현체를 호출해야 한다면, <code class=\"language-text\">collection</code>을 주입해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TodoService</span><span class=\"token punctuation\">></span></span> services<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TodoService</span> services<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>services <span class=\"token operator\">=</span> services<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>만약 구현체 중에 하나가 99%의 상황에서 사용되고 나머지들은 아주 특수한 경우에만 사용된다면, <code class=\"language-text\">@Primary</code>를 사용해라.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Primary</span>\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseTodoServiceImpl</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">TodoService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Todo</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: Implement</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">@Primary</code>를 사용함으로써, Spring container에게 <code class=\"language-text\">TodoService</code>에 의존성 주입을 해야할때, 이 구현체를 사용하라고 알려주는 것이다. 만약 다른 걸 사용해야 한다면, <code class=\"language-text\">@Qualifier</code>를 사용하거나 특정 구현체를 주입함으로써 <strong>명시적으로</strong> 설정해야 한다. 개인적으로 난 이런 방식을 분리된 <code class=\"language-text\">@Configuration</code> class에서 사용하는데, 그렇지 않으면 , <code class=\"language-text\">TodoFacade</code>를 또 다시 구현체에 관한 정보들로 오염시키기 때문이다.</p>\n<p>예시 코드를 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoConfiguration</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token comment\">// Using @Qualifier</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token function\">todoFacade</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Qualifier</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"inMemoryTodoService\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token comment\">// Or by using the specific implementation</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">TodoFacade</span> <span class=\"token function\">todoFacade</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InMemoryTodoService</span> service<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"제어의-역전\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%EC%96%B4%EC%9D%98-%EC%97%AD%EC%A0%84\" aria-label=\"제어의 역전 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제어의 역전</h2>\n<p>느슨한 결합의 또 다른 방식은 <strong>IoC</strong> 혹은 <strong>제어의 역전</strong>이다. 개인적으로 서로에게 의존하는 여러 가지 module을 사용할 때 제어의 역전이 유용했다. 예를 들어서 <code class=\"language-text\">OrderService</code>와 <code class=\"language-text\">CustomerService</code>가 있다고 해보자. Customer는 자신의 profile을 삭제할 수 있고 그때 pending 상태의 order들은 취소되어야 한다. <code class=\"language-text\">interface</code> 없이 구현했다면, 이런 방식으로 할것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancelOrdersForCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: implement</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomerService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>orderService <span class=\"token operator\">=</span> orderService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">cancelOrdersForCustomer</span><span class=\"token punctuation\">(</span>customerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// TODO: implement</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 한다면, 상황은 매우 나빠질 수 있다. 어플리케이션 내부의 domain들이 모두 결합되게 되고, 결과적으로 강하게 결합된 어플리케이션을 만들게 될것이다.</p>\n<p>그러는 대신에, <code class=\"language-text\">CustomerDeletionListener</code>라는 <code class=\"language-text\">interface</code>를 만들 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">CustomerDeletionListener</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">onDeleteCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomerService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CustomerDeletionListener</span><span class=\"token punctuation\">></span></span> deletionListeners<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">CustomerService</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CustomerDeletionListener</span><span class=\"token punctuation\">></span></span> deletionListeners<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>deletionListeners <span class=\"token operator\">=</span> deletionListeners<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deleteCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        deletionListeners<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>listener <span class=\"token operator\">-></span> listener<span class=\"token punctuation\">.</span><span class=\"token function\">onDeleteCustomer</span><span class=\"token punctuation\">(</span>customerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token comment\">// TODO: implement</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">cancelOrdersForCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// TODO: implement</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderCustomerDeletionListener</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">CustomerDeletionListener</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">OrderCustomerDeletionListener</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>orderService <span class=\"token operator\">=</span> orderService<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onDeleteCustomer</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ID</span> customerId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">cancelOrdersForCustomer</span><span class=\"token punctuation\">(</span>customerId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>예시를 보면, 제어의 역전이 일어난 것을 볼 수 있다. 첫 번째 예시에서 우리가 <code class=\"language-text\">OrderService</code> 안에 있는 <code class=\"language-text\">cancelOrderForCustomer()</code>를 바꾸면, <code class=\"language-text\">CustomerService</code> 역시 바뀌어야 한다. 이 말은 <code class=\"language-text\">OrderService</code>가 제어되고 있다는 것을 말한다.</p>\n<p>두 번째 예시에서는 <code class=\"language-text\">OrderService</code>가 제어되고 있지 않다. 우리가 <code class=\"language-text\">cancelOrderForCustomer()</code>를 변화시키면, 다른 module의 일부인 오직 <code class=\"language-text\">OrderCustomerDeletionListener</code>만 바뀌어야 한다. 이것은 <code class=\"language-text\">CustomerService</code>가 제어하고 있음을 말한다. 또, 두 <code class=\"language-text\">service</code>들은 느슨하게 결합되어 있기 때문에, 하나가 다른 하나에 직접적으로 의존하고 있지 않다.</p>\n<p>비록 두 번째 방법이 복잡도를 더 늘리긴 하지만 (<code class=\"language-text\">class</code>와 <code class=\"language-text\">interface</code>가 각각 한개씩 늘었으니) domain들이 서로 결합되지 않게 해준다. 리팩토링 하기가 쉬워지는 것이다. 이 <code class=\"language-text\">listener</code>는 <code class=\"language-text\">event-driven</code>한 구조로 리팩토링 될 수 있다. domain-driven modular design이나 MSA같은 구조로 리팩토링하기 쉽게 해주는 것이다.</p>\n<h2 id=\"test\" style=\"position:relative;\"><a href=\"#test\" aria-label=\"test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test</h2>\n<p>마지막으로 말하고 싶은 건 테스트다. 몇몇 사람들은 dummy 구현체를 가지기 위해서 (여러 구현체를 가질 수 있으니) <code class=\"language-text\">interface</code>가 필요하다고 주장하곤 한다. 하지만 <strong>Mockito</strong>같은 mocking 라이브러리가 이 문제를 해결해 준다.</p>\n<p>단위 테스트를 작성할 때, <code class=\"language-text\">MockitoExtension</code>을 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ExtendWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MockitoExtension</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacadeTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoFacade</span> facade<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@Mock</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@BeforeEach</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>facade <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// TODO: implement tests</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 방법은 <code class=\"language-text\">service</code>가 무엇을 하는지 몰라도 <code class=\"language-text\">facade</code>를 적절히 테스트할 수 있게 해준다. <code class=\"language-text\">Mockito.when()</code>을 사용함으로써 <code class=\"language-text\">service</code> mock이 무엇을 반환하게 하는지 제어할 수 있고, <code class=\"language-text\">Mockito.verfiy()</code>를 사용함으로써 특정 method가 호출되었는지 확인할 수 있다.\n예시 코드다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">findAll_shouldUseServicefindAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Todo</span> todo <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Todo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">when</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">.</span><span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">thenReturn</span><span class=\"token punctuation\">(</span>todo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>facade<span class=\"token punctuation\">.</span><span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">containsOnly</span><span class=\"token punctuation\">(</span>todo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">verify</span><span class=\"token punctuation\">(</span>service<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">findAllTodos</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>심지어 Spring container를 필요로 하는 통합 테스트를 작성할때도,<code class=\"language-text\">@MockBean</code> annotation을 이용해서 bean들을 mock할 수 있다. 실제 구현체가 있는 package를 탐색하지 않게 해라.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ExtendWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">SpringExtension</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>classes <span class=\"token operator\">=</span> <span class=\"token class-name\">TodoFacade</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TodoFacadeTest</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoFacade</span> facade<span class=\"token punctuation\">;</span>\n    <span class=\"token annotation punctuation\">@MockBean</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">TodoService</span> service<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그러니까 대부분의 경우에서, 테스트 할때 <code class=\"language-text\">interface</code>는 필요하지 않다.</p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>만약 개인적으로 <code class=\"language-text\">interface</code>를 <code class=\"language-text\">serivce</code>에 사용해야 하냐는 질문을 받는다면, 내 대답은 <strong>아니오</strong>다. 유일한 예외는 제어의 역전을 사용하거나 여러개의 구현체를 신경써야 하는 경우다.</p>\n<p>만약의 경우를 위해서 <code class=\"language-text\">interface</code>를 만드는 게 좋지 않겠냐고 생각할 수 있다. 개인적으로 여전히 <strong>아니오</strong>다. 첫 번째로, “You aren’t going to need it”(YAGNI) 라는 원칙을 믿는다. <em>필요할지도 몰라</em> 라는 이유로 복잡성을 높일 이유는 없는데 , 일반적으로 <strong>필요하지 않기</strong> 때문이다. 두 번째로 필요한 경우라도 전혀 문제 없다. 대부분의 IDE들은 기존의 class에서 method만 추출해서 <code class=\"language-text\">interface</code>를 만들수 있게 해주고, 모든 코드들을 그 <code class=\"language-text\">interface</code>를 사용하게끔 순식간에 만든다.</p>\n<h3 id=\"참고하면-좋은-자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%80-%EC%9E%90%EB%A3%8C\" aria-label=\"참고하면 좋은 자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고하면 좋은 자료</h3>\n<p><a href=\"https://gmoon92.github.io/spring/aop/2019/04/20/jdk-dynamic-proxy-and-cglib.html\">JDK Dynamic Proxy와 CGLIB의 차이점은 무엇일까?</a>\n<a href=\"https://jusungpark.tistory.com/23\">퍼사드 패턴</a>\n<a href=\"https://swk3169.tistory.com/185\">느슨한 결합 vs 긴밀한 결합</a>\n<a href=\"https://medium.com/@gorali/how-mockito-works-7d3a2c77da71\">How Mockito Works?</a>\n<a href=\"https://blog.naver.com/PostView.nhn?isHttpsRedirect=true&#x26;blogId=complusblog&#x26;logNo=221163007357&#x26;redirect=Dlog&#x26;widgetTypeCall=true&#x26;directAccess=false\">소프트웨어 개발 3대 원칙 : KISS,YAGNI,DRY</a></p>\n<blockquote>\n<p>스프링 부트에 <code class=\"language-text\">interface</code>가 필요한가에 대해서는 당연히 <strong>YES</strong>지만 이 글에선 <strong><code class=\"language-text\">service</code>에 <code class=\"language-text\">interface</code></strong> 가 필요한지, 정확히 말하면 <code class=\"language-text\">service</code>의 구현체가 필요한지에 대해서 논하고 있습니다.</p>\n</blockquote>\n<blockquote>\n<p>프로젝트를 시작하면서 Spring boot에서 구현체와 인터페이스를 구분해야하는지 고민이 많았는데 꽤나 자세하고 명쾌해서 도움이 되었습니다.</p>\n</blockquote>\n<blockquote>\n<p>소프트웨어공학 수업에서 배운 YAGNI를 실제로 보니까 반갑네요. 그냥 무지성으로 외웠는데..</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%93%A4%EC%96%B4%EA%B0%80%EB%A9%B4%EC%84%9C\">들어가면서</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A7%A7%EC%9D%80-%EA%B2%B0%EB%A1%A0%EC%9D%80\">짧은 결론은</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%99%9C-%EC%8B%A0%EA%B2%BD%EC%8D%A8%EC%95%BC%ED%95%A0%EA%B9%8C\">그럼 왜 신경써야할까?</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8A%90%EC%8A%A8%ED%95%9C-%EA%B2%B0%ED%95%A9\">느슨한 결합</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%97%AC%EB%9F%AC-%EB%B0%A9%EC%8B%9D%EC%9D%98-%EA%B5%AC%ED%98%84\">여러 방식의 구현</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C%EC%96%B4%EC%9D%98-%EC%97%AD%EC%A0%84\">제어의 역전</a></p>\n</li>\n<li>\n<p><a href=\"#test\">Test</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></p>\n<ul>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%ED%95%98%EB%A9%B4-%EC%A2%8B%EC%9D%80-%EC%9E%90%EB%A3%8C\">참고하면 좋은 자료</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"July 15, 2021","title":"Spring Boot에서 interface를 사용해야 할까? (Do I need an interface with Spring boot?)","categories":"Spring","author":"weasel","emoji":"📓"},"fields":{"slug":"/do-i-need-an-interface-with-spring-boot/"}},"prev":{"id":"ebd8884b-23b5-5248-869a-2e0428b7f545","html":"<h2 id=\"문제-상황\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\" aria-label=\"문제 상황 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 상황</h2>\n<p><a href=\"https://www.acmicpc.net/problem/3109\">백준 빵집</a>를 풀때 이상한 점이 확실히 생겼다.  일반적으로 python에서 방문 여부를 확인하기 위해 <code class=\"language-text\">set</code>과 <code class=\"language-text\">list</code>중에 하나를 사용한다.\n<code class=\"language-text\">set</code>같은 경우는 잘못된 접근 같은 행동에서 안전한 편이고 대부분의 기능에서 <code class=\"language-text\">O(1)</code>의 시간이 보장된다고 알고 있기 때문에 <code class=\"language-text\">set</code>을 이용한 풀이를 종종했다.</p>\n<blockquote>\n<p>List에서는 미숙한 코드로 indexError를 경험할 수 있다.</p>\n</blockquote>\n<p>이 문제는 naive 하게 <code class=\"language-text\">set</code>을 사용하면 시간초과를 당한다. 처음엔 논리를 잘못 구성해 recursionDepth가 커져서 시간초과가 나는건가 라고 생각했지만 논리에는 문제가 없었다. 그래서 <code class=\"language-text\">set</code>만을 <code class=\"language-text\">list</code>로 바꿔주었더니 통과했다.</p>\n<p>분명 <code class=\"language-text\">lookup</code>도 똑같이 <code class=\"language-text\">O(1)</code>이고 <code class=\"language-text\">set</code>에서는 <code class=\"language-text\">add</code>도 <code class=\"language-text\">O(1)</code>이라고 알고 있는데 왜 차이가 나는 것일까? 이 이해 안되는 상황을 지금부터 알아보자.</p>\n<h3 id=\"메모리-사용량\" style=\"position:relative;\"><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%EB%9F%89\" aria-label=\"메모리 사용량 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>메모리 사용량</h3>\n<p>먼저 간단하게 두 자료구조의 메모리 사용량을 비교해보았다.</p>\n<p>아래 코드는 10000개의 행 , 500개의 열을 가진 2차원 board에서 사용되는 방문을 기록하는 일반적인 구현이다.</p>\n<p>하나는 <code class=\"language-text\">List</code>로 하나는 <code class=\"language-text\">set</code>으로 구현한 뒤 <code class=\"language-text\">sys.getsizeof(object)</code>를 이용해서 각각의 객체의 메모리 사용량을 체크해보았다.</p>\n<blockquote>\n<p>getsizeof(object [, default]) -> int : Return the size of object in <strong>bytes</strong>.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">R<span class=\"token operator\">=</span><span class=\"token number\">10000</span> <span class=\"token comment\"># ROW</span>\nC<span class=\"token operator\">=</span><span class=\"token number\">500</span>\t<span class=\"token comment\"># COL</span>\n\na<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token boolean\">True</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nsys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token number\">4264</span>\n\nb<span class=\"token operator\">=</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        b<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\nsys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token number\">134217944</span>\n</code></pre></div>\n<p><strong>놀라운 결과</strong>다. 같은 기능을 수행하는 서로 다른 자료구조인데 메모리차이가 대략 <strong>31,000</strong>배 정도의 차이를 보였다.</p>\n<p><code class=\"language-text\">list</code>는 <strong>4264 Byte</strong>, <code class=\"language-text\">set</code>은 <strong>134217944 Byte</strong>를 사용한다. 대략적으로 두 자료구조는 각각 <strong>4KB,134MB</strong>을 사용한다는 것이다.</p>\n<h2 id=\"list와-set의-내부구조\" style=\"position:relative;\"><a href=\"#list%EC%99%80-set%EC%9D%98-%EB%82%B4%EB%B6%80%EA%B5%AC%EC%A1%B0\" aria-label=\"list와 set의 내부구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>List와 Set의 내부구조</h2>\n<p>왜 이렇게 차이가 나는 것일까?</p>\n<p><code class=\"language-text\">list</code>와 <code class=\"language-text\">set</code>이 내부적으로 <strong>데이터를 저장하는 방식</strong>에서 차이가 있어서 그렇다. <a href=\"https://stackoverflow.com/questions/39914266/memory-consumption-of-a-list-and-set-in-python\">stackoverflow의 한 답변</a>에 따르면</p>\n<h3 id=\"list\" style=\"position:relative;\"><a href=\"#list\" aria-label=\"list permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>List</h3>\n<blockquote>\n<p>List는 그저 원래의 객체들에 대한 참조를 모아놓은것에 불과하다. 만약 1000개의 integer를 만든다고 하면 , 그것들이 만들어지고 list는 오직 그 integer들에 대한 참조만을 담고 있다.</p>\n</blockquote>\n<p><code class=\"language-text\">list</code>는 참조들의 <code class=\"language-text\">collection</code>이고 일종의 주솟값을 가지고 있는것이다. 그렇기에 아래와 같은 코드를 수행해도 여전히 <strong>4264 Byte</strong>다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">c<span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nsys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span> <span class=\"token number\">4264</span></code></pre></div>\n<p><code class=\"language-text\">list</code>가 세번 중첩되어 있지만 <code class=\"language-text\">[1,2,3]</code>에 대한 <strong>참조</strong>만을 가지고 있기 때문에 메모리 사용량이 같은 것이다.</p>\n<blockquote>\n<p>내부적으로는 <a href=\"https://en.wikipedia.org/wiki/Dynamic_array\">dynamic array</a>를 사용하고 있다.</p>\n</blockquote>\n<h3 id=\"set\" style=\"position:relative;\"><a href=\"#set\" aria-label=\"set permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set</h3>\n<p>반대로 <code class=\"language-text\">set</code>은 어떨까? Python에서의 <code class=\"language-text\">set</code>은 내부적으로 <strong>key가 dummy value인 <code class=\"language-text\">dict</code></strong> 를 상당 부분 재사용함으로써 <strong><code class=\"language-text\">hash table</code></strong> 의 구조를 가지고 있다.</p>\n<p>여전히 위의 같은 답변을 참고하자면</p>\n<blockquote>\n<p>반면에, set이나 dictionary는 1000개의 integer들의 hash value를 모두 계산해야하고 그에 따라 메모리 사용량이 증가한다.</p>\n</blockquote>\n<blockquote>\n<p>예를 들어 set이나 dict나 가장 작은 크기의 기본값은 8이다.(즉, 오직 3개의 값만 저장한다해도 python은 8개를 지정해준다.) <code class=\"language-text\">resize</code>를 할때, buckets들의 개수는 요소가 50,000개가 되기 전까지는 4배씩 증가한다. 그런 다음에는 2배씩 증가한다.</p>\n</blockquote>\n<h2 id=\"set에서의-resize\" style=\"position:relative;\"><a href=\"#set%EC%97%90%EC%84%9C%EC%9D%98-resize\" aria-label=\"set에서의 resize permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set에서의 resize</h2>\n<p>과연 정말 그렇게 작동할까? <code class=\"language-text\">resize</code>는 <code class=\"language-text\">set</code>에 일반적으로 값을 추가할 때 호출되기 때문에 <code class=\"language-text\">add</code>를 할때 호출되는 CPython의 <code class=\"language-text\">set</code>의 <code class=\"language-text\">set_add_entry</code>의 구현 코드를 직접 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* CPython */</span>\n<span class=\"token comment\">/* https://github.com/python/cpython/blob/main/Objects/setobject.c */</span> \n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span>\n<span class=\"token function\">set_add_entry</span><span class=\"token punctuation\">(</span>PySetObject <span class=\"token operator\">*</span>so<span class=\"token punctuation\">,</span> PyObject <span class=\"token operator\">*</span>key<span class=\"token punctuation\">,</span> Py_hash_t hash<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  found_unused<span class=\"token operator\">:</span>\n    so<span class=\"token operator\">-></span>fill<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    so<span class=\"token operator\">-></span>used<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n    entry<span class=\"token operator\">-></span>key <span class=\"token operator\">=</span> key<span class=\"token punctuation\">;</span>\n    entry<span class=\"token operator\">-></span>hash <span class=\"token operator\">=</span> hash<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>so<span class=\"token operator\">-></span>fill<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">&lt;</span> mask<span class=\"token operator\">*</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">set_table_resize</span><span class=\"token punctuation\">(</span>so<span class=\"token punctuation\">,</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">></span><span class=\"token number\">50000</span> <span class=\"token operator\">?</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">2</span> <span class=\"token operator\">:</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>위의 코드에서 <a href=\"https://www.geeksforgeeks.org/load-factor-and-rehashing/\">load factor</a>가 일정 부분(아래서 다시 언급할 것이다.)을 넘어갈때를 보자.\n(<code class=\"language-text\">if ((size_t)so->fill*5 &lt; mask*3)</code> 의 아랫부분이다.)\nso(set object)의 크기에 따라 <code class=\"language-text\">set_table_resize</code>의 <strong>인자를 다르게</strong> 주고 있음이 보인다.</p>\n<blockquote>\n<p><strong>Load factor</strong> : Hash table 전체에서 얼마나 원소가 차 있는지를 나타내는 수치.</p>\n</blockquote>\n<p>m개의 bucket의 Hash tablen에 n개의 원소가 저장되어 있다면 load_factor = n/m 이다</p>\n<p><strong><code class=\"language-text\">so->used</code>가 50,000이 넘어가면 현재 used의 2배를, 그렇지 않으면 4배만큼 큰 값으로 <code class=\"language-text\">resize</code>를 하는 것이다.</strong></p>\n<blockquote>\n<p>여기서 mask는 <code class=\"language-text\">hash_table</code>의 크기보다 1 작다. modulo의 역할처럼 hash에 쓰이는데 AND 연산을 이용한다.</p>\n</blockquote>\n<h3 id=\"resize의-내부동작-방식\" style=\"position:relative;\"><a href=\"#resize%EC%9D%98-%EB%82%B4%EB%B6%80%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\" aria-label=\"resize의 내부동작 방식 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>resize의 내부동작 방식</h3>\n<p>이제 <code class=\"language-text\">set_table_resize</code>가 내부적으로 어떻게 동작하는지를 살펴보자.</p>\n<p><strong>요약하자면 <code class=\"language-text\">set_table_resize</code>는 <code class=\"language-text\">hash table</code>의 구조를 가지는 <code class=\"language-text\">setentry</code> 구조체를 기존 <code class=\"language-text\">oldtable</code>의 2배 혹은 4배의 크기인 <code class=\"language-text\">newtable</code>이라는 이름으로 동적할당 받은 후 <code class=\"language-text\">oldtable</code>의 모든 <code class=\"language-text\">entry</code>들을 <code class=\"language-text\">newtable</code>에 넣어주는 과정을 거친다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">{</span>\n    PyObject <span class=\"token operator\">*</span>key<span class=\"token punctuation\">;</span>\n    Py_hash_t hash<span class=\"token punctuation\">;</span>             <span class=\"token comment\">/* Cached hash code of the key */</span>\n<span class=\"token punctuation\">}</span> setentry<span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>이해가 안가도 당황하지 마세요… 아래서 차근차근 설명해줄거에요…😅</p>\n</blockquote>\n<p>단계별로 살펴보자. 아래 코드부터다.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* CPython */</span>\n<span class=\"token comment\">/* https://github.com/python/cpython/blob/main/Objects/setobject.c */</span> \n<span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span>\n<span class=\"token function\">set_table_resize</span><span class=\"token punctuation\">(</span>PySetObject <span class=\"token operator\">*</span>so<span class=\"token punctuation\">,</span> Py_ssize_t minused<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    setentry <span class=\"token operator\">*</span>oldtable<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>newtable<span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>entry<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token comment\">/* Find the smallest table size > minused. */</span>\n    <span class=\"token comment\">/* XXX speed-up with intrinsics */</span>\n    <span class=\"token class-name\">size_t</span> newsize <span class=\"token operator\">=</span> PySet_MINSIZE<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span>newsize <span class=\"token operator\">&lt;=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>minused<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        newsize <span class=\"token operator\">&lt;&lt;=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// The largest possible value is PY_SSIZE_T_MAX + 1.</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>일단, <code class=\"language-text\">newtable</code>의 크기를 정해야 한다. <code class=\"language-text\">set_table_resize</code>의 두번째 인자만큼\n<code class=\"language-text\">newsize</code>를 left shift를 사용해 <code class=\"language-text\">Pyset_MINSIZE</code>에서 <code class=\"language-text\">minused</code>만큼 증가시킨다.\n(<code class=\"language-text\">PySet_MINSIZE</code>는 위에 언급한 것처럼 <strong>8</strong>이다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* CPython */</span>\n<span class=\"token comment\">/* https://github.com/python/cpython/blob/main/Objects/setobject.c */</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token comment\">/* Get space for a new table. */</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newsize <span class=\"token operator\">==</span> PySet_MINSIZE<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token comment\">/* A large table is shrinking, or we can't get any smaller. */</span>\n    \t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        newtable <span class=\"token operator\">=</span> <span class=\"token function\">PyMem_NEW</span><span class=\"token punctuation\">(</span>setentry<span class=\"token punctuation\">,</span> newsize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>newtable <span class=\"token operator\">==</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">PyErr_NoMemory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">return</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">newsize</code>가 <code class=\"language-text\">PySet_MINSIZE</code>(8)가 아닐때, <code class=\"language-text\">PyMem_New(type,n)</code>를 통해서 위에서 계산된 <code class=\"language-text\">newsize</code>의 크기만큼 <code class=\"language-text\">setentry</code>의 객체를 생성하는 것이다.</p>\n<blockquote>\n<p>좀 더 엄밀하게 얘기하면 <code class=\"language-text\">PyMem_new(type,n)</code>는 <code class=\"language-text\">PyMem_Malloc(n)</code>를 이용해서 <code class=\"language-text\">(n)*sizeof(type)</code> Byte만큼의 메모리를 동적할당(malloc) 하는 macro다. (cpython/include/pymem.h 참조)</p>\n</blockquote>\n<p><strong>이제 거의 다 왔다. <code class=\"language-text\">oldtable</code>들의 값들을 <code class=\"language-text\">newtable</code>에 옮겨주기만 하면 된다.</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* CPython */</span>\n<span class=\"token comment\">/* https://github.com/python/cpython/blob/main/Objects/setobject.c */</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    so<span class=\"token operator\">-></span>mask <span class=\"token operator\">=</span> newsize <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    so<span class=\"token operator\">-></span>table <span class=\"token operator\">=</span> newtable<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></code></pre></div>\n<p>hashing에 필요한 mask 값을 갱신해주고 (modulo와 비슷한 역할을 한다. 다만 <strong>AND 연산자</strong>를 사용할뿐이다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\"><span class=\"token comment\">/* CPython */</span>\n<span class=\"token comment\">/* https://github.com/python/cpython/blob/main/Objects/setobject.c */</span>\n    <span class=\"token comment\">/* Copy the data over; this is refcount-neutral for active entries;\n       dummy entries aren't copied over, of course */</span>\n    newmask <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>so<span class=\"token operator\">-></span>mask<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>so<span class=\"token operator\">-></span>fill <span class=\"token operator\">==</span> so<span class=\"token operator\">-></span>used<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>entry <span class=\"token operator\">=</span> oldtable<span class=\"token punctuation\">;</span> entry <span class=\"token operator\">&lt;=</span> oldtable <span class=\"token operator\">+</span> oldmask<span class=\"token punctuation\">;</span> entry<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token operator\">-></span>key <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">set_insert_clean</span><span class=\"token punctuation\">(</span>newtable<span class=\"token punctuation\">,</span> newmask<span class=\"token punctuation\">,</span> entry<span class=\"token operator\">-></span>key<span class=\"token punctuation\">,</span> entry<span class=\"token operator\">-></span>hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        so<span class=\"token operator\">-></span>fill <span class=\"token operator\">=</span> so<span class=\"token operator\">-></span>used<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>entry <span class=\"token operator\">=</span> oldtable<span class=\"token punctuation\">;</span> entry <span class=\"token operator\">&lt;=</span> oldtable <span class=\"token operator\">+</span> oldmask<span class=\"token punctuation\">;</span> entry<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>entry<span class=\"token operator\">-></span>key <span class=\"token operator\">!=</span> <span class=\"token constant\">NULL</span> <span class=\"token operator\">&amp;&amp;</span> entry<span class=\"token operator\">-></span>key <span class=\"token operator\">!=</span> dummy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">set_insert_clean</span><span class=\"token punctuation\">(</span>newtable<span class=\"token punctuation\">,</span> newmask<span class=\"token punctuation\">,</span> entry<span class=\"token operator\">-></span>key<span class=\"token punctuation\">,</span> entry<span class=\"token operator\">-></span>hash<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">newmask</code> 를 이용해서 <code class=\"language-text\">oldtable</code>안의 기존의 값들을 <code class=\"language-text\">newtable</code>에 <code class=\"language-text\">set_insert_clean</code>을 이용해 넣어준다.</p>\n<p><strong>이런 복잡한 과정들을 거쳐서 <code class=\"language-text\">set</code>에서 <code class=\"language-text\">resize</code>가 진행되는 것이다.</strong></p>\n<h3 id=\"그래서-얼마나-걸리는데\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%BC%EB%A7%88%EB%82%98-%EA%B1%B8%EB%A6%AC%EB%8A%94%EB%8D%B0\" aria-label=\"그래서 얼마나 걸리는데 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그래서 얼마나 걸리는데?</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">b<span class=\"token operator\">=</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        b<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>위 문제에선 <code class=\"language-text\">set</code>이 최대 몇 번 <code class=\"language-text\">resize</code>를 할까? <code class=\"language-text\">resize</code> 전 후로 <code class=\"language-text\">b</code>의 메모리 크기가 달라지니 아래와 같은 코드로 확인 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">resize_count<span class=\"token operator\">=</span><span class=\"token number\">0</span>\nprev<span class=\"token operator\">=</span>cur_size<span class=\"token operator\">=</span>sys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        b<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">if</span> prev<span class=\"token operator\">!=</span>sys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            prev<span class=\"token operator\">=</span>cur_size\n            resize_count<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n            \n<span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>resize_count<span class=\"token punctuation\">)</span>\n<span class=\"token operator\">>></span><span class=\"token operator\">></span><span class=\"token number\">13</span></code></pre></div>\n<p><strong>13번 resize를 한다. 그럼 그때마다 내부 구조인 <code class=\"language-text\">hash table</code>의 bucket은 언제 , 그리고 얼만큼 늘어날까?</strong></p>\n<h3 id=\"set의-load-factor\" style=\"position:relative;\"><a href=\"#set%EC%9D%98-load-factor\" aria-label=\"set의 load factor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Set의 load factor</h3>\n<p>아래와 같은 코드로 확인 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">element_count<span class=\"token operator\">=</span><span class=\"token number\">0</span>\nprev<span class=\"token operator\">=</span>cur_size<span class=\"token operator\">=</span>sys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">for</span> j <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span>C<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        s<span class=\"token operator\">=</span>time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        b<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span>j<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        element_count<span class=\"token operator\">+=</span><span class=\"token number\">1</span>\n        <span class=\"token keyword\">if</span> prev<span class=\"token operator\">!=</span>sys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            cur_size<span class=\"token operator\">=</span>sys<span class=\"token punctuation\">.</span>getsizeof<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"resize at \"</span><span class=\"token operator\">+</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>element_count<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            prev<span class=\"token operator\">=</span>cur_size\n            \n<span class=\"token operator\">>></span><span class=\"token operator\">></span>\nresize at <span class=\"token number\">5</span>\nresize at <span class=\"token number\">19</span>\nresize at <span class=\"token number\">77</span>\nresize at <span class=\"token number\">307</span>\nresize at <span class=\"token number\">1229</span>\nresize at <span class=\"token number\">4915</span>\nresize at <span class=\"token number\">19661</span>\nresize at <span class=\"token number\">78643</span>\nresize at <span class=\"token number\">157286</span>\nresize at <span class=\"token number\">314573</span>\nresize at <span class=\"token number\">629145</span>\nresize at <span class=\"token number\">1258291</span>\nresize at <span class=\"token number\">2516582</span>\n</code></pre></div>\n<ol>\n<li>처음 <code class=\"language-text\">bucket</code>의 크기는 8이니 5/8만큼 찼을때 늘어난다.</li>\n<li>19/32만큼 찼을때 늘어난다.</li>\n<li>77/128만큼 찼을때 늘어난다.</li>\n</ol>\n<p>…</p>\n<p>이걸 바탕으로 우린 위에서 언급한 <strong>load factor</strong>를 계산 할 수 있는데, 미리 계산해왔다. 😅\n대략 <strong>0.6</strong>에 근접하면 <strong>resize</strong>가 호출된다.</p>\n<p><strong>Python에서, 최소한 CPython의 <code class=\"language-text\">set</code>의 <strong>load factor</strong>는 0.6에 근접하는것 같다.</strong></p>\n<blockquote>\n<p>직접 계산 해보면 <code class=\"language-text\">hash table</code>의 bucket의 크기는 8->32->128->…->32768-><strong>131072</strong>->262144->…->4194304 순으로 늘어난다. <strong>정말 50,000을 넘어서부터는 4배가 아니라 2배씩 늘고 있다.</strong></p>\n</blockquote>\n<p>아까 위에서 언급한 <code class=\"language-text\">resize</code>를 할지 말지 결정하는 부분을 다시 한번 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">size_t</span><span class=\"token punctuation\">)</span>so<span class=\"token operator\">-></span>fill<span class=\"token operator\">*</span><span class=\"token number\">5</span> <span class=\"token operator\">&lt;</span> mask<span class=\"token operator\">*</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">set_table_resize</span><span class=\"token punctuation\">(</span>so<span class=\"token punctuation\">,</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">></span><span class=\"token number\">50000</span> <span class=\"token operator\">?</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">2</span> <span class=\"token operator\">:</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">mask</code>는 <strong><code class=\"language-text\">size</code>보다 1 작은 값</strong>이니 <code class=\"language-text\">bucket</code>의 <code class=\"language-text\">size-1</code>로 바꿔쓸 수 있다.. 식을 보기 좋게 살짝 정리해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"c\"><pre class=\"language-c\"><code class=\"language-c\">    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span>so<span class=\"token operator\">-></span>fill<span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> <span class=\"token punctuation\">(</span>size<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">0.6</span> <span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">set_table_resize</span><span class=\"token punctuation\">(</span>so<span class=\"token punctuation\">,</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">></span><span class=\"token number\">50000</span> <span class=\"token operator\">?</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">2</span> <span class=\"token operator\">:</span> so<span class=\"token operator\">-></span>used<span class=\"token operator\">*</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>해석해보자. <code class=\"language-text\">size-1</code>개의 <code class=\"language-text\">bucket</code>들 중에서</p>\n<ul>\n<li><strong>60%보다 덜 차있다면</strong>, <code class=\"language-text\">resize</code>를 진행하지 않고 <code class=\"language-text\">add</code> 함수를 종료한다.</li>\n<li><strong>60%보다 더 차있다면</strong> <code class=\"language-text\">resize</code>를 진행한다.</li>\n</ul>\n<p><strong>최소한 CPython의 <code class=\"language-text\">set</code>의 load factor는 0.6에 아주 근사하다고 말할 수 있게 된 것이다.</strong></p>\n<h2 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h2>\n<p>우리는 긴 과정을 거쳐서 <code class=\"language-text\">set</code>이 <code class=\"language-text\">add</code>를 할 때 사실은 <code class=\"language-text\">resize</code>를 할 때가 있기 때문에 <strong>Overhead</strong>를 동반한다는 것을 알게 되었다.</p>\n<p>그렇기에 아주 naive하게 <code class=\"language-text\">set</code>의 <code class=\"language-text\">add</code>가 <code class=\"language-text\">O(1)</code>이라는 건 엄밀하지 않다. <code class=\"language-text\">add</code>하는 과정에서 <code class=\"language-text\">resize</code>를 호출할때가 있고 , 그 과정에서 현재 element의 약 <strong>60%</strong> 개의 element들을 옮겨야 하니 , <strong><a href=\"https://en.wikipedia.org/wiki/Amortized_analysis\">amortized</a></strong> <code class=\"language-text\">O(1)</code>이다.</p>\n<p>우리가 이 상황을 왜 분석했을까? BFS 탐색 문제를 푸는데 시간초과가 나서이다.</p>\n<p><strong>그 원인은 <code class=\"language-text\">add</code>를 반복할때 <code class=\"language-text\">resize</code>에 있다는 것을 확실하게 알 수 있다.</strong></p>\n<h2 id=\"그럼-어떻게\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%96%B4%EB%96%BB%EA%B2%8C\" aria-label=\"그럼 어떻게 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그럼 어떻게?</h2>\n<p><code class=\"language-text\">List</code>도 index 기반 접근을 하기 때문에 <code class=\"language-text\">lookup</code>에 대한 시간이 <code class=\"language-text\">O(1)</code>이다. 또 <code class=\"language-text\">List</code>를 처음 선언할때 메모리를 할당해주기 때문에, <strong><code class=\"language-text\">append</code>를 쓰지 않는다면,</strong> <code class=\"language-text\">resize</code>가 필요하지 않다.</p>\n<blockquote>\n<p><code class=\"language-text\">List</code>도 내부 구조는 dynamic array이기 때문에 <code class=\"language-text\">resize</code>가 발생할 수 있다. <code class=\"language-text\">append</code>도 <strong>amortized</strong> O(1)인 이유가 있다.</p>\n</blockquote>\n<p>정말 특수한 상황을 제외하고는 <code class=\"language-text\">List</code>를 사용하는게 의문의 시간 초과 오류를 보지 않는 방법이다.</p>\n<blockquote>\n<p>경험상 특수한 상황은 탐색에서 조건적으로 매우 크고 sparse한 범위의 방문을 할 때다.</p>\n</blockquote>\n<blockquote>\n<p>모든 코드는 Python 3.8.10 [GCC 9.4.0] on linux 버전을 사용했습니다</p>\n</blockquote>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<p><a href=\"https://github.com/akheron/cpython\">CPython Source Code</a>\n<a href=\"https://docs.python.org/ko/3/c-api/memory.html#c.PyMem_Malloc\">Python 메모리 관리 공식문서</a>\n<a href=\"https://stackoverflow.com/questions/39914266/memory-consumption-of-a-list-and-set-in-python\">Memory consumption of a list and set in Python</a>\n<a href=\"https://www.geeksforgeeks.org/load-factor-and-rehashing/\">Load Factor and Rehashing</a>\n<a href=\"https://stackoverflow.com/questions/58792963/time-complexity-for-adding-elements-to-list-vs-set-in-python\">Time complexity for adding elements to list vs set in python</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%83%81%ED%99%A9\">문제 상황</a></p>\n<ul>\n<li><a href=\"#%EB%A9%94%EB%AA%A8%EB%A6%AC-%EC%82%AC%EC%9A%A9%EB%9F%89\">메모리 사용량</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#list%EC%99%80-set%EC%9D%98-%EB%82%B4%EB%B6%80%EA%B5%AC%EC%A1%B0\">List와 Set의 내부구조</a></p>\n<ul>\n<li><a href=\"#list\">List</a></li>\n<li><a href=\"#set\">Set</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#set%EC%97%90%EC%84%9C%EC%9D%98-resize\">Set에서의 resize</a></p>\n<ul>\n<li><a href=\"#resize%EC%9D%98-%EB%82%B4%EB%B6%80%EB%8F%99%EC%9E%91-%EB%B0%A9%EC%8B%9D\">resize의 내부동작 방식</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9E%98%EC%84%9C-%EC%96%BC%EB%A7%88%EB%82%98-%EA%B1%B8%EB%A6%AC%EB%8A%94%EB%8D%B0\">그래서 얼마나 걸리는데?</a></li>\n<li><a href=\"#set%EC%9D%98-load-factor\">Set의 load factor</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%96%B4%EB%96%BB%EA%B2%8C\">그럼 어떻게?</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"August 07, 2021","title":"Python 3의 Set 훔쳐보기","categories":"Python","author":"weasel","emoji":"📓"},"fields":{"slug":"/secret-of-set-in-python/"}},"site":{"siteMetadata":{"siteUrl":"https://becomeweasel.me","comments":{"utterances":{"repo":"BecomeWeasel/BecomeWeasel.github.io"}}}}},"pageContext":{"slug":"/programmers-build-race-road/","nextSlug":"/do-i-need-an-interface-with-spring-boot/","prevSlug":"/secret-of-set-in-python/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}