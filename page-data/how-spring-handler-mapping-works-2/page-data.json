{
    "componentChunkName": "component---src-templates-blog-template-js",
    "path": "/how-spring-handler-mapping-works-2/",
    "result": {"data":{"cur":{"id":"e6098b1b-70f3-5e28-947b-b8dab3353972","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 719px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.111111111111114%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjElEQVQoz31SO47bMBTUIbbIAXKcRZogVZA27XZ7jXRp9xKB+1zApWHIsGUItCTDkvWzKEqUNME8mI7WcPKAwaMovnnzhvSmaQKj73vEcYzdbgelFMqyhPvHrLWW/f1+jyhSyLIWSv1Cmn5CEHyFUp9R1y/w5oSHwwHr9Rqr1QppmgqRgzEGQRDIvzDcI0lKKLVAnn+B739HGH6D1q/wcA0WHY9HQVVVGIZB9sdxlO8sy5DnuTS21sKYFl034T48FrKIaJoGRVFIYdu2uFwuQsBMCzgBLdlutzidTlchdoYBXl3X4l0UReITCZMkESIWLZdL8c4pnoeza772uq4TBSQmqIwjOYXMbERwdFpCpWzsiObE3rwjjXeKuZ4HFXJs2sJMIfcqhdBtWNtjHHtoTaUFrO3e3TItoKrz+SyknOK/hMYM0BqI41YyzzvfeIaj+74vnm42m9sEDwjHK2GINP2JIPiBpnmDMQv8PTvdXsIc/yAcrg/7N6bpA6rqI7R+grXPcBd7X/Tolh3hH4izTHKPcv51AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"image\"\n        title=\"image\"\n        src=\"/static/3ced1b2df8c525ffaec0ce9aa709fff6/073e9/image.png\"\n        srcset=\"/static/3ced1b2df8c525ffaec0ce9aa709fff6/e9ff0/image.png 180w,\n/static/3ced1b2df8c525ffaec0ce9aa709fff6/f21e7/image.png 360w,\n/static/3ced1b2df8c525ffaec0ce9aa709fff6/073e9/image.png 719w\"\n        sizes=\"(max-width: 719px) 100vw, 719px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<h3 id=\"mappingregistry\" style=\"position:relative;\"><a href=\"#mappingregistry\" aria-label=\"mappingregistry permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MappingRegistry</h3>\n<p><code class=\"language-text\">MappingRegistry</code>는 아까 살펴본 <code class=\"language-text\">AbstractHandlerMethodMapping</code>의 내부 클래스다. <code class=\"language-text\">MappingRegistry</code>는 <strong>handler method에 대한 모든 mapping을 유지 관리</strong>하고 <strong><code class=\"language-text\">lookup</code>을 수행하는 method</strong>를 가지고 있고 동시성을 가진 접근을 가능하게 해주는 레지스트리다.</p>\n<blockquote>\n<p>A registry that maintains all mappings to handler methods, exposing methods to perform lookups and providing concurrent access.</p>\n</blockquote>\n<p>Package-private for testing purposes.</p>\n<p>가장 중요한 부분이 <strong>handler method에 대한 모든 mapping을 유지 관리</strong>하고 <strong><code class=\"language-text\">lookup</code>을 수행하는 method</strong>를 가지고 있다는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">MappingRegistry</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">MappingRegistration</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> registry <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HandlerMethod</span><span class=\"token punctuation\">></span></span> mappingLookup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">MultiValueMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> urlLookup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedMultiValueMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HandlerMethod</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> nameLookup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">HandlerMethod</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">CorsConfiguration</span><span class=\"token punctuation\">></span></span> corsLookup <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ReentrantReadWriteLock</span> readWriteLock <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ReentrantReadWriteLock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  \r\n  <span class=\"token comment\">// methods</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">MappingRegistry</code> 안에서 <code class=\"language-text\">Map</code> 자료구조를 가진 멤버 변수들이 있다. 그 중에서<code class=\"language-text\">LinkedMultiValueMap</code>이라는 자료구조를 사용한다. 이건 한개의 key에 여러 value들을 저장하는 <code class=\"language-text\">MultiValueMap</code>을 <code class=\"language-text\">LinkedHashMap</code>으로 감싼 자료구조로 Spring이 만든 자료구조다.</p>\n<p><code class=\"language-text\">urlLookup</code>은 <code class=\"language-text\">LinkedMultiValueMap</code>의 자료구조인데, key는 <code class=\"language-text\">url</code>을 가지고, value는 <code class=\"language-text\">RequestMappingInfo</code>를 가진다. <code class=\"language-text\">LinkedMultiValueMap</code>을 쓰는 이유는 하나의 <code class=\"language-text\">url</code>에 여러 handlerMethod들에 대한 정보가 담기기 때문이다.</p>\n<p>예를 들어 <code class=\"language-text\">\"/app/user\"</code>라는 <code class=\"language-text\">url</code> 아래 user에 대한 정보를 조회하는 <code class=\"language-text\">GET</code>,user를 추가하는 <code class=\"language-text\">POST</code>가 매핑될때, 아래처럼 <code class=\"language-text\">RequestMappingInfo</code>가 들어가는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">key <span class=\"token operator\">:</span> \"<span class=\"token operator\">/</span>app<span class=\"token operator\">/</span>user<span class=\"token operator\">/</span> \r\nvalue <span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">GET</span> <span class=\"token operator\">/</span>app<span class=\"token operator\">/</span>user<span class=\"token punctuation\">,</span><span class=\"token constant\">POST</span> <span class=\"token operator\">/</span>app<span class=\"token operator\">/</span>user<span class=\"token punctuation\">]</span></code></pre></div>\n<p>위와 같은 구조를 통해 <code class=\"language-text\">MappingRegistry</code>는 <code class=\"language-text\">url</code>에 해당하는 handlerMethod를 구별할 수 있게 된다. 코드로 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">protected</span> <span class=\"token class-name\">HandlerMethod</span> <span class=\"token function\">lookupHandlerMethod</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> lookupPath<span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServletRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Match</span><span class=\"token punctuation\">></span></span> matches <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> directPathMatches <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappingRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">getMappingsByUrl</span><span class=\"token punctuation\">(</span>lookupPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>directPathMatches <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">addMatchingMappings</span><span class=\"token punctuation\">(</span>directPathMatches<span class=\"token punctuation\">,</span> matches<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>matches<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n    matches<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>comparator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token class-name\">Match</span> bestMatch <span class=\"token operator\">=</span> matches<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\r\n    request<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>BEST_MATCHING_HANDLER_ATTRIBUTE<span class=\"token punctuation\">,</span> bestMatch<span class=\"token punctuation\">.</span>handlerMethod<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">handleMatch</span><span class=\"token punctuation\">(</span>bestMatch<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">,</span> lookupPath<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">return</span> bestMatch<span class=\"token punctuation\">.</span>handlerMethod<span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>위는 아까 잠깐 언급한 <code class=\"language-text\">lookupHandlerMethod</code>이다. <em><strong>적절한 <code class=\"language-text\">handlerMethod</code>를 가져온 후 return 한다</strong></em> 고 했는데 그 과정이 담겨있다.\r\n길다고 겁먹지 말고 한줄씩 보자. (<em>match되는 것이 없거나, 2개 이상인 경우는 제외함</em>)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Match</span><span class=\"token punctuation\">></span></span> matches <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">match</code>를 담는 <code class=\"language-text\">matches</code>라는 리스트가 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> directPathMatches <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mappingRegistry<span class=\"token punctuation\">.</span><span class=\"token function\">getMappingsByUrl</span><span class=\"token punctuation\">(</span>lookupPath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n</code></pre></div>\n<p>현재 <code class=\"language-text\">url</code>에 mapping되는 handler method들의 <code class=\"language-text\">RequestMappingInfo</code>들을 <code class=\"language-text\">getMappingsByUrl</code>로 가져온 후 <code class=\"language-text\">directPathMatches</code>에 저장한다. 예를 들어 <code class=\"language-text\">url</code>이 <code class=\"language-text\">/app/user</code>이면 <code class=\"language-text\">directPathMatches</code>에는 <code class=\"language-text\">[GET /app/user, POST /app/user]</code> 와 같은 정보가 들어오는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>directPathMatches <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token function\">addMatchingMappings</span><span class=\"token punctuation\">(</span>directPathMatches<span class=\"token punctuation\">,</span> matches<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그 후 <code class=\"language-text\">[GET /app/user, POST /app/user]</code> 중에서 request 정보와 일치하는 것들을 <code class=\"language-text\">addMatchingMappings</code>을 통해서 <code class=\"language-text\">matches</code>에 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">matches<span class=\"token punctuation\">.</span><span class=\"token function\">sort</span><span class=\"token punctuation\">(</span>comparator<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token class-name\">Match</span> bestMatch <span class=\"token operator\">=</span> matches<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">matches</code>들을 우선순위에 맞게끔 정렬하고, request와 가장 일치하는 0번째 <code class=\"language-text\">match</code>를 <code class=\"language-text\">bestMatch</code>에 저장한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">request<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span>BEST_MATCHING_HANDLER_ATTRIBUTE<span class=\"token punctuation\">,</span> bestMatch<span class=\"token punctuation\">.</span>handlerMethod<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">handleMatch</span><span class=\"token punctuation\">(</span>bestMatch<span class=\"token punctuation\">.</span>mapping<span class=\"token punctuation\">,</span> lookupPath<span class=\"token punctuation\">,</span> request<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">return</span> bestMatch<span class=\"token punctuation\">.</span>handlerMethod<span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">bestMatch</code>의 멤버인 <code class=\"language-text\">handlerMethod</code>를 return해서 최종적으로 적합한 handler method를 찾게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Match</span> <span class=\"token punctuation\">{</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">T</span> mapping<span class=\"token punctuation\">;</span>\r\n\r\n  <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HandlerMethod</span> handlerMethod<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"reflection\" style=\"position:relative;\"><a href=\"#reflection\" aria-label=\"reflection permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reflection</h3>\n<p>이제 마지막 궁금증만이 남았다.</p>\n<h3 id=\"출처\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98\" aria-label=\"출처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처</h3>\n<p><a href=\"https://docs.spring.io/spring-framework/docs/4.3.2.RELEASE_to_4.3.3.RELEASE/Spring%20Framework%204.3.3.RELEASE/org/springframework/web/servlet/handler/AbstractHandlerMethodMapping.MappingRegistry.html\">MappingReigstry javadoc</a>\r\n<a href=\"https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/util/LinkedMultiValueMap.html\">LinkedMultiValueMap javadoc</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#mappingregistry\">MappingRegistry</a></li>\n<li><a href=\"#reflection\">Reflection</a></li>\n<li><a href=\"#%EC%B6%9C%EC%B2%98\">출처</a></li>\n</ul>\n</div>","excerpt":"MappingRegistry 는 아까 살펴본 의 내부 클래스다. 는 handler method에 대한 모든 mapping을 유지 관리하고 을 수행하는 method를 가지고 있고 동시성을 가진 접근을 가능하게 해주는 레지스트리다. A registry that maintains all mappings to handler methods, exposing methods to perform lookups and providing concurrent access. Package-private for testing purposes. 가장 중요한 부분이 handler method에 대한 모든 mapping을 유지 관리하고 을 수행하는 method를 가지고 있다는 것이다.  안에서  자료구조를 가진 멤버 변수들이 있다. 그 중에서이라는 자료구조를 사용한다. 이건 한개의 key에 여러 value들을 저장하는 을 으로 감싼 자료구조로 Spring이 만든 자료구조다. 은 의 자료구조인데, key는 을 …","frontmatter":{"date":"November 05, 2021","title":"Spring MVC - HandlerMapping의 동작방식 이해하기 2편","categories":"Spring","author":"weasel","emoji":"📓"},"fields":{"slug":"/how-spring-handler-mapping-works-2/"}},"next":{"id":"4e6a1170-476e-559b-8a85-e77e76d47c21","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 720px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD9klEQVQ4y22VyW4jVRSG8wq8AK/AY7BCbNghsWLLkg0bQCCxZdViwSDUoEZqmlbTSXdIGjtxOnHitOfyUK559FyDXWU73RIfutckBNGLW1X33PJf5//Pf453lksPsVarkDSxGA27rNcheR6wWLjMZoY8yzJfrvF4IN8X5+tVyGQyYJE6rPJAxnfEZbH0SBKHcGLTM3qkC484tiWY73dIU4c4tmTMsprM5yZRbJOkLrrVYjTR5e8l4GoVkKYuuxcaR8+POCveZ+9Sp9VrMBn3GY1UPE9B12vyeThSmY77vGg3+f3S5HnD5LBm8WetR5ra7MSRiW23eKZMMO6/z/y7NynW+xiBw9UmuKEuqK3XQ5aZz6urkI5jU6raeE8e0z4qU+r6JInNTjQ3MK0mh80At/g5WeEDClUF3bfZrLa6CToiO8FGyHO1DlAsk1LdJa6/QG9rHCsOqQCUlBcue80Rl81zmrU/2O/MUK0+2dKRYPO5QRB0ZaZCx3zp0NJU9hpDKoOQUn9CoWluAQWleG6yv3vMo2KFh8Uy+3untNtVpjNNZibADKMuaQ+HfXlXtQaq2UdzNHRXp6e1t5SzzGM6HlB8YfPg20+598W7FC8NTFfjahP+T0MhgbiLvWCwWQfyvelksAUUF8tqUHTWPP7mSx58/DYFI8XwjH80DG5pGN54VuxjaRWfLA9k9SVgvgpJZjoHJyqPdn/lwU9fcXAyQB0oZJn7Wg2F5mHQIYkN8sxjlbmyIZIbDWOb+ukxiq7RtizalTJqv8pk+noNp9MB7X6TsqJSUdpUugMuO50toKAwj0xmkcHLq1BaIl/5Eky0oKD3Xw0DXm4Cuo7LbsXgx8/e4eFvdzkZRDLjHdFGmlZlPNZYLH0WC48osmQmogDig4LB9V501Tr36FgmB02XXz58i72f73BqRCSRIaq8dfhsOuDVRmToS59dZySHxsKVNEWHrFcef7306dkW+60pD+98xNPDJ5TUGUlsCg19mUG105LtpNg2LU34bKuZ0DAMurT7DRTLoWU6dG2H81aLckfjXFG46A6odG4XJXHYq9qcVQbUTqo8qfmolip9Js6SSKPcdymUL+jdfY+jk0PO+j7LWIwyl/x2laPIRNVqHHcCzEKBycFjTusmum+yWQUss4A8NaiYMxpH37P54Q06R19zbkRkqSF9KJIaXfswW3pMpgZPGx6KNsK1Ap51phieLjsgy0Pypc2lHnBSa5JdfMJZvcrFIJDxPA+l1mLw3lAWg1KMrJJiUVIMik1D9qZoJ9EBgo7w2ZHicH7xjOO2TUXpyLjITIC5blsO4p3rvwAxHMUXxEqTf59vLxGPF8PXngsw4Zi/AdfKofJBX3IcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"flip card\"\n        title=\"flip card\"\n        src=\"/static/fe5be793a2992a9d9bc5375d6e62fc78/37523/flip-card.png\"\n        srcset=\"/static/fe5be793a2992a9d9bc5375d6e62fc78/e9ff0/flip-card.png 180w,\n/static/fe5be793a2992a9d9bc5375d6e62fc78/f21e7/flip-card.png 360w,\n/static/fe5be793a2992a9d9bc5375d6e62fc78/37523/flip-card.png 720w,\n/static/fe5be793a2992a9d9bc5375d6e62fc78/00d43/flip-card.png 1000w\"\n        sizes=\"(max-width: 720px) 100vw, 720px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<blockquote>\n<p>정답률 0.95퍼의 무시무시한 문제다.</p>\n</blockquote>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/25d9a099-6e25-45aa-8957-69cfbf016a77/image.png\" alt=\"\"></p>\n<h3 id=\"문제-제목\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%A0%9C%EB%AA%A9\" aria-label=\"문제 제목 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 제목</h3>\n<p><a href=\"https://programmers.co.kr/learn/courses/30/lessons/72415\">카드 짝 맞추기</a></p>\n<h3 id=\"문제-설명\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\" aria-label=\"문제 설명 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 설명</h3>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/4cee4e7d-32a9-4b13-ba08-ddcc321af803/image.png\" alt=\"\">\r\n게임 개발자인 베로니는 개발 연습을 위해 다음과 같은 간단한 카드 짝맞추기 보드 게임을 개발해 보려고 합니다.\r\n게임이 시작되면 화면에는 카드 16장이 뒷면을 위로하여 4 x 4 크기의 격자 형태로 표시되어 있습니다. 각 카드의 앞면에는 카카오프렌즈 캐릭터 그림이 그려져 있으며, 8가지의 캐릭터 그림이 그려진 카드가 각기 2장씩 화면에 무작위로 배치되어 있습니다.\r\n유저가 카드를 2장 선택하여 앞면으로 뒤집었을 때 같은 그림이 그려진 카드면 해당 카드는 게임 화면에서 사라지며, 같은 그림이 아니라면 원래 상태로 뒷면이 보이도록 뒤집힙니다. 이와 같은 방법으로 모든 카드를 화면에서 사라지게 하면 게임이 종료됩니다.</p>\n<p>게임에서 카드를 선택하는 방법은 다음과 같습니다.</p>\n<ul>\n<li>카드는 커서를 이용해서 선택할 수 있습니다.</li>\n</ul>\n<p>커서는 4 x 4 화면에서 유저가 선택한 현재 위치를 표시하는 “굵고 빨간 테두리 상자”를 의미합니다.</p>\n<ul>\n<li>커서는 [Ctrl] 키와 방향키에 의해 이동되며 키 조작법은 다음과 같습니다.</li>\n</ul>\n<p>방향키 ←, ↑, ↓, → 중 하나를 누르면, 커서가 누른 키 방향으로 1칸 이동합니다.\r\n[Ctrl] 키를 누른 상태에서 방향키 ←, ↑, ↓, → 중 하나를 누르면, 누른 키 방향에 있는 가장 가까운 카드로 한번에 이동합니다.\r\n만약, 해당 방향에 카드가 하나도 없다면 그 방향의 가장 마지막 칸으로 이동합니다.\r\n만약, 누른 키 방향으로 이동 가능한 카드 또는 빈 공간이 없어 이동할 수 없다면 커서는 움직이지 않습니다.</p>\n<ul>\n<li>커서가 위치한 카드를 뒤집기 위해서는 [Enter] 키를 입력합니다.</li>\n</ul>\n<p>[Enter] 키를 입력해서 카드를 뒤집었을 때 앞면이 보이는 카드가 1장 뿐이라면 그림을 맞출 수 없으므로 두번째 카드를 뒤집을 때 까지 앞면을 유지합니다.\r\n앞면이 보이는 카드가 2장이 된 경우, 두개의 카드에 그려진 그림이 같으면 해당 카드들이 화면에서 사라지며, 그림이 다르다면 두 카드 모두 뒷면이 보이도록 다시 뒤집힙니다.\r\n“베로니”는 게임 진행 중 카드의 짝을 맞춰 몇 장 제거된 상태에서 카드 앞면의 그림을 알고 있다면, 남은 카드를 모두 제거하는데 필요한 키 조작 횟수의 최솟값을 구해 보려고 합니다. 키 조작 횟수는 방향키와 [Enter] 키를 누르는 동작을 각각 조작 횟수 1로 계산하며, [Ctrl] 키와 방향키를 함께 누르는 동작 또한 조작 횟수 1로 계산합니다.</p>\n<p>다음은 카드가 몇 장 제거된 상태의 게임 화면에서 커서를 이동하는 예시입니다.\r\n아래 그림에서 빈 칸은 이미 카드가 제거되어 없어진 칸을 의미하며, 그림이 그려진 칸은 카드 앞 면에 그려진 그림을 나타냅니다.</p>\n<p><strong>&#x3C;예시는 생략하겠습니다.></strong></p>\n<h3 id=\"문제\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C\" aria-label=\"문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제</h3>\n<p>현재 카드가 놓인 상태를 나타내는 2차원 배열 board와 커서의 처음 위치 r, c가 매개변수로 주어질 때, 모든 카드를 제거하기 위한 키 조작 횟수의 최솟값을 return 하도록 solution 함수를 완성해 주세요.</p>\n<h3 id=\"제한-사항\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%ED%95%9C-%EC%82%AC%ED%95%AD\" aria-label=\"제한 사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제한 사항</h3>\n<ul>\n<li>board는 4 x 4 크기의 2차원 배열입니다.</li>\n<li>board 배열의 각 원소는 0 이상 6 이하인 자연수입니다.</li>\n<li>0은 카드가 제거된 빈 칸을 나타냅니다.</li>\n<li>1 부터 6까지의 자연수는 2개씩 들어있으며 같은 숫자는 같은 그림의 카드를 의미합니다.</li>\n<li>뒤집을 카드가 없는 경우(board의 모든 원소가 0인 경우)는 입력으로 주어지지 않습니다.</li>\n<li>r은 커서의 최초 세로(행) 위치를 의미합니다.</li>\n<li>c는 커서의 최초 가로(열) 위치를 의미합니다.</li>\n<li>r과 c는 0 이상 3 이하인 정수입니다.</li>\n<li>게임 화면의 좌측 상단이 (0, 0), 우측 하단이 (3, 3) 입니다.</li>\n</ul>\n<h3 id=\"예제-입출력\" style=\"position:relative;\"><a href=\"#%EC%98%88%EC%A0%9C-%EC%9E%85%EC%B6%9C%EB%A0%A5\" aria-label=\"예제 입출력 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>예제 입출력</h3>\n<p><strong>입력</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">board : [[1,0,0,3],[2,0,0,0],[0,0,0,2],[3,0,1,0]]\r\nr : 1\r\nc: 0\r\n\r\nboard : [[3,0,0,2],[0,0,1,0],[0,1,0,0],[2,0,0,3]]\t\r\nr : 0\r\nc: 1</code></pre></div>\n<p><strong>출력</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">14\r\n16</code></pre></div>\n<p><strong>입출력 예 #2</strong>\r\n<img src=\"https://images.velog.io/images/hsw0194/post/730572ca-24fa-4b44-ba6f-d6ad71c783e6/image.png\" alt=\"\"></p>\n<blockquote>\n<p>위 게임 화면에서 모든 카드를 제거하기 위한 키 조작 횟수의 최솟값은 16번 입니다.</p>\n</blockquote>\n<h3 id=\"풀이\" style=\"position:relative;\"><a href=\"#%ED%92%80%EC%9D%B4\" aria-label=\"풀이 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>풀이</h3>\n<p>문제를 읽으면서 <strong>이걸 도대체 어떻게?</strong> 라는 생각이 강하게 들었다. 그 이유는 아래와 같은데</p>\n<ol>\n<li><strong>제약조건</strong>이 너무 많다. ctrl 이동이나 카드를 뒤집는 행동에서 코너케이스가 분명히 나올것 같았다.</li>\n<li><strong>할 수 있는 행동</strong>이 너무 많다. 단순히 생각해보자. 커서를 기준으로 <code class=\"language-text\">←, ↑, ↓, →</code> 이동과 <code class=\"language-text\">ctrl + ←, ↑, ↓, →</code> (엑셀에서의 그것) , 카드를 첫번째로 뒤집는 것, 카드를 뒤집은 상태에서 다시 뒤집는 것. 정말 많다.</li>\n<li>카드가 다 보이는 상태인가? 아니면 뒤집어 봐야지 아는건가?</li>\n</ol>\n<h4 id=\"사고의-과정\" style=\"position:relative;\"><a href=\"#%EC%82%AC%EA%B3%A0%EC%9D%98-%EA%B3%BC%EC%A0%95\" aria-label=\"사고의 과정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>사고의 과정</h4>\n<p>문제 독해를 다시 천천히 해보자. 그러면 아래와 같은 점때문에 <strong>풀 수 있어 보인다.</strong></p>\n<ol>\n<li>2차원 격자가 <code class=\"language-text\">4x4</code>, 16칸으로 매우 매우 작다. 완전탐색이 가능해보인다.</li>\n<li>모두 뒤집혔을때의 키 조작 횟수의 <strong>최솟값</strong>을 묻고 있다.</li>\n<li>변화하는 상태의 개수를 명확하게 알 수 있다.</li>\n</ol>\n<p>이쯤되면 한가지 풀이 밖에 없다. <strong>BFS다.</strong></p>\n<p>다만 구현할 부분이 매우 많은 BFS 풀이일뿐이다. 개인적인 생각으로 삼성 기출 문제를 열심히 공부하신 분들이라면 어렵지 않게 구현할 수 있을거라고 생각한다.</p>\n<blockquote>\n<p>저는 삼성 기출문제 공부를 잘 안했습니다.</p>\n</blockquote>\n<h4 id=\"커서를-기준으로-생각하자\" style=\"position:relative;\"><a href=\"#%EC%BB%A4%EC%84%9C%EB%A5%BC-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EC%83%9D%EA%B0%81%ED%95%98%EC%9E%90\" aria-label=\"커서를 기준으로 생각하자 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>커서를 기준으로 생각하자.</h4>\n<p>일단 커서의 위치를 기점으로 가능한 행동을 나눠보자.</p>\n<ol>\n<li>단순히 커서를 격자에서 벗어나지 않게 <code class=\"language-text\">상,하,좌,우</code>로 움직인다.</li>\n<li>격자에서 벗어나지 않게 <code class=\"language-text\">ctrl + 상,하,좌,우</code>로 움직인다.\n<ul>\n<li>카드가 있다면 카드로 이동한다.</li>\n<li>해당 방향에 카드가 없다면 맨 끝으로 이동한다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">Enter</code>를 눌러 카드를 뒤집는다.\n<ul>\n<li>이번이 처음 뒤집는 카드라면, 그 카드를 기록한다.</li>\n<li>이미 뒤집은 카드가 있다면, 그 카드와 지금 카드를 비교한다.\n<ol>\n<li>두 그림이 같으면 , 카드를 삭제한다.</li>\n<li>다르면 , 뒤집어진 카드를 다시 뒤집는다.</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<p>정리해보면 생각보다 간단하다. 각각의 <strong>변화하는 상태</strong>를 그래프에서의 <strong>노드</strong>로 보고 위에서 적은 3가지 행동을 모두 하는 완전탐색을 수행한다. 이 과정에서 최소 횟수를 구하니 <strong>BFS</strong>다.</p>\n<h4 id=\"변화하는-상태\" style=\"position:relative;\"><a href=\"#%EB%B3%80%ED%99%94%ED%95%98%EB%8A%94-%EC%83%81%ED%83%9C\" aria-label=\"변화하는 상태 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>변화하는 상태</h4>\n<p>이제 생각할 건 하나다. 매 탐색마다 어떤것이 변화할까?</p>\n<p>일단 커서가 매번 움직이니, <strong>커서의 위치</strong>는 변한다. 또, 단순히 탐색하는것이 아니라 격자에 변화를 주기 때문에 <strong>격자의 상태</strong>가 변화한다.</p>\n<p><strong>여기까지는 일반적이다.</strong> 그럼 이 문제에서 특수한 상황은 카드를 뒤집는 행동이다.</p>\n<blockquote>\n</blockquote>\n<ul>\n<li>이번이 처음 뒤집는 카드라면, 그 카드를 기록한다.</li>\n<li>이미 뒤집은 카드가 있다면, 그 카드와 지금 카드를 비교한다.</li>\n</ul>\n<p>그러면 <strong>현재 카드를 뒤집었는지(False=0 or True=1장 뒤집었는지)</strong> 와 카드를 뒤집었다면 <strong>뒤집은 카드의 위치</strong> 역시 변한다.</p>\n<p>단순히 변한다고만 해서 기록해줘야 하는 것은 아니다. 기록해줘야 하는 조건은 <strong>특정 조건이 없을때</strong> 탐색을 생략한다거나 중복으로 탐색하게 된다면, 그 특정 조건은 필요한 것이다.</p>\n<p>예를 들어보자.\r\n<code class=\"language-text\">Enter</code> 행동은 카드를 뒤집는 행동이다. 카드를 뒤집는것을 기록을 해주지 않는다면, <code class=\"language-text\">visit</code> 배열 안에 뒤집기 전의 상태가 그대로 들어가 있기 때문에,  <code class=\"language-text\">Enter</code> 행동을 수행할 수 없다.</p>\n<blockquote>\n<p>중복적인 탐색을 방지하는게 visit의 역할이기 때문이다.</p>\n</blockquote>\n<p>정리하자면, 변화하는 상태는</p>\n<ol>\n<li>격자의 상태</li>\n<li>커서의 위치</li>\n<li>현재 카드를 0 or 1장 뒤집었는지</li>\n<li>카드를 뒤집었다면 뒤집은 카드의 위치\n<ul>\n<li>3번이 True면 뒤집은 카드의 위치</li>\n<li>3번이 False면 (-1,-1)</li>\n</ul>\n</li>\n</ol>\n<h4 id=\"구현-의사코드\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84-%EC%9D%98%EC%82%AC%EC%BD%94%EB%93%9C\" aria-label=\"구현 의사코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현 의사코드</h4>\n<p>위에서 적은 <strong>커서의 움직임</strong>과 <strong>변화하는 상태</strong>를 기반으로 코드를 작성해보자.\r\n탐색 여부를 체크하는 <code class=\"language-text\">visit</code>은 변화하는 상태가 많기 때문에, 고차원 <code class=\"language-text\">list</code>로 구성하기가 곤란하다. <code class=\"language-text\">set</code>을 이용하되 복잡도에 유의하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\">visit<span class=\"token operator\">=</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\nq<span class=\"token operator\">=</span>deque<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\nvisit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>초기격자의 상태<span class=\"token punctuation\">,</span>커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집지 않음<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\nq<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span>초기격자의 상태<span class=\"token punctuation\">,</span>커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집지 않음<span class=\"token punctuation\">,</span><span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>조작 횟수<span class=\"token punctuation\">)</span>\r\n\r\n<span class=\"token keyword\">while</span> q<span class=\"token punctuation\">:</span>\r\n\t보드의 상태<span class=\"token punctuation\">,</span>기존 커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집었는지<span class=\"token punctuation\">,</span>뒤집었다면 위치<span class=\"token punctuation\">,</span>횟수<span class=\"token operator\">=</span>q<span class=\"token punctuation\">.</span>popleft<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    \r\n    <span class=\"token keyword\">for</span> 상<span class=\"token punctuation\">,</span>하<span class=\"token punctuation\">,</span>좌<span class=\"token punctuation\">,</span>우 네 방향으로 <span class=\"token punctuation\">:</span>\r\n    \t새 커서 위치<span class=\"token operator\">=</span>방향별로 한칸 움직인 좌표<span class=\"token operator\">=</span>기존 커서의 위치<span class=\"token operator\">+</span><span class=\"token number\">1</span>\r\n        \r\n        <span class=\"token keyword\">if</span> 격자를 벗어났다면<span class=\"token punctuation\">:</span>\r\n        \t<span class=\"token keyword\">continue</span>\r\n        \r\n        <span class=\"token keyword\">if</span> 이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치를 방문한적 있다면<span class=\"token punctuation\">:</span>\r\n        \t<span class=\"token keyword\">continue</span>\r\n        \r\n        이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치를 방문으로 표시\r\n        이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치<span class=\"token punctuation\">,</span>횟수<span class=\"token operator\">+</span><span class=\"token number\">1</span>를 다음에 탐색\r\n        \r\n    <span class=\"token keyword\">for</span> 상<span class=\"token punctuation\">,</span>하<span class=\"token punctuation\">,</span>좌<span class=\"token punctuation\">,</span>우 네 방향으로 ctrl 이동 <span class=\"token punctuation\">:</span>\r\n    \t<span class=\"token comment\"># 격자가 이렇고 C가 커서 일때 </span>\r\n        <span class=\"token comment\"># 0 0 0 0 </span>\r\n        <span class=\"token comment\"># 2 0 0 2 </span>\r\n        <span class=\"token comment\"># 0 0 0 0 </span>\r\n        <span class=\"token comment\"># 0 0 0 C </span>\r\n        <span class=\"token comment\"># 왼쪽으로 간다면 (0,3), 위로 간다면 (3,1)</span>\r\n    \t새 커서 위치<span class=\"token operator\">=</span><span class=\"token builtin\">min</span><span class=\"token punctuation\">(</span>기존 커서의 위치에서 방향별로 끝<span class=\"token punctuation\">,</span>존재하는 카드의 끝<span class=\"token punctuation\">)</span>\r\n        \r\n        <span class=\"token keyword\">if</span> 이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치를 방문한적 있다면<span class=\"token punctuation\">:</span>\r\n        \t<span class=\"token keyword\">continue</span>\r\n        \r\n        이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치를 방문으로 표시\r\n        이전의 상태<span class=\"token punctuation\">,</span>새 커서 위치<span class=\"token punctuation\">,</span>횟수<span class=\"token operator\">+</span><span class=\"token number\">1</span>를 다음에 탐색\r\n    \r\n    <span class=\"token comment\"># 현재 한장은 뒤집은 상태에서 다른것 뒤집으려 할때</span>\r\n    <span class=\"token keyword\">if</span> 현재 카드를 뒤집은 상태라면 <span class=\"token punctuation\">:</span>\r\n    \t<span class=\"token comment\"># 짝을 찾는데 성공</span>\r\n    \t<span class=\"token keyword\">if</span> 지금 위치의 카드와 이전에 뒤집었던 카드가 같다면<span class=\"token punctuation\">:</span>\r\n            격자에서 현재 카드 숫자를 제거함\r\n            \r\n            <span class=\"token keyword\">if</span> 지금 모든 카드를 제거했다면<span class=\"token punctuation\">:</span>\r\n            \t<span class=\"token keyword\">return</span> 횟수<span class=\"token operator\">+</span><span class=\"token number\">1</span>\r\n            <span class=\"token keyword\">else</span> 아직 끝낼수 없다면<span class=\"token punctuation\">:</span>\r\n            \t바뀐 격자의 상태<span class=\"token punctuation\">,</span>현재 커서위치<span class=\"token punctuation\">,</span>뒤집지 않음을 방문으로 표시\r\n                바뀐 격자의 상태<span class=\"token punctuation\">,</span>현재 커서위치<span class=\"token punctuation\">,</span>뒤집지 않음을 다음에 탐색                \t\t\r\n        <span class=\"token comment\"># 짝 맞추기 실패 </span>\r\n        <span class=\"token keyword\">else</span> 지금 위치의 카드와 이전에 뒤집었던 카드가 다르다면<span class=\"token punctuation\">:</span>\r\n            이전 상태<span class=\"token punctuation\">,</span>현재 커서의 위치<span class=\"token punctuation\">,</span>뒤집지 않음을 방문으로 표시\r\n            이전의 상태<span class=\"token punctuation\">,</span>현재 커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집음<span class=\"token punctuation\">,</span>횟수<span class=\"token operator\">+</span><span class=\"token number\">1</span>을 다음에 탐색\r\n        \r\n    <span class=\"token keyword\">else</span> 카드를 하나도 안 뒤집은 상태라면 <span class=\"token punctuation\">:</span>\r\n    \r\n    \t<span class=\"token keyword\">if</span> 이전의 상태<span class=\"token punctuation\">,</span>카드를 뒤집음<span class=\"token punctuation\">,</span>현재 커서의 위치를 방문한적 있다면<span class=\"token punctuation\">:</span>\r\n        \t<span class=\"token keyword\">continue</span>\r\n        \r\n        이전의 상태<span class=\"token punctuation\">,</span>현재 커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집음을 방문으로 표시\r\n        이전의 상태<span class=\"token punctuation\">,</span>현재 커서의 위치<span class=\"token punctuation\">,</span>카드를 뒤집음<span class=\"token punctuation\">,</span>횟수<span class=\"token operator\">+</span><span class=\"token number\">1</span>를 다음에 탐색\r\n</code></pre></div>\n<p>구현이 꽤 복잡하지만 하나씩 보면, 커서의 행동별로 분류해서 전혀 복잡하지 않다. 신경써줄 부분은 <code class=\"language-text\">ctrl+상,하,좌,우</code> 이동에서 가까운 카드 혹은 끝 부분을 찾는 방법과 카드를 뒤집은 상태에서 카드 짝을 맞췄는지 아닌지 파악하는 부분이다.</p>\n<h4 id=\"구현에서의-몇가지-팁\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84%EC%97%90%EC%84%9C%EC%9D%98-%EB%AA%87%EA%B0%80%EC%A7%80-%ED%8C%81\" aria-label=\"구현에서의 몇가지 팁 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현에서의 몇가지 팁</h4>\n<p>다만 격자의 상태를 기록해야하는데, 탐색이 커지는 경우에는 매 탐색마다 <code class=\"language-text\">deque</code>에 <code class=\"language-text\">4x4</code> 격자를 넣기에는 메모리를 걱정해줘야할 수 있으니, <code class=\"language-text\">4x4</code> 격자를 직렬화하는 방식을 택했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\r\n\tret <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\r\n        <span class=\"token keyword\">for</span> r <span class=\"token keyword\">in</span> board<span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">for</span> num <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">:</span>\r\n                ret <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token keyword\">return</span> ret</code></pre></div>\n<p>이 경우에는 2차원 좌표인 (x,y) 접근이 아니라 1차원 idx 접근으로 해야하기 때문에 (x,y) -> idx로 변환해주는 함수가 필요하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">def</span> <span class=\"token function\">idxConverter</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">:</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">:</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> y <span class=\"token operator\">+</span> x</code></pre></div>\n<p>이 경우에 훨씬 편리한점이 생기는데, 바로 카드를 제거할때 격자 안에 있는 요소를 변경하는 것이 아니라 <code class=\"language-text\">string.replace()</code> 함수를 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"> <span class=\"token keyword\">def</span> <span class=\"token function\">switchTo0</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">,</span>num<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h4 id=\"해설과는-다른-풀이입니다\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EC%84%A4%EA%B3%BC%EB%8A%94-%EB%8B%A4%EB%A5%B8-%ED%92%80%EC%9D%B4%EC%9E%85%EB%8B%88%EB%8B%A4\" aria-label=\"해설과는 다른 풀이입니다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해설과는 다른 풀이입니다.</h4>\n<p><a href=\"https://tech.kakao.com/2021/01/25/2021-kakao-recruitment-round-1/\">2021 카카오 신입공채 문제해설</a>의 6번 풀이를 보면 카드별로 지우는 순서를 순열로 정하고 순서대로 최단거리를 수행 후 최단거리의 합 중에서의 최소를 구하는데, 음.. 개인적인 생각으로 해설이 항상 직관적이고 최적의 해를 제공하지는 않는 것 같다.</p>\n<p>단적으로 내가 작성한 코드는 모든 테스트 케이스에 소요시간이 200ms를 넘지 않는데 순열을 이용한 코드는 3000ms도 소요될때가 있다. 물론 이 문제는 효율성까지 검사하는 문제는 아니다.</p>\n<p>지워야하는 순서를 순열을 통해서 정하고,최소횟수를 구하는 방법보다 처음부터 최소횟수를 완전탐색으로 구현하는것이 알고리즘 초보 입장에서 더 구현하기 쉬워보이고 와닿는다.</p>\n<blockquote>\n<p>이 과정에서 (1,1)에 있는 1번 카드와 (2,2)에 있는 1번 카드는 서로 다른 순서로 인식해야 한다.</p>\n</blockquote>\n<h3 id=\"풀이코드\" style=\"position:relative;\"><a href=\"#%ED%92%80%EC%9D%B4%EC%BD%94%EB%93%9C\" aria-label=\"풀이코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>풀이코드</h3>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> deque\r\n\r\ndy <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\r\ndx <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\r\n\r\n\r\n<span class=\"token keyword\">def</span> <span class=\"token function\">solution</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">isEnd</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">for</span> c <span class=\"token keyword\">in</span> s<span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> c <span class=\"token operator\">!=</span> <span class=\"token string\">'0'</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">OOB</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">not</span> <span class=\"token number\">0</span> <span class=\"token operator\">&lt;=</span> y <span class=\"token operator\">&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">not</span> <span class=\"token number\">0</span> <span class=\"token operator\">&lt;=</span> x <span class=\"token operator\">&lt;</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">isOnEdgeByDirection</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> d<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">:</span>\r\n\r\n        <span class=\"token keyword\">if</span> d <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> y <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n        <span class=\"token keyword\">elif</span> d <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> y <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n        <span class=\"token keyword\">elif</span> d <span class=\"token operator\">==</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> x <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n        <span class=\"token keyword\">elif</span> d <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> x <span class=\"token operator\">==</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span>\r\n\r\n    <span class=\"token comment\"># 바뀌는 상황 :</span>\r\n    <span class=\"token comment\"># 카드판의 상황,현재 커서의 위치 , 현재 뒤집었는지? 아니면 안뒤집엇는지 ( 2장째 기다리는중인지 뒤집었다면 커서 위치)</span>\r\n\r\n    <span class=\"token comment\"># 구하는 것 : 최소 회수 이동</span>\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">serialize</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\r\n        ret <span class=\"token operator\">=</span> <span class=\"token string\">''</span>\r\n        <span class=\"token keyword\">for</span> r <span class=\"token keyword\">in</span> board<span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">for</span> num <span class=\"token keyword\">in</span> r<span class=\"token punctuation\">:</span>\r\n                ret <span class=\"token operator\">+=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token keyword\">return</span> ret\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">switchTo0</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">:</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">,</span>num<span class=\"token punctuation\">:</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">:</span>\r\n\r\n        <span class=\"token keyword\">return</span> s<span class=\"token punctuation\">.</span>replace<span class=\"token punctuation\">(</span>num<span class=\"token punctuation\">,</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">def</span> <span class=\"token function\">idxConverter</span><span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token number\">4</span> <span class=\"token operator\">*</span> y <span class=\"token operator\">+</span> x\r\n\r\n    visit <span class=\"token operator\">=</span> <span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token comment\"># 보드의 상태 ,커서의 위치 , 커서가 카드를 뒤집었는지 , 뒤집힌 카드가 있다면 그 위치</span>\r\n    visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>serialize<span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n    q <span class=\"token operator\">=</span> deque<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n    q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>serialize<span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n    <span class=\"token keyword\">while</span> q<span class=\"token punctuation\">:</span>\r\n        b<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">,</span> count <span class=\"token operator\">=</span> q<span class=\"token punctuation\">.</span>popleft<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token comment\"># 모든 카드를 뒤집었는지</span>\r\n        <span class=\"token comment\"># 여기서 체크하면 시간 더걸림</span>\r\n        <span class=\"token comment\"># if isEnd(b):</span>\r\n        <span class=\"token comment\">#     return count</span>\r\n\r\n        <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n            ny<span class=\"token punctuation\">,</span> nx <span class=\"token operator\">=</span> y <span class=\"token operator\">+</span> dy<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> dx<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\r\n\r\n            <span class=\"token keyword\">if</span> OOB<span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">continue</span>\r\n\r\n            <span class=\"token keyword\">while</span> b<span class=\"token punctuation\">[</span>idxConverter<span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">and</span> <span class=\"token keyword\">not</span> isOnEdgeByDirection<span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">,</span> k<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n                ny<span class=\"token punctuation\">,</span> nx <span class=\"token operator\">=</span> ny <span class=\"token operator\">+</span> dy<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> nx <span class=\"token operator\">+</span> dx<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> visit<span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">continue</span>\r\n\r\n            visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n            q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">,</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token comment\"># 상하좌우 네방향 이동</span>\r\n\r\n        <span class=\"token keyword\">for</span> k <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n            ny<span class=\"token punctuation\">,</span> nx <span class=\"token operator\">=</span> y <span class=\"token operator\">+</span> dy<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> x <span class=\"token operator\">+</span> dx<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span>\r\n\r\n            <span class=\"token keyword\">if</span> OOB<span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">continue</span>\r\n\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> visit<span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">continue</span>\r\n\r\n            visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n            q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> ny<span class=\"token punctuation\">,</span> nx<span class=\"token punctuation\">,</span> isFlipped<span class=\"token punctuation\">,</span> f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">,</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n\r\n        <span class=\"token comment\"># 현재 한장은 뒤집은 상태에서 다른것 뒤집으려 할때</span>\r\n        <span class=\"token keyword\">if</span> isFlipped<span class=\"token punctuation\">:</span>\r\n            <span class=\"token comment\"># 카드 짝 찾는데 성공하면</span>\r\n            <span class=\"token comment\"># 0으로 뒤집고</span>\r\n            <span class=\"token keyword\">if</span> b<span class=\"token punctuation\">[</span>idxConverter<span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> b<span class=\"token punctuation\">[</span>idxConverter<span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n\r\n                b <span class=\"token operator\">=</span> switchTo0<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span>b<span class=\"token punctuation\">[</span>idxConverter<span class=\"token punctuation\">(</span>f_y<span class=\"token punctuation\">,</span> f_x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\r\n        \r\n\r\n                <span class=\"token comment\"># 여기서 끝낼수있음</span>\r\n\r\n                <span class=\"token keyword\">if</span> isEnd<span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\r\n                    <span class=\"token keyword\">return</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span>\r\n\r\n                <span class=\"token comment\"># print(b)</span>\r\n                visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                \r\n            <span class=\"token comment\"># 짝은 안맞으면</span>\r\n            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\r\n\r\n                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> visit<span class=\"token punctuation\">:</span>\r\n                    <span class=\"token keyword\">continue</span>\r\n                visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n        <span class=\"token comment\"># 아직 뒤집지 않은 상태</span>\r\n        <span class=\"token comment\"># 이제 뒤집기</span>\r\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> visit<span class=\"token punctuation\">:</span>\r\n                <span class=\"token keyword\">continue</span>\r\n\r\n            visit<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n            q<span class=\"token punctuation\">.</span>append<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n</code></pre></div>\n<blockquote>\n<p>백준 난이도로 환산하면 골드2 정도로 보인다.</p>\n</blockquote>\n<blockquote>\n<p>은근히 테케에 빈틈이 많은 문제다.</p>\n</blockquote>\n<blockquote>\n<p>첫 시도는 80점 내외로 맞고 조금씩 변경해 80->96->100점을 받을 수 있었다.</p>\n</blockquote>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%A0%9C%EB%AA%A9\">문제 제목</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-%EC%84%A4%EB%AA%85\">문제 설명</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C\">문제</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C%ED%95%9C-%EC%82%AC%ED%95%AD\">제한 사항</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%98%88%EC%A0%9C-%EC%9E%85%EC%B6%9C%EB%A0%A5\">예제 입출력</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%92%80%EC%9D%B4\">풀이</a></p>\n<ul>\n<li><a href=\"#%EC%82%AC%EA%B3%A0%EC%9D%98-%EA%B3%BC%EC%A0%95\">사고의 과정</a></li>\n<li><a href=\"#%EC%BB%A4%EC%84%9C%EB%A5%BC-%EA%B8%B0%EC%A4%80%EC%9C%BC%EB%A1%9C-%EC%83%9D%EA%B0%81%ED%95%98%EC%9E%90\">커서를 기준으로 생각하자.</a></li>\n<li><a href=\"#%EB%B3%80%ED%99%94%ED%95%98%EB%8A%94-%EC%83%81%ED%83%9C\">변화하는 상태</a></li>\n<li><a href=\"#%EA%B5%AC%ED%98%84-%EC%9D%98%EC%82%AC%EC%BD%94%EB%93%9C\">구현 의사코드</a></li>\n<li><a href=\"#%EA%B5%AC%ED%98%84%EC%97%90%EC%84%9C%EC%9D%98-%EB%AA%87%EA%B0%80%EC%A7%80-%ED%8C%81\">구현에서의 몇가지 팁</a></li>\n<li><a href=\"#%ED%95%B4%EC%84%A4%EA%B3%BC%EB%8A%94-%EB%8B%A4%EB%A5%B8-%ED%92%80%EC%9D%B4%EC%9E%85%EB%8B%88%EB%8B%A4\">해설과는 다른 풀이입니다.</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%92%80%EC%9D%B4%EC%BD%94%EB%93%9C\">풀이코드</a></p>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 16, 2021","title":"프로그래머스 - 카드 짝 맞추기 (2021 카카오 블라인드 공채)","categories":"PS","author":"weasel","emoji":"📓"},"fields":{"slug":"/programmers-flip-card/"}},"prev":{"id":"924adec8-f95b-5d42-8dba-cf02c6398533","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 460px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAGeV89UFK//xAAaEAACAwEBAAAAAAAAAAAAAAABAgADESJC/9oACAEBAAEFArOQXmy5gW8hTn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPwFn/8QAGRAAAgMBAAAAAAAAAAAAAAAAABABETEh/9oACAEBAAY/Ai1uE9X/xAAZEAEAAwEBAAAAAAAAAAAAAAABABEhMUH/2gAIAQEAAT8he3rFriF9gC0ccjSA9b5BCm72f//aAAwDAQACAAMAAAAQp8//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8QkY//xAAWEQEBAQAAAAAAAAAAAAAAAAABEBH/2gAIAQIBAT8QWs//xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMXGRof/aAAgBAQABPxAgBWgXJnKPedNDUVw9SPFd+5tCcD5/uggQB97/2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"java meme\"\n        title=\"java meme\"\n        src=\"/static/c7f0a4e5d437279c1ee577d32a9f2c97/e41a8/java-meme.jpg\"\n        srcset=\"/static/c7f0a4e5d437279c1ee577d32a9f2c97/4ec73/java-meme.jpg 180w,\n/static/c7f0a4e5d437279c1ee577d32a9f2c97/158ba/java-meme.jpg 360w,\n/static/c7f0a4e5d437279c1ee577d32a9f2c97/e41a8/java-meme.jpg 460w\"\n        sizes=\"(max-width: 460px) 100vw, 460px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>GC를 수행하는 Garabage Collector는 아래와 같은 일을 한다.</p>\n<ul>\n<li>메모리 할당</li>\n<li>사용 중인 메모리 인식</li>\n<li>미사용 메모리 인식</li>\n</ul>\n<p><strong>Stop-the-World</strong></p>\n<ul>\n<li>자바 애플리케이션은 GC 실행시 GC 실행 스레드를 제외한 모든 스레들르 멈추고, GC 완료 후 다시 스레드들을 실행 상태로 변경</li>\n<li>Stop the World는 모든 애플리케이션 스레드들의 작업이 멈추는 상태</li>\n<li>어떤 GC 알고리즘을 사용해도 Stop-the-World는 불가피하며 대개의 GC 튜닝이란 이 Stop-the-World 시간을 줄이는 것이다.</li>\n</ul>\n<h3 id=\"전제\" style=\"position:relative;\"><a href=\"#%EC%A0%84%EC%A0%9C\" aria-label=\"전제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>전제</h3>\n<p>가비지 컬렉터는 두가지 전제 조건 하에서 만들어졌다.</p>\n<ul>\n<li>대부분의 객체는 금방 접근 불가능 상태(unreachable)가 된다.</li>\n<li>오래된 객체에서 젊은 객체로의 참조는 아주 적게 존재한다.</li>\n</ul>\n<p>이것을 ‘weak generational hypothesis’라고 하는데 이것을 살리기 위해서 <strong>Young 영역</strong>과 <strong>Old</strong> <strong>영역</strong>으로 나누었다.</p>\n<ul>\n<li>Young 영역 (Young Generation 영역) : <strong>새롭게 생성한 객체</strong> 대부분이 여기에 위치하고, 대부분이 금방 <strong>접근불가능</strong> 상태가 되기 때문에 매우 많은 객체가 Young 영역에 생성되었다가 사라진다. 이 영역에서 객체가 사라질때 Minor GC가 발생한다고 말함.</li>\n<li>Old 영역 (Old Generation 영역) : 접근 불가능 상태로 되지 않아 Young 영역에서 살아남은 객체가 여기로 복사된다. 대부분 Young 영역보다 크게 할당하며, 크기가 큰 만큼 Young 영역보다는 GC가 적게 발생한다.(쉽게 가득차지 않으니) 이 영역에서 객체가 사라질 때 Major GC가 발생한다고 말한다.</li>\n</ul>\n<p>객체의 데이터 흐름은 아래와 같다. PermG는 <strong>Java 8에서 Metaspace</strong>로 교체되었다.\r\n<img src=\"https://images.velog.io/images/hsw0194/post/e69c19a9-6591-4525-b7fb-97b15a47ac6a/Untitled%201.png\" alt=\"\"></p>\n<p>PermG에서 GC가 발생해도 MajorGC의 횟수로 친다.</p>\n<p>전제의 두번째가 “오래된 객체에서 젊은 객체로의 참조는 아주 적게 존재한다”인데, 만약 실제로 Old 영역의 객체가 Young 영역의 객체를 참조하는 경우가 생긴다면 Old 영역에 512Byte의 chunck로 되어 있는 card table을 따로 두어 해결한다.</p>\n<p>카드 테이블에는 Old 영역에 있는 객체가 <strong>Young 영역의 객체를 참조할 때마다 정보가 표시된다.</strong> Young 영역의 GC를 실행할 때에는 Old 영역에 있는 모든 객체의 참조를 확인하지 않고, <strong>이 카드테이블만 확인해 GC 대상인지 식별한다</strong>.\r\n<img src=\"https://images.velog.io/images/hsw0194/post/5ca37e27-9ab9-4a73-be73-880d868c89ef/Untitled%202.png\" alt=\"\"></p>\n<p>카드 테이블은 write barrier를 사용하여 관리한다. write barrier는 Minor GC를 빠르게 할 수 있도록 하는 장치인데, 이것 때문에 약간의 오버헤드는 있지만 (<strong>Old가 Young을 참조하는지 Old 영역 전체를 일일이 확인하지 않아도 되기에</strong>) 전반적인 GC시간은 줄어든다.</p>\n<h3 id=\"young-영역의-구성\" style=\"position:relative;\"><a href=\"#young-%EC%98%81%EC%97%AD%EC%9D%98-%EA%B5%AC%EC%84%B1\" aria-label=\"young 영역의 구성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Young 영역의 구성</h3>\n<p>객체가 제일 먼저 생성되는 Young 영역은 크게 3가지로 나뉜다.</p>\n<ul>\n<li>Eden 영역</li>\n<li>Survivor 영역(2개,From과 To)</li>\n</ul>\n<p>각 영역의 처리 절차를 순서에 따라 기술하면 다음과 같다.</p>\n<ul>\n<li>새롭게 생성한 대부분의 객체는 Eden 영역에 위치한다.</li>\n<li>Eden 영역에서 GC가 한 번 발생한 후 살아남은 객체는 Survivor 영역 중 하나로 이동한다.</li>\n<li>Eden 영역에서 GC가 발생하면 이미 살아남은 객체가 존재하는 Survivor 영역으로 객체가 계속 쌓인다.</li>\n<li>하나의 Survivor 영역이 가득차게 되면, 그 중에서 살아남은 객체를 다른 Surivor 영역으로 이동한다. 그리고 가득찬 Survivor 영역은 이제 아무 데이터가 없는 상태가 된다.</li>\n<li>이 과정을 반복하다 계속해서 살아남아 있는 객체는 Old 영역으로 이동하게 된다.</li>\n</ul>\n<p>이 절차에 따라서 <strong>Survivor 영역 중 하나는 반드시 비어있는 상태</strong>로 남아 있어야 한다.</p>\n<blockquote>\n<p>💡 <em>오래되었다고 하는 기준은 Young Generation 영역에서 Minor GC 가 발생하는 동안 얼마나 오래 살아남았는지로 판단한다. 각 객체는 Minor GC에서 살아남은 횟수를 기록하는 <strong>age bit</strong> 를 가지고 있으며, <strong>Minor GC가 발생할 때마다 age bit 값은 1씩 증가</strong> 하게되며, age bit 값이 <strong>MaxTenuringThreshold 라는 설정값을 초과하게 되는 경우 Old Generation 영역을 객체가 이동</strong> 되는 것이다. 또는 Age bit가 MaxTenuringThreshold 초과하기 전이라도 Survivor 영역의 메모리가 부족할 경우에는 미리 Old Generation 으로 객체가 옮겨질 수도 있다.</em> <em>JVM 옵션 : -XX:MaxTenuringThreshold</em></p>\n</blockquote>\n<h3 id=\"그럼-왜-survivor-영역이-두개인가\" style=\"position:relative;\"><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%99%9C-survivor-%EC%98%81%EC%97%AD%EC%9D%B4-%EB%91%90%EA%B0%9C%EC%9D%B8%EA%B0%80\" aria-label=\"그럼 왜 survivor 영역이 두개인가 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그럼 왜 Survivor 영역이 두개인가?</h3>\n<p>퍼포먼스와 연관있는데, fragmentation(단편화)를 줄이기 위함이다.\r\n예를 들어 새로운 객체는 Eden에 생성된다. Eden이 가득차면 GC가 수행되고 살아있는 객체는 Survivor로 옮겨진다. 근데 그다음에 Eden이 가득차면, Eden과 Survivor 영역의 메모리를 정리하지만 이 영역은 연속적이지 않게 된다. 이런 현상을 방지하기 위해 두가지 Survivor 영역을 두어서 위의 예시에서 두번째 GC시에 Eden과 Survivor 안에 있는 reachable한 객체들은 비어 있는 새로운 Survivor로 옮겨지거나 특정 객체(<strong>Old enough한</strong>)는 Old로 Promotion된다. 그리고 두 Survivor space는 역할을 바꾼다. 하나는 텅텅 비어있고 하나는 Eden에서 올라오는 것을 수용하는 공간. 이 과정을 통해 Heap에서의 <strong>연속적인 메모리 사용</strong>을 가능하게 한다.</p>\n<blockquote>\n<p>다시 말하면 Eden에서도 빈 공간 생기고, Survivor에서도 드문드문 빈 공간이 생기게 되는것. <strong>Memory internal Fragmentation</strong>과 비슷한일이 일어나는것)</p>\n</blockquote>\n<h3 id=\"mark-and-copy\" style=\"position:relative;\"><a href=\"#mark-and-copy\" aria-label=\"mark and copy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Mark and Copy</h3>\n<p>SerialGC에서 Young Generation에게 쓰는 GC 방식이다.</p>\n<ul>\n<li><strong>Fragmentation(단편화) 방지에는 효과적</strong>이다.</li>\n<li>Heap의 절반 밖에 사용하지 못하니 공간 활용의 비효율성</li>\n<li>Suspend 현상(Copy할때), Copy에 대한 Overhaed 존재</li>\n</ul>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/ae4e6a2d-f0be-49f2-a110-f4cc9219e1b1/Untitled%203.png\" alt=\"\"></p>\n<blockquote>\n<p><strong>Mark and Copy</strong> algorithms are very similar to the Mark and Compact as they too relocate all live objects. The important difference is that the target of relocation is a different memory region as a new home for survivors. Mark and Copy approach has some advantages as copying can occur simultaneously with marking during the same phase. The disadvantage is the need for one more memory region, which should be large enough to accommodate survived objects.</p>\n</blockquote>\n<h3 id=\"old-영역에-대한-gc\" style=\"position:relative;\"><a href=\"#old-%EC%98%81%EC%97%AD%EC%97%90-%EB%8C%80%ED%95%9C-gc\" aria-label=\"old 영역에 대한 gc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Old 영역에 대한 GC</h3>\n<p>Old 영역은 기본적으로 데이터가 가득 차면 GC를 실행한다. GC 방식에 따라 처리 절차가 달라지므로 GC 방식에 따라 접근하고 이해해야 한다. JDK 7 기준 5가지 방식</p>\n<ul>\n<li>Serial GC (싱글코어를 상정하고 만든 방식이라 운영서버 사용금지)</li>\n<li>Parallel GC</li>\n<li>Parallel Old GC(Parallel Compacting GC)</li>\n<li>Concurrent Mark &#x26; Sweep GC(CMS)</li>\n<li>G1(Garbage First) GC (도입은 JDK7, JDK9부터 기본 GC)</li>\n</ul>\n<h3 id=\"serial-gc\" style=\"position:relative;\"><a href=\"#serial-gc\" aria-label=\"serial gc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serial GC</h3>\n<p>Young 영역에서의 GC는 앞에서 설명한 방식을 사용하고,(<strong>Mark and Copy</strong>) Old 영역의 GC는 <strong>mark-sweep-compact</strong> 알고리즘을 사용한다. 디스크 조각모음과 비슷하다. 두 GC 모두 Stop-the-World를 트리거한다.</p>\n<ol>\n<li>Old 영역에 살아 있는 객체를 식별(<strong>Mark</strong>)한다.</li>\n<li>Heap의 앞 부분부터 확인하여 살아있는 것만 남긴다.(<strong>Sweep)</strong></li>\n<li>각 객체들이 연속되게 쌓이도록 Heap의 가장 앞 부분부터 채워서 객체가 존재하는 부분과 존재하지 않는 부분으로 남긴다.(<strong>Compaction)</strong></li>\n</ol>\n<p>적은 메모리와 CPU 코어 개수가 적을때 적합한 방식이다.</p>\n<h3 id=\"parallel-gc\" style=\"position:relative;\"><a href=\"#parallel-gc\" aria-label=\"parallel gc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parallel GC</h3>\n<p>기본적인 알고리즘은 Serial GC와 같다. 그러나 SerialGC가 GC를 처리하는 스레드가 하나인 것에 비해 Parallel GC는 GC를 처리하는 <strong>스레드가 여러개</strong>로 SerialGC보다 빠르게 수행된다. 메모리가 충분하고 코어의 개수가 많을 때 유리하다. <strong>Throughput GC</strong>라고도 부른다.</p>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/301f3f1d-9e3d-44e4-bd73-30ee8c7ab469/Untitled%204.png\" alt=\"\">\r\n더 빠르게 동작하니 Stop-the-World의 시간도 줄여주는 효과를 얻을 수 있고 Java 애플리케이션 전체가 매끄럽게 동작한다.</p>\n<h3 id=\"parallel-old-gc\" style=\"position:relative;\"><a href=\"#parallel-old-gc\" aria-label=\"parallel old gc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Parallel Old GC</h3>\n<p>JDK5u6부터 제공한 GC 방식이고, Parallel GC와 비교하여 Old 영역의 GC 알고리즘만 다르다. 이 방식은 <strong>Mark-Summary-Compaction</strong> 단계를 거친다. Summary 단계는 앞서 GC를 수행한 영역에 대해 별도로 살아 있는 객체를 식별한다는 점에서 Mark-Sweep-Compcation 알고리즘의 sweep 단계와는 다르며, 약간 더 복잡하다.</p>\n<ul>\n<li><strong>Sweep</strong>은 <strong>단일 스레드</strong>가 Old 영역 전체를 훑어 살아있는 객체만 찾는다.</li>\n<li><strong>Summary</strong>는 <strong>여러 스레드</strong>가 Old 영역을 분리하여 훑는다. 또 효율성을 위해 Compaction된 영역도 별도로 훑는다.</li>\n</ul>\n<h3 id=\"cms-gc-concurrent-mark-sweep-garbage-collector\" style=\"position:relative;\"><a href=\"#cms-gc-concurrent-mark-sweep-garbage-collector\" aria-label=\"cms gc concurrent mark sweep garbage collector permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CMS GC (Concurrent Mark-Sweep Garbage Collector)</h3>\n<p>GC 과정에서 발생하는 Stop-the-World의 시간을 최소화하는데 초점을 맞춘 GC 방식으로 GC의 과정이 복잡하다.</p>\n<p>GC 대상을 최대한 자세히 파악한후, 정리하는 시간(STW가 발생하는 시간)을 짧게 가져가는 컨셉으로, 과정이 복잡한 만큼 다른 GC 대비 CPU 사용량이 높다.</p>\n<p>아래의 그림은 Serial GC와 CMS GC를 비교한 그림이다. 엄청 복잡.</p>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/2a1ae290-5b84-41e3-a97a-04d07a49ea9e/Untitled%205.png\" alt=\"\">\r\nYoung 영역에서는 <strong>Mark and copy</strong>방식을 그대로 사용하고 Old 영역은 Concurrent Mark-Sweep 알고리즘을 사용한다.</p>\n<p>CMS GC는 <strong>Initial Mark → Concurrent Mark → Remark → Concurrent Sweep</strong> 과정이다.</p>\n<ul>\n<li><strong>Initial Mark</strong>\n<ul>\n<li>GC 과정에서 살아남은 객체를 탐색하는 시작 객체(GC Root)에서 참조 Tree상 가장 가까운 객체만 1차적으로 찾아가며 객체가 GC대상(참조가 끊긴)인지를 판단한다. 이때는 STW 현상이 발생하지만, 탐색 깊이가 얕아 STW 발생 기간이 매우 짧다.</li>\n</ul>\n</li>\n<li><strong>Concurrent Mark</strong>\n<ul>\n<li>STW 현상없이 진행되며, Initial Mark 단계에서 GC 대상으로 판별된 객체들이 참조하는 다른 객체들을 따라가며 GC 대상인지를 추가적으로 확인한다.</li>\n<li>이 단계의 특징은 다른 스레드가 실행중인 상태에서 동시에 진행된다는 것.</li>\n</ul>\n</li>\n<li><strong>Remark</strong>\n<ul>\n<li>Concurrent Mark 단계의 결과를 검증하며, 이전 단계에서 GC 대상으로 추가 확인되거나 참조가 제거되었는지 등을 확인한다. 이 과정은 STW를 유발하기 때문에 STW 지속시간을 최대한 줄이기 위해 멀티스레드로 검증 작업을 수행한다.</li>\n</ul>\n</li>\n<li><strong>Concurrent Sweep</strong>\n<ul>\n<li>STW 없이 Remark 단계에서 검증 완료된 GC 객체들을 메모리에서 제거한다.</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"https://images.velog.io/images/hsw0194/post/a1b7f7fd-119a-4c13-8620-579be4c807db/Untitled%206.png\" alt=\"Initial Mark -> Concurrent Mark -> Remark -> Concurrent Sweep , CMS의 상황\">\r\n<em>Initial Mark -> Concurrent Mark -> Remark -> Concurrent Sweep ,</em> CMS의 상황</p>\n<p>CMS GC는 Compaction 작업을 <strong>필요한 경우에만</strong> 수행한다. 즉, 연속적인 메모리 할당이 어려울 정도로 메모리 단편화과 심한 경우에만 Compaction 과정을 수행하는 것이다.</p>\n<p>또 이러한 단계로 진행되는 것이기에 STW 시간이 매우 짧고, 모든 애플리케이션의 응답 속도가 매우 중요할 때 CMS GC를 사용하며, Low Latency GC라고도 부른다.</p>\n<h3 id=\"g1-gc-garbage-first\" style=\"position:relative;\"><a href=\"#g1-gc-garbage-first\" aria-label=\"g1 gc garbage first permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>G1 GC (Garbage First)</h3>\n<p>G1 GC는 기존의 Young 영역과 Old 영역을 구분하던 방식과는 다른 접근을 한다.</p>\n<p>아래 그림과 같이 G1 GC는 <strong>바둑판처럼 영역을 구분</strong>하고 그 영역에 객체를 할당하고 GC를 실행한다. 해당 영역이 꽉 차면 다른 영역에서 객체를 할당하고 GC를 실행한다.</p>\n<p>기존의 Young의 Eden/Survivor 영역에서 데이터가 Old 영역으로 이동하는 단계가 사라진 GC방식이다. 또 G1 GC에선 각각의 바둑판 모양의 영역이 <strong>Eden,Survivor,Old 영역의 역할을 동적으로 바꿔가며 GC가 일어난다.</strong>\r\n<img src=\"https://images.velog.io/images/hsw0194/post/19719195-b95f-4434-a093-57c28684ba9e/Untitled%207.png\" alt=\"\"></p>\n<p>G1 GC는 지금껏 얘기한 어떤 GC 방식보다 빠른 성능을 장점으로 가진다. 다시 말해 짧은 STW를 지향한다는 것이다.</p>\n<p>G1 GC는 굉장히 크기가 큰 Heap에서도 짧은 STW 시간은 보이는데 왜 그런것일까?</p>\n<h3 id=\"g1-gc의-비밀\" style=\"position:relative;\"><a href=\"#g1-gc%EC%9D%98-%EB%B9%84%EB%B0%80\" aria-label=\"g1 gc의 비밀 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>G1 GC의 비밀</h3>\n<p>Heap의 용량이 커지면 커질수록, 객체의 갯수가 많아지고, 자연스럽게 GC 수행시간이 길어지며 STW 시간도 늘어난다. 하지만 G1 GC는 다르다.</p>\n<ol>\n<li>GC시에 전체 Heap에 대해서 GC를 수행할 필요가 없다. GC 해야하는 영역만 GC를 수행하면 되기 때문이다.</li>\n<li>Old 영역에 대한 Compaction을 할때, 전체 Old 영역에 대해서 Compaction을 할 필요가 없다. 특정한 영역에 대해서만 Compaction을 하면 된다.</li>\n<li>Garbage를 먼저 수집해간다. G1 GC는 살아있는 객체를 마킹한후에 <strong>영역 별로 얼만큼 살려줘야 하는지를 알 수 있다.</strong> 그 후 영역 중에 모든 객체가 죽은 리전(유효한 객체가 없는,<strong>Garbage만 있는 영역</strong>)부터 먼저 회수를 한다. 메모리 회수를 먼저하기에 빈 공간 확보를 더 빨리 할 수 있다. 그러면 GC가 낮은 빈도로 일어난다.</li>\n</ol>\n<h3 id=\"왜-g1gc가-jdk9부터-default-gc로-선정되었을까\" style=\"position:relative;\"><a href=\"#%EC%99%9C-g1gc%EA%B0%80-jdk9%EB%B6%80%ED%84%B0-default-gc%EB%A1%9C-%EC%84%A0%EC%A0%95%EB%90%98%EC%97%88%EC%9D%84%EA%B9%8C\" aria-label=\"왜 g1gc가 jdk9부터 default gc로 선정되었을까 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>왜 G1GC가 JDK9부터 default GC로 선정되었을까?</h3>\n<blockquote>\n<p>G1 GC의 목표는 일시정지 시간 (STW)을 최소화하는데 있다. 영역별로 나누어서 GC를 수행하기 때문에 전체 Old 영역에 대한 GC를 수행하는 일이 생기지 않아 긴 시간의 STW를 가지는 Major GC의 빈도를 낮출수 있어서 선택되었다고 생각한다.</p>\n</blockquote>\n<h3 id=\"출처-\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98-\" aria-label=\"출처  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처 :</h3>\n<p><a href=\"https://perfectacle.github.io/2019/05/11/jvm-gc-advanced/\">JVM GC</a></p>\n<p><a href=\"https://d2.naver.com/helloworld/1329\">네이버 D2 블로그</a></p>\n<p><a href=\"https://plumbr.io/handbook/garbage-collection-algorithms-implementations\">전체적인 GC에 대한 통계 제공</a></p>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#%EC%A0%84%EC%A0%9C\">전제</a></li>\n<li><a href=\"#young-%EC%98%81%EC%97%AD%EC%9D%98-%EA%B5%AC%EC%84%B1\">Young 영역의 구성</a></li>\n<li><a href=\"#%EA%B7%B8%EB%9F%BC-%EC%99%9C-survivor-%EC%98%81%EC%97%AD%EC%9D%B4-%EB%91%90%EA%B0%9C%EC%9D%B8%EA%B0%80\">그럼 왜 Survivor 영역이 두개인가?</a></li>\n<li><a href=\"#mark-and-copy\">Mark and Copy</a></li>\n<li><a href=\"#old-%EC%98%81%EC%97%AD%EC%97%90-%EB%8C%80%ED%95%9C-gc\">Old 영역에 대한 GC</a></li>\n<li><a href=\"#serial-gc\">Serial GC</a></li>\n<li><a href=\"#parallel-gc\">Parallel GC</a></li>\n<li><a href=\"#parallel-old-gc\">Parallel Old GC</a></li>\n<li><a href=\"#cms-gc-concurrent-mark-sweep-garbage-collector\">CMS GC (Concurrent Mark-Sweep Garbage Collector)</a></li>\n<li><a href=\"#g1-gc-garbage-first\">G1 GC (Garbage First)</a></li>\n<li><a href=\"#g1-gc%EC%9D%98-%EB%B9%84%EB%B0%80\">G1 GC의 비밀</a></li>\n<li><a href=\"#%EC%99%9C-g1gc%EA%B0%80-jdk9%EB%B6%80%ED%84%B0-default-gc%EB%A1%9C-%EC%84%A0%EC%A0%95%EB%90%98%EC%97%88%EC%9D%84%EA%B9%8C\">왜 G1GC가 JDK9부터 default GC로 선정되었을까?</a></li>\n<li><a href=\"#%EC%B6%9C%EC%B2%98-\">출처 :</a></li>\n</ul>\n</div>","frontmatter":{"date":"November 05, 2021","title":"Java의 알쏭달쏭한 GC","categories":"Java","author":"weasel","emoji":"📓"},"fields":{"slug":"/java-gc/"}},"site":{"siteMetadata":{"siteUrl":"https://becomeweasel.me","comments":{"utterances":{"repo":"BecomeWeasel/BecomeWeasel.github.io"}}}}},"pageContext":{"slug":"/how-spring-handler-mapping-works-2/","nextSlug":"/programmers-flip-card/","prevSlug":"/java-gc/"}},
    "staticQueryHashes": ["1073350324","1956554647","2938748437"]}